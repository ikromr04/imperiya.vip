import{r as N,j as e,c as b,a as O,u as j,i as S,k as B,m as K,n as M,o as z,y as v,p as W,q as H,t as A,S as J}from"./main-XRo2qOUM.js";import{I as Q}from"./icons-B9HDjQFM.js";import{f as U}from"./index-_akthio-.js";import{A as F}from"./app-logo-IMcAwPrm.js";import{c as y,d as I,a as l,e as u}from"./index.esm-DPaSKxW4.js";import{F as X,a as Z,b as E}from"./formik.esm-Be66R8Pj.js";import{B as w}from"./button-Y4UR9_BE.js";import{T as t}from"./text-field-DZyLsNjz.js";import{S as f}from"./select-field-DvwDrwa-.js";import{S as L,R as ee}from"./users-DUqPc0QS.js";import{g as se,a as re}from"./grades-selector-BPd7_f6O.js";import{C as R}from"./content-field-tIYjuVXj.js";import{g as ae,a as te}from"./professions-selector-CFvWVWsI.js";import{g as le,a as ne}from"./nationalities-selector-DurcRylD.js";import{L as P}from"./cleanable-vEQcTMeq.js";import"./preload-helper-DPi8upcZ.js";import"./index.browser-OxPLOBIU.js";import"./use-dropdown-BNrZcIiO.js";function G(g){const[i,d]=N.useState(g.secondsLeft),m=Q[i>0?"timer":"alarm"];return N.useEffect(()=>{if(i<=0)return;const h=setInterval(()=>{d(c=>c-1)},1e3);return()=>clearInterval(h)},[i]),e.jsxs("div",{className:b("sticky top-4 z-30 flex justify-center items-center gap-2 text-xl font-medium rounded text-white px-4 h-9 ml-auto mb-4",i>0?"bg-success":"bg-danger"),children:[e.jsx(m,{width:16,height:16}),U(i)]})}const ie=y().shape({children:I().of(y({name:l().required("Имя обязательно для заполнения."),surname:l().required("Фамилия обязательна для заполнения."),birth_date:l().required("Укажите дату рождения."),sex:l().required("Укажите пол."),nationality_id:u().required("Укажите национальность.").min(1,"Укажите национальность."),grade_id:u().required("Укажите класс.").min(1,"Укажите класс."),admission_date:l().required("Укажите дату поступления.").min(1,"Укажите дату поступления."),previous_schools:l().required("Информация о предыдущих школах обязательна. Если нет - напишите 'Нет'."),medical_recommendations:l().required("Медицинские рекомендации обязательны. Если нет - напишите 'Нет'.")})).min(1,"Необходимо указать как минимум одного ребенка."),parents:I().of(y({name:l().required("Имя обязательно для заполнения."),surname:l().required("Фамилия обязательна для заполнения."),birth_date:l().required("Укажите дату рождения."),sex:l().required("Укажите пол."),nationality_id:u().required("Укажите национальность.").min(1,"Укажите национальность."),profession_id:u().required("Укажите сферу деятельности.").min(1,"Укажите сферу деятельности."),workplace:l().required("Место работы обязательно."),position:l().required("Должность обязательна."),tel:y({code:u().required(" "),numbers:u().required(" ")}).required("Обязательное поле."),whatsapp:y({code:u().required(" "),numbers:u().required(" ")}).required("Обязательное поле."),email:l().email("Неверный формат email.").nullable().notRequired(),address:y({physical_address:l().required("Фактический адрес обязателен."),region:l().required("Укажите район.")})})).min(1,"Необходимо указать как минимум одного родителя.")}),oe={2:"второго",3:"третьего",4:"четвертого",5:"пятого",6:"шестого",7:"седьмого",8:"восьмого",9:"девьятого",10:"десятого"};function de({token:g}){const i=O(),d=j(le),m=j(ae),h=j(se),c=j(ne),_=j(te),C=j(re),[T,V]=N.useState(1),k={token:g,children:[{name:"",surname:"",birth_date:"",sex:"",nationality_id:0,grade_id:0,admission_date:"",previous_schools:"",medical_recommendations:""}],parents:[{name:"",surname:"",birth_date:"",sex:"",nationality_id:0,profession_id:0,workplace:"",position:"",tel:{code:"",numbers:""},whatsapp:{code:"",numbers:""},email:"",address:{physical_address:"",region:""}}]};N.useEffect(()=>{d===S.Idle&&i(B()),m===S.Idle&&i(K()),h===S.Idle&&i(M())},[i,h,d,m]);const Y=async(a,o)=>{o.setSubmitting(!0),await i(z({dto:a,onSuccess:()=>{v.success("Поздравляю! Вы успешно зарегистрировались."),V(n=>n+1)},onValidationError:n=>{var p;o.setErrors({...n.errors}),(p=n.errors)!=null&&p.token[0]&&v.error(n.errors.token[0])},onFail:n=>v.error(n)})),o.setSubmitting(!1)},D=a=>()=>{var p;let o="";const n=Object.keys(a)[0];if(n){o=n;const x=a[n];if(Array.isArray(x)){const q=x.findIndex(s=>s!=null);if(q!==-1){o=`${n}[${q}]`;const s=x[q];if(s){const r=Object.keys(s)[0];o=`${o}.${r}`,(p=document.body.querySelector(`[name="${o}"]`))==null||p.scrollIntoView({block:"center"})}}}}};return e.jsx(X,{initialValues:k,validationSchema:ie,onSubmit:Y,children:({values:a,isSubmitting:o,errors:n})=>e.jsxs(Z,{className:"flex flex-col gap-4 w-full max-w-5xl mx-auto",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl leading-none font-semibold mb-1 ml-2",children:a.children.length>1?"Дети":"Ребенок"}),e.jsx(E,{name:"children",children:({push:p,remove:x})=>e.jsxs("div",{className:b("flex flex-col gap-3 bg-white border rounded-md shadow",a.children.length>1?"px-4 py-2 ":"px-8 py-4"),children:[a.children.map((q,s)=>e.jsxs("fieldset",{className:b("relative grid gap-3 md:grid-cols-2 lg:grid-cols-3 rounded",a.children.length>1&&"border border-gray-300 p-4"),children:[e.jsxs("legend",{className:b("px-1",a.children.length<=1&&"hidden"),children:["Ребенок ",s+1]}),a.children.length>1&&e.jsx(w,{className:"!absolute right-1 -top-2",icon:"close",variant:"light",onClick:()=>x(s),children:e.jsx("span",{className:"sr-only",children:"Удалить ребенка"})}),e.jsx(t,{name:`children[${s}].name`,label:"Имя",required:!0}),e.jsx(t,{name:`children[${s}].surname`,label:"Фамилия",required:!0}),e.jsx(t,{className:"md:col-span-2 lg:col-span-1",name:`children[${s}].patronymic`,label:"Отчество (если имеется)"}),e.jsx(t,{name:`children[${s}].birth_date`,label:"Дата рождения",type:"date",required:!0}),e.jsx(f,{name:`children[${s}].sex`,label:"Пол",options:["male","female"].map(r=>({value:r,label:L[r]})),required:!0}),c&&e.jsx(f,{name:`children[${s}].nationality_id`,label:"Национальность",options:c.map(({id:r,name:$})=>({value:r,label:$})),required:!0}),C&&e.jsx(f,{name:`children[${s}].grade_id`,label:"Класс",options:C.map(r=>({value:r.id,label:`${r.level} ${r.group}`})),required:!0}),e.jsx(t,{className:"md:col-span-2",name:`children[${s}].admission_date`,label:"С какого года ребенок обучается в ЧОУ «Империя знаний»",type:"date",required:!0}),e.jsx(R,{className:"md:col-span-2 lg:col-span-3",name:`children[${s}].previous_schools`,label:"Перечислите предыдущие школы",placeholder:"Если нет — пишите «Нет»",required:!0}),e.jsx(R,{className:"md:col-span-2 lg:col-span-3",name:`children[${s}].medical_recommendations`,label:"Медицинские и психологические рекомендации для ребенка",placeholder:"Если нет — пишите «Нет»",required:!0})]},s)),e.jsxs(w,{className:"justify-center leading-none !w-full shadow-none border !bg-gray-50 border-dashed border-gray-300 mt-1 text-gray-500 hover:border-gray-500",icon:"add",variant:"light",onClick:()=>p(k.children[0]),children:["Добавить ",oe[a.children.length+1]," ребенка"]})]})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl leading-none font-semibold mb-1 ml-2",children:a.parents.length>1?"Родители":"Родитель"}),e.jsx(E,{name:"parents",children:({push:p,remove:x})=>e.jsxs("div",{className:b("flex flex-col gap-3 bg-white border rounded-md shadow",a.parents.length>1?"px-4 py-2 ":"px-8 py-4 "),children:[a.parents.map((q,s)=>e.jsxs("fieldset",{className:b("relative grid gap-3 md:grid-cols-2 lg:grid-cols-3 rounded",a.parents.length>1&&"border border-gray-300 p-4"),children:[e.jsxs("legend",{className:b("px-1",a.parents.length<=1&&"hidden"),children:["Родитель ",s+1]}),a.parents.length>1&&e.jsx(w,{className:"!absolute right-1 -top-2",icon:"close",variant:"light",onClick:()=>x(s),children:e.jsx("span",{className:"sr-only",children:"Удалить родителя"})}),e.jsx(t,{name:`parents[${s}].name`,label:"Имя",required:!0}),e.jsx(t,{name:`parents[${s}].surname`,label:"Фамилия",required:!0}),e.jsx(t,{className:"md:col-span-2 lg:col-span-1",name:`parents[${s}].patronymic`,label:"Отчество (если имеется)"}),e.jsx(t,{name:`parents[${s}].birth_date`,label:"Дата рождения",type:"date",required:!0}),e.jsx(f,{name:`parents[${s}].sex`,label:"Пол",options:["male","female"].map(r=>({value:r,label:L[r]})),required:!0}),c&&e.jsx(f,{name:`parents[${s}].nationality_id`,label:"Национальность",options:c.map(({id:r,name:$})=>({value:r,label:$})),required:!0}),_&&e.jsx(f,{name:`parents[${s}].profession_id`,label:"Сфера деятельности",options:_.map(({id:r,name:$})=>({value:r,label:$})),required:!0}),e.jsx(t,{name:`parents[${s}].workplace`,label:"Место работы",required:!0}),e.jsx(t,{name:`parents[${s}].position`,label:"Должность",required:!0}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(P,{label:"Телефон",required:!0}),e.jsxs("div",{className:"flex gap-1 w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:`parents[${s}].tel.code`,placeholder:"Код",required:!0}),e.jsx("span",{className:"absolute top-1/2 left-3 -translate-y-1/2 text-xl",children:"+"})]}),e.jsx(t,{className:"w-[120px] grow",type:"number",name:`parents[${s}].tel.numbers`,placeholder:"Номер",required:!0})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(P,{label:"WhatsApp",required:!0}),e.jsxs("div",{className:"flex gap-1 w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:`parents[${s}].whatsapp.code`,placeholder:"Код",required:!0}),e.jsx("span",{className:"absolute top-1/2 left-3 -translate-y-1/2 text-xl",children:"+"})]}),e.jsx(t,{className:"w-[120px] grow",type:"number",name:`parents[${s}].whatsapp.numbers`,placeholder:"Номер",required:!0})]})]}),e.jsx(t,{className:"md:order-1 lg:order-none",type:"email",name:`parents[${s}].email`,label:"E-mail (если имеется)"}),e.jsx(t,{className:"lg:col-span-2",name:`parents[${s}].address.physical_address`,label:"Адрес проживания (фактический)",required:!0}),e.jsx(f,{name:`parents[${s}].address.region`,label:"Район",options:ee.map(r=>({value:r,label:r})),required:!0})]},s)),a.parents.length===1&&e.jsx(w,{className:"justify-center leading-none !w-full shadow-none border !bg-gray-50 border-dashed border-gray-300 mt-1 text-gray-500 hover:border-gray-500",icon:"add",variant:"light",onClick:()=>p(k.parents[0]),children:"Добавить второго родителя"})]})})]}),e.jsx(w,{className:"justify-center",type:"submit",disabled:o,loading:o,onClick:D(n),children:"Зарегистрироваться"})]})},T)}function ve(){const g=O(),[i]=W(),d=i.get("token"),[m,h]=N.useState(null);if(N.useEffect(()=>{d&&!m&&g(H({token:d,onSuccess:_=>h(_),onFail:()=>h({expiresAt:A().format("YYYY-MM-DD"),token:d,id:0})}))},[g,m,d]),!m)return e.jsx("div",{className:"w-screen h-screen flex items-center justify-center",children:e.jsx(J,{className:"w-8 h-8"})});const c=A(m.expiresAt).diff(A(),"second");return c<=0?e.jsxs("main",{className:"flex flex-col min-h-screen p-4 pb-40 md:px-6 lg:px-8",children:[e.jsx(G,{secondsLeft:c}),e.jsx(F,{className:"mx-auto mb-4"}),e.jsxs("section",{className:"leading-[1.2] border border-dashed rounded-md border-orange-300 max-w-[610px] mx-auto px-8 py-4 mb-6",children:[e.jsx("h2",{className:"uppercase text-danger mb-2",children:"Срок действия вашей ссылки истек! "}),e.jsxs("p",{children:["Срок действия вашей ссылки истек. Для получения новой ссылки напишите ",e.jsx("a",{className:"text-blue-600 underline underline-offset-2",href:"https://wa.me/+992918339939",target:"_blank",children:"администратору"}),"."]})]})]}):e.jsxs("main",{className:"flex flex-col min-h-screen p-4 pb-40 md:px-6 lg:px-8",children:[e.jsx(G,{secondsLeft:c}),e.jsx(F,{className:"mx-auto mb-4"}),e.jsxs("section",{className:"leading-[1.2] border border-dashed rounded-md border-orange-300 max-w-[610px] mx-auto px-8 py-4 mb-6",children:[e.jsx("h2",{className:"uppercase text-danger inline",children:"Внимание! "}),e.jsxs("p",{className:"inline",children:["Вся информация, внесенная в данную форму, редактированию не подлежит. В случае необходимости внесения изменений или дополнений обратитесь к ",e.jsx("a",{className:"text-blue-600 underline underline-offset-2",href:"https://wa.me/+992918339939",target:"_blank",children:"администратору"}),"."]})]}),d&&e.jsx(de,{token:d})]})}export{ve as default};
