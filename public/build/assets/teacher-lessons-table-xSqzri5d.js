import{t as a,j as e,L as S,A as v,a as D,u as p,g as k,r as u,i as y,C as I,n as L,ae as A,S as z,c as Y}from"./main-DKRIU25v.js";import{I as b}from"./icons-Dws060uV.js";import{b as C,c as N}from"./index-GT0de2U0.js";import{H as _,L as E}from"./lesson-hour-Ba7DchMc.js";import{g as G,a as R}from"./grades-selector-j7gnMaQA.js";import{g as $,a as H}from"./subjects-selector-CJseDrq6.js";import"./preload-helper-BfFHrpNk.js";function T({date:l,hour:c,subjects:o,lessons:i,grades:d}){const n=i.filter(s=>a(s.date).format("YYYY-MM-DD")===a(l).format("YYYY-MM-DD")&&+s.hour==+c);if(!n)return;const x=d.filter(({id:s})=>n.some(r=>r.gradeId===s));return e.jsx("div",{className:"flex justify-evenly text-center leading-none group",children:n.map(s=>{var f;const r=x.find(({id:m})=>m===s.gradeId);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-center text-sm items-baseline",children:e.jsxs(S,{className:"duration-150 hover:text-blue-600 truncate text-lg leading-none font-bold",to:`${v.Journal}?gradeId=${s.gradeId}&subjectId=${s.subjectId}`,children:[r==null?void 0:r.level," ",r==null?void 0:r.group]})}),e.jsxs("span",{className:"truncate text-sm leading-none",children:["(",(f=o.find(({id:m})=>m===s.subjectId))==null?void 0:f.name,")"]})]},s.id)})})}function K({user:l}){const c=D(),o=p(k),[i,d]=u.useState(null),[n,x]=u.useState(0),s=C(n),r=u.useRef(null),f=p($),m=p(G),j=p(H),w=p(R);u.useEffect(()=>{f===y.Idle&&c(I()),m===y.Idle&&c(L()),!i&&o&&c(A({week:n,teacherId:(l==null?void 0:l.id)||o.id,onSuccess:t=>d(t)}))},[o,c,m,i,f,l==null?void 0:l.id,n]);const g=t=>{if(r.current){const{scrollLeft:h}=t.currentTarget;r.current.querySelectorAll(".sync-scroll").forEach(M=>{M.scrollLeft=h})}};return!i||!j||!o||!w?e.jsx(z,{className:"w-8 h-8"}):e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)] max-w-full",children:[e.jsxs("table",{ref:r,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(b.calendar,{className:"relative top-[1px]",height:16}),N(a(s[0]).format("MMMM")),a(s[0]).format("M")!==a(s[5]).format("M")&&` - ${N(a(s[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:g,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),s.map(t=>e.jsx("th",{className:Y("p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",a(t).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")&&"bg-green-50"),children:N(t.format("dddd - DD"))},a(t).format()))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:g,children:Object.keys(_).map(t=>e.jsxs("tr",{className:"min-h-[53px] h-[53px] max-h-[53px] border-b",children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-0 z-10 bg-white",children:e.jsx("div",{className:"absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",children:t})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(E,{hour:+t})}),s.map(h=>e.jsx("td",{className:Y("relative z-0 p-2 border-l min-w-[260px] w-[260px] max-w-[260px]",a(h).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:j&&w&&e.jsx(T,{date:h,hour:Number(t),subjects:j,lessons:i,grades:w})},a(h).format()))]},t))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:g,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),s.map(t=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},a(t).format()))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{x(t=>t-1),d(null)},children:[e.jsx(b.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),n!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{x(0),d(null)},children:[e.jsx(b.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{x(t=>t+1),d(null)},children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(b.next,{width:7})]})]})})]})}export{K as default};
