import{r as y,j as e,c as f,u as P,a as k,h as V,i as Y,k as D,m as G,y as v,n as B,o as K,p as S,S as M}from"./main-D1X-5qeh.js";import{I as z}from"./icons-Cwm3zsc5.js";import{f as W}from"./index-Y5BpZlJY.js";import{A as F}from"./app-logo-CQYB2c9W.js";import{c as j,d as A,a as n,e as u}from"./index.esm-tVQjNZt4.js";import{F as H,a as J,b as C}from"./formik.esm-CEA5_Xoc.js";import{B as $}from"./button-BxcCnYcJ.js";import{T as l}from"./text-field-D3e8nZd6.js";import{S as b}from"./select-field-DvwSWDo-.js";import{S as E,R as Q}from"./users-DUqPc0QS.js";import{g as U}from"./grades-selector-CjDDihwd.js";import{C as L}from"./content-field-Dj1tSyJD.js";import{g as X}from"./professions-selector-Lr4nX4_U.js";import{g as Z}from"./nationalities-selector-BQnDI0q3.js";import{L as I}from"./cleanable-BYiEZa8s.js";import"./preload-helper-DPi8upcZ.js";import"./index.browser-OxPLOBIU.js";import"./use-dropdown-BjzLPdm1.js";function R(g){const[o,t]=y.useState(g.secondsLeft),d=z[o>0?"timer":"alarm"];return y.useEffect(()=>{if(o<=0)return;const m=setInterval(()=>{t(h=>h-1)},1e3);return()=>clearInterval(m)},[o]),e.jsxs("div",{className:f("sticky top-4 z-30 flex justify-center items-center gap-2 text-xl font-medium rounded text-white px-4 h-9 ml-auto mb-4",o>0?"bg-success":"bg-danger"),children:[e.jsx(d,{width:16,height:16}),W(o)]})}const ee=j().shape({children:A().of(j({name:n().required("Имя обязательно для заполнения."),surname:n().required("Фамилия обязательна для заполнения."),birth_date:n().required("Укажите дату рождения."),sex:n().required("Укажите пол."),nationality_id:u().required("Укажите национальность.").min(1,"Укажите национальность."),grade_id:u().required("Укажите класс.").min(1,"Укажите класс."),admission_date:n().required("Укажите дату поступления.").min(1,"Укажите дату поступления."),previous_schools:n().required("Информация о предыдущих школах обязательна. Если нет - напишите 'Нет'."),medical_recommendations:n().required("Медицинские рекомендации обязательны. Если нет - напишите 'Нет'.")})).min(1,"Необходимо указать как минимум одного ребенка."),parents:A().of(j({name:n().required("Имя обязательно для заполнения."),surname:n().required("Фамилия обязательна для заполнения."),birth_date:n().required("Укажите дату рождения."),sex:n().required("Укажите пол."),nationality_id:u().required("Укажите национальность.").min(1,"Укажите национальность."),profession_id:u().required("Укажите сферу деятельности.").min(1,"Укажите сферу деятельности."),workplace:n().required("Место работы обязательно."),position:n().required("Должность обязательна."),tel:j({code:u().required(" "),numbers:u().required(" ")}).required("Обязательное поле."),whatsapp:j({code:u().required(" "),numbers:u().required(" ")}).required("Обязательное поле."),email:n().email("Неверный формат email.").nullable().notRequired(),address:j({physical_address:n().required("Фактический адрес обязателен."),region:n().required("Укажите район.")})})).min(1,"Необходимо указать как минимум одного родителя.")}),ae={2:"второго",3:"третьего",4:"четвертого",5:"пятого",6:"шестого",7:"седьмого",8:"восьмого",9:"девьятого",10:"десятого"};function se({token:g}){const o=P(),t=k(Z),d=k(X),m=k(U),[h,w]=y.useState(1),_={token:g,children:[{name:"",surname:"",birth_date:"",sex:"",nationality_id:0,grade_id:0,admission_date:"",previous_schools:"",medical_recommendations:""}],parents:[{name:"",surname:"",birth_date:"",sex:"",nationality_id:0,profession_id:0,workplace:"",position:"",tel:{code:"",numbers:""},whatsapp:{code:"",numbers:""},email:"",address:{physical_address:"",region:""}}]};y.useEffect(()=>{!t.data&&!t.isFetching&&o(V()),!d.data&&!d.isFetching&&o(Y()),!m.data&&!m.isFetching&&o(D())},[o,m.data,m.isFetching,t.data,t.isFetching,d.data,d.isFetching]);const O=async(r,c)=>{c.setSubmitting(!0),await o(G({dto:r,onSuccess:()=>{v.success("Поздравляю! Вы успешно зарегистрировались."),w(i=>i+1)},onValidationError:i=>{var p;c.setErrors({...i.errors}),(p=i.errors)!=null&&p.token[0]&&v.error(i.errors.token[0])},onFail:i=>v.error(i)})),c.setSubmitting(!1)},T=r=>()=>{var p;let c="";const i=Object.keys(r)[0];if(i){c=i;const x=r[i];if(Array.isArray(x)){const N=x.findIndex(a=>a!=null);if(N!==-1){c=`${i}[${N}]`;const a=x[N];if(a){const s=Object.keys(a)[0];c=`${c}.${s}`,(p=document.body.querySelector(`[name="${c}"]`))==null||p.scrollIntoView({block:"center"})}}}}};return e.jsx(H,{initialValues:_,validationSchema:ee,onSubmit:O,children:({values:r,isSubmitting:c,errors:i})=>e.jsxs(J,{className:"flex flex-col gap-4 w-full max-w-5xl mx-auto",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl leading-none font-semibold mb-1 ml-2",children:r.children.length>1?"Дети":"Ребенок"}),e.jsx(C,{name:"children",children:({push:p,remove:x})=>e.jsxs("div",{className:f("flex flex-col gap-3 bg-white border rounded-md shadow",r.children.length>1?"px-4 py-2 ":"px-8 py-4"),children:[r.children.map((N,a)=>e.jsxs("fieldset",{className:f("relative grid gap-3 md:grid-cols-2 lg:grid-cols-3 rounded",r.children.length>1&&"border border-gray-300 p-4"),children:[e.jsxs("legend",{className:f("px-1",r.children.length<=1&&"hidden"),children:["Ребенок ",a+1]}),r.children.length>1&&e.jsx($,{className:"!absolute right-1 -top-2",icon:"close",variant:"light",onClick:()=>x(a),children:e.jsx("span",{className:"sr-only",children:"Удалить ребенка"})}),e.jsx(l,{name:`children[${a}].name`,label:"Имя",required:!0}),e.jsx(l,{name:`children[${a}].surname`,label:"Фамилия",required:!0}),e.jsx(l,{className:"md:col-span-2 lg:col-span-1",name:`children[${a}].patronymic`,label:"Отчество (если имеется)"}),e.jsx(l,{name:`children[${a}].birth_date`,label:"Дата рождения",type:"date",required:!0}),e.jsx(b,{name:`children[${a}].sex`,label:"Пол",options:["male","female"].map(s=>({value:s,label:E[s]})),required:!0}),t.data&&e.jsx(b,{name:`children[${a}].nationality_id`,label:"Национальность",options:t.data.map(({id:s,name:q})=>({value:s,label:q})),required:!0}),m.data&&e.jsx(b,{name:`children[${a}].grade_id`,label:"Класс",options:m.data.map(s=>({value:s.id,label:`${s.level} ${s.group}`})),required:!0}),e.jsx(l,{className:"md:col-span-2",name:`children[${a}].admission_date`,label:"С какого года ребенок обучается в ЧОУ «Империя знаний»",type:"date",required:!0}),e.jsx(L,{className:"md:col-span-2 lg:col-span-3",name:`children[${a}].previous_schools`,label:"Перечислите предыдущие школы",placeholder:"Если нет — пишите «Нет»",required:!0}),e.jsx(L,{className:"md:col-span-2 lg:col-span-3",name:`children[${a}].medical_recommendations`,label:"Медицинские и психологические рекомендации для ребенка",placeholder:"Если нет — пишите «Нет»",required:!0})]},a)),e.jsxs($,{className:"justify-center leading-none !w-full shadow-none border !bg-gray-50 border-dashed border-gray-300 mt-1 text-gray-500 hover:border-gray-500",icon:"add",variant:"light",onClick:()=>p(_.children[0]),children:["Добавить ",ae[r.children.length+1]," ребенка"]})]})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl leading-none font-semibold mb-1 ml-2",children:r.parents.length>1?"Родители":"Родитель"}),e.jsx(C,{name:"parents",children:({push:p,remove:x})=>e.jsxs("div",{className:f("flex flex-col gap-3 bg-white border rounded-md shadow",r.parents.length>1?"px-4 py-2 ":"px-8 py-4 "),children:[r.parents.map((N,a)=>e.jsxs("fieldset",{className:f("relative grid gap-3 md:grid-cols-2 lg:grid-cols-3 rounded",r.parents.length>1&&"border border-gray-300 p-4"),children:[e.jsxs("legend",{className:f("px-1",r.parents.length<=1&&"hidden"),children:["Родитель ",a+1]}),r.parents.length>1&&e.jsx($,{className:"!absolute right-1 -top-2",icon:"close",variant:"light",onClick:()=>x(a),children:e.jsx("span",{className:"sr-only",children:"Удалить родителя"})}),e.jsx(l,{name:`parents[${a}].name`,label:"Имя",required:!0}),e.jsx(l,{name:`parents[${a}].surname`,label:"Фамилия",required:!0}),e.jsx(l,{className:"md:col-span-2 lg:col-span-1",name:`parents[${a}].patronymic`,label:"Отчество (если имеется)"}),e.jsx(l,{name:`parents[${a}].birth_date`,label:"Дата рождения",type:"date",required:!0}),e.jsx(b,{name:`parents[${a}].sex`,label:"Пол",options:["male","female"].map(s=>({value:s,label:E[s]})),required:!0}),t.data&&e.jsx(b,{name:`parents[${a}].nationality_id`,label:"Национальность",options:t.data.map(({id:s,name:q})=>({value:s,label:q})),required:!0}),d.data&&e.jsx(b,{name:`parents[${a}].profession_id`,label:"Сфера деятельности",options:d.data.map(({id:s,name:q})=>({value:s,label:q})),required:!0}),e.jsx(l,{name:`parents[${a}].workplace`,label:"Место работы",required:!0}),e.jsx(l,{name:`parents[${a}].position`,label:"Должность",required:!0}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(I,{label:"Телефон",required:!0}),e.jsxs("div",{className:"flex gap-1 w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:`parents[${a}].tel.code`,placeholder:"Код",required:!0}),e.jsx("span",{className:"absolute top-1/2 left-3 -translate-y-1/2 text-xl",children:"+"})]}),e.jsx(l,{className:"w-[120px] grow",type:"number",name:`parents[${a}].tel.numbers`,placeholder:"Номер",required:!0})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(I,{label:"WhatsApp",required:!0}),e.jsxs("div",{className:"flex gap-1 w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:`parents[${a}].whatsapp.code`,placeholder:"Код",required:!0}),e.jsx("span",{className:"absolute top-1/2 left-3 -translate-y-1/2 text-xl",children:"+"})]}),e.jsx(l,{className:"w-[120px] grow",type:"number",name:`parents[${a}].whatsapp.numbers`,placeholder:"Номер",required:!0})]})]}),e.jsx(l,{className:"md:order-1 lg:order-none",type:"email",name:`parents[${a}].email`,label:"E-mail (если имеется)"}),e.jsx(l,{className:"lg:col-span-2",name:`parents[${a}].address.physical_address`,label:"Адрес проживания (фактический)",required:!0}),e.jsx(b,{name:`parents[${a}].address.region`,label:"Район",options:Q.map(s=>({value:s,label:s})),required:!0})]},a)),r.parents.length===1&&e.jsx($,{className:"justify-center leading-none !w-full shadow-none border !bg-gray-50 border-dashed border-gray-300 mt-1 text-gray-500 hover:border-gray-500",icon:"add",variant:"light",onClick:()=>p(_.parents[0]),children:"Добавить второго родителя"})]})})]}),e.jsx($,{className:"justify-center",type:"submit",disabled:c,loading:c,onClick:T(i),children:"Зарегистрироваться"})]})},h)}function Ne(){const g=P(),[o]=B(),t=o.get("token"),[d,m]=y.useState(null);if(y.useEffect(()=>{t&&!d&&g(K({token:t,onSuccess:w=>m(w),onFail:()=>m({expiresAt:S().format("YYYY-MM-DD"),token:t,id:0})}))},[g,d,t]),!d)return e.jsx("div",{className:"w-screen h-screen flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8"})});const h=S(d.expiresAt).diff(S(),"second");return h<=0?e.jsxs("main",{className:"flex flex-col min-h-screen p-4 pb-40 md:px-6 lg:px-8",children:[e.jsx(R,{secondsLeft:h}),e.jsx(F,{className:"mx-auto mb-4"}),e.jsxs("section",{className:"leading-[1.2] border border-dashed rounded-md border-orange-300 max-w-[610px] mx-auto px-8 py-4 mb-6",children:[e.jsx("h2",{className:"uppercase text-danger mb-2",children:"Срок действия вашей ссылки истек! "}),e.jsxs("p",{children:["Срок действия вашей ссылки истек. Для получения новой ссылки напишите ",e.jsx("a",{className:"text-blue-600 underline underline-offset-2",href:"https://wa.me/+992918339939",target:"_blank",children:"администратору"}),"."]})]})]}):e.jsxs("main",{className:"flex flex-col min-h-screen p-4 pb-40 md:px-6 lg:px-8",children:[e.jsx(R,{secondsLeft:h}),e.jsx(F,{className:"mx-auto mb-4"}),e.jsxs("section",{className:"leading-[1.2] border border-dashed rounded-md border-orange-300 max-w-[610px] mx-auto px-8 py-4 mb-6",children:[e.jsx("h2",{className:"uppercase text-danger inline",children:"Внимание! "}),e.jsxs("p",{className:"inline",children:["Вся информация, внесенная в данную форму, редактированию не подлежит. В случае необходимости внесения изменений или дополнений обратитесь к ",e.jsx("a",{className:"text-blue-600 underline underline-offset-2",href:"https://wa.me/+992918339939",target:"_blank",children:"администратору"}),"."]})]}),t&&e.jsx(se,{token:t})]})}export{Ne as default};
