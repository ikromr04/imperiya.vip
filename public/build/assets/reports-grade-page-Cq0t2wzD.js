import{f as $,r as h,a as G,u as p,i as u,v as y,n as M,Y as w,j as s,S as A,A as j,L as E,X as _}from"./main-BjKjkFnO.js";import{B as R}from"./breadcrumbs-CzH_7Pz9.js";import{B as F}from"./button-C0MfaOJU.js";import{D as B}from"./description-list-DhGr_30r.js";import{R as D}from"./users-DUqPc0QS.js";import{g as U,a as L}from"./grades-selector-vTNl7uIh.js";import{g as O,a as P}from"./users-selector-5OWV2O4j.js";import{e as z}from"./reports-Ca94wfXG.js";import"./preload-helper-BfFHrpNk.js";import"./icons-2GKCzqG_.js";import"./FileSaver.min-Bu_h6g19.js";function Z(){const v=$(),[l,N]=h.useState(),c=G(),f=p(O),g=p(U),m=p(P),i=p(L),r=(i==null?void 0:i.find(a=>a.id===+(v.id||0)))||null,o=r&&m?m.filter(a=>{var t;return a.role==="student"&&((t=a.student)==null?void 0:t.gradeId)===(r==null?void 0:r.id)}):void 0;h.useEffect(()=>{f===u.Idle&&c(y()),g===u.Idle&&c(M())},[c,g,f]),h.useEffect(()=>{!l&&o&&c(w({ids:o.map(({id:a})=>a),onSuccess:a=>N(a)}))},[c,l,o]);const d=h.useMemo(()=>{const a={};if(l&&i&&m)return l.forEach(t=>{!a[t.studentId]&&(t.score1||t.score2)&&(a[t.studentId]=[]),t.score1&&a[t.studentId].push(t.score1),t.score2&&a[t.studentId].push(t.score2)}),a},[i,l,m]),n=h.useMemo(()=>{if(d&&r&&o){const a=o.map(e=>{const x=d[e.id]?d[e.id].reduce((b,S)=>b+S,0)/d[e.id].length:0;return{id:e.id,name:`${e.surname} ${e.name} ${e.patronymic||""}`,average:x,rounded:Math.round(x)}}),t={excellent:a.filter(e=>e.average&&Math.round(e.average)===5),good:a.filter(e=>e.average&&Math.round(e.average)===4),average:a.filter(e=>e.average&&Math.round(e.average)===3),poor:a.filter(e=>e.average&&Math.round(e.average)===2),noGrades:a.filter(e=>!e.average)};return{classInfo:{class:`${r.level}${r.group}`,totalStudents:o.length,girls:o.filter(({sex:e})=>e==="female"),boys:o.filter(({sex:e})=>e==="male"),excellent:{count:t.excellent.length,percent:+(t.excellent.length*100/o.length).toFixed(2)},good:{count:t.good.length,percent:+(t.good.length*100/o.length).toFixed(2)},average:{count:t.average.length,percent:+(t.average.length*100/o.length).toFixed(2)},poor:{count:t.poor.length,percent:+(t.poor.length*100/o.length).toFixed(2)},noGrades:{count:t.noGrades.length,percent:+(t.noGrades.length*100/o.length).toFixed(2)}},students:t}}},[r,d,o]),I={excellent:"Отличники",good:"Четвёрочники",average:"Троечники",poor:"Двоечники",noGrades:"Без оценок"};return n?s.jsxs("main",{className:"pt-2 pb-40 flex flex-col",children:[s.jsxs("h1",{className:"title",children:["Класс ",n.classInfo.class]}),s.jsx(R,{items:[["Отчеты",j.Reports.Index],[`${n.classInfo.class}`,""]]}),s.jsx(F,{className:"max-h-7 ml-auto mb-2",icon:"fileExport",variant:"light",onClick:()=>z(n),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),s.jsxs("section",{className:"box",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:"Общая информация"})}),s.jsxs("div",{className:"relative",children:[s.jsx(B,{className:"box__body",list:{"Количество учеников":s.jsxs("div",{className:"flex justify-between gap-8",children:[n.classInfo.totalStudents," (девочек ",n.classInfo.girls.length," / мальчиков ",n.classInfo.boys.length,")",s.jsx("div",{className:"flex flex-col",children:D.map(a=>s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:a})," (девочек ",n.classInfo.girls.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===a}).length," / мальчиков ",n.classInfo.boys.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===a}).length,")"]}))})]}),Отличники:`${n.classInfo.excellent.count} (${n.classInfo.excellent.percent}%)`,Четвёрочники:`${n.classInfo.good.count} (${n.classInfo.good.percent}%)`,Троечники:`${n.classInfo.average.count} (${n.classInfo.average.percent}%)`,Двоечники:`${n.classInfo.poor.count} (${n.classInfo.poor.percent}%)`,"Без оценок":`${n.classInfo.noGrades.count} (${n.classInfo.noGrades.percent}%)`}}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]}),Object.entries(I).map(([a,t])=>s.jsxs("section",{className:"box mt-4",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:t})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"box__body",children:n.students[a].length?s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[320px]",children:"ФИО"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[140px]",children:"Средний балл"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[160px]",children:"Округлённая оценка"})]})}),s.jsx("tbody",{children:n.students[a].map(e=>{var x;return s.jsxs("tr",{className:"py-1",children:[s.jsx("td",{className:"pr-10",children:s.jsx(E,{className:"text-blue-600",to:_(j.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:(x=e.average)==null?void 0:x.toFixed(2)}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:e.rounded})]},e.id)})})]}):"Нет учеников"}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]},a))]}):s.jsx(A,{className:"w-8 h-8 m-2"})}export{Z as default};
