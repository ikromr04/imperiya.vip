import{a as b,r as o,j as s,S as N,c as v,L as w,X as y,A as S}from"./main-C3zapZtd.js";import{S as _}from"./select-field-Bpw18Q_d.js";import{f as p,S as I}from"./leadership-PZG2RdTk.js";import{P as j}from"./pusher-vt2aPqwX.js";import"./preload-helper-BfFHrpNk.js";import"./use-dropdown-idH_Ahq5.js";import"./icons-CmdP5zNp.js";function P(){const f=b(),[r,x]=o.useState(),[u,g]=o.useState("0");o.useEffect(()=>{r||f(p({onSuccess:e=>x(e)}))},[r,f]),o.useEffect(()=>{j.logToConsole=!0;const l=new j("4176f4643166a8116c5b",{cluster:"ap1"}).subscribe("mark.channel");return l.bind("mark.events",()=>{f(p({onSuccess:t=>x(t)}))}),()=>{l.unbind_all(),l.unsubscribe()}},[f]);let m=o.useMemo(()=>{if(r){const e={};return r.marks.forEach(t=>{e[t.studentId]||(e[t.studentId]=[]),t.score1&&e[t.studentId].push(t.score1),t.score2&&e[t.studentId].push(t.score2)}),r.users.map(t=>{var n,i;const a=r.grades.find(({id:c})=>{var h;return c===(((h=t.student)==null?void 0:h.gradeId)||0)}),d=(n=e[t.id])==null?void 0:n.reduce((c,h)=>c+=I[h],0);return{id:t.id,avatar:t.avatarThumb,gradeId:((i=t.student)==null?void 0:i.gradeId)||"",name:`${t.surname} ${t.name} ${t.patronymic??""}`,grade:a?`${a==null?void 0:a.level} "${a==null?void 0:a.group}"`:"",score:d}}).sort((t,a)=>{const d=t.score,n=a.score,i=d==null,c=n==null;return i&&!c?1:!i&&c?-1:i&&c?0:n-d})}},[r]);return!r||!m?s.jsx(N,{className:"w-4 h-4 mt-4"}):(u!=="0"&&(m=m.filter(e=>String(e.gradeId)===u)),s.jsxs("main",{className:"py-2 flex flex-col gap-2 pb-40",children:[s.jsxs("header",{className:"relative z-20 flex justify-between items-end",children:[s.jsx("h1",{className:"title px-3 !leading-none",children:"Рейтинг"}),s.jsx(_,{className:"w-40",options:[{value:"0",label:"Все классы"},...r.grades.map(e=>({value:e.id.toString(),label:`${e.level} ${e.group}`}))],value:u,onChange:e=>g(e),notNull:!0})]}),s.jsxs("table",{className:"flex flex-col bg-white shadow rounded border",children:[s.jsx("thead",{className:"sticky top-0 z-10 flex bg-[#efefef] font-medium shadow py-1 rounded-t",children:s.jsxs("tr",{className:"grid grid-cols-[40px_1fr_8fr_2fr_2fr] w-full",children:[s.jsx("th",{children:"№"}),s.jsx("th",{children:"Фото"}),s.jsx("th",{className:"text-start",children:"ФИО"}),s.jsx("th",{children:"Класс"}),s.jsx("th",{children:"Ранг"})]})}),s.jsx("tbody",{className:"relative z-0",children:m.map((e,l)=>s.jsxs("tr",{className:v("grid grid-cols-[40px_1fr_8fr_2fr_2fr] w-full py-1",l%2&&"bg-gray-50"),children:[s.jsxs("td",{className:"flex items-center justify-center",children:[l+1,"."]}),s.jsx("td",{className:"flex items-center justify-center",children:s.jsx("div",{className:"relative z-10 w-12 lg:mb-0",children:s.jsx("div",{children:s.jsx("img",{className:"block w-full h-full rounded-full object-cover border-[2px] border-white",src:e.avatar||"/images/avatar.png",width:144,height:144,alt:e.name})})})}),s.jsx("td",{className:"flex items-center text-lg",children:s.jsx(w,{className:"text-blue-600",to:y(S.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"flex items-center justify-center text-lg font-medium",children:e.grade}),s.jsx("td",{className:"flex items-center justify-center text-xl font-semibold text-blue-700",children:e.score})]},e.id))})]})]}))}export{P as default};
