import{r as o,u,j as e,q as j,y as x,c as f,t as k,v as w,a as h,w as y,x as N,z as v,S as A,p as g,A as m,B as S,N as b}from"./main-D1X-5qeh.js";import d from"./not-found-page-Dlt1yDD_.js";import{B as l}from"./button-BxcCnYcJ.js";import{D as L}from"./data-table-Nl3BCqN7.js";import{f as R}from"./index-Y5BpZlJY.js";import{M as C}from"./modal-COah0HVy.js";import{F,a as $}from"./formik.esm-CEA5_Xoc.js";import"./preload-helper-DPi8upcZ.js";import"./icons-Cwm3zsc5.js";import"./use-dropdown-BjzLPdm1.js";function I(n){const[s,t]=o.useState(n.secondsLeft);return o.useEffect(()=>{if(s<=0)return;const a=setInterval(()=>{t(i=>i-1)},1e3);return()=>clearInterval(a)},[s]),R(s)}function B(){const n=u(),[s,t]=o.useState(!1),a=()=>{t(!0),n(j({onSuccess:()=>t(!1),onFail:i=>{x.error(i),t(!1)}}))};return e.jsx(l,{icon:"add",variant:"success",onClick:a,disabled:s,loading:s,children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Сгенерировать"})})}function D({link:n}){const[s,t]=o.useState(!1),a=async()=>{try{await navigator.clipboard.writeText(n),t(!0),setTimeout(()=>t(!1),1500)}catch(i){console.log("Failed to copy: ",i)}};return e.jsx(l,{className:f(s&&"text-success"),icon:s?"checked":"copy",variant:"light",onClick:a,children:e.jsx("span",{className:"sr-only",children:"Скопировать ссылку"})})}function U({id:n}){const s=u(),[t,a]=o.useState(!1),i=()=>{a(!0),s(k({id:n,onSuccess:()=>a(!1),onFail:c=>{x.error(c),a(!1)}}))};return e.jsx(l,{icon:"autorenew",variant:"warning",onClick:i,disabled:t,loading:t,children:e.jsx("span",{className:"sr-only",children:"Обновить"})})}function E({id:n,setId:s}){const t=u(),a=async(i,c)=>{c.setSubmitting(!0),await t(w({id:n,onSuccess:()=>s(null),onFail:r=>x.error(r)})),c.setSubmitting(!1)};return e.jsx(F,{initialValues:{},onSubmit:a,children:({isSubmitting:i})=>e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удаление ссылки"}),e.jsx(l,{className:"ml-auto",type:"reset",icon:"close",variant:"danger",onClick:()=>s(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"mb-2",children:"Вы уверены что хотите удалить эту ссылку?"})}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(l,{className:"justify-center min-w-[92px]",type:"submit",disabled:i,loading:i,variant:"success",icon:"delete",children:"Удалить"})})]})},n)}function P(){var c;const n=u(),s=h(y),[t,a]=o.useState(null);o.useEffect(()=>{!s.data&&!s.isFetching&&n(N())},[n,s.data,s.isFetching]);const i=[{id:"expiresAt",accessorKey:"expiresAt",header:"Срок действия",size:320,cell:({row:r})=>{const p=g(r.original.expiresAt).diff(g(),"second");return e.jsx("div",{className:f("text-lg font-medium",p>0?"text-success":"text-danger"),children:e.jsx(I,{secondsLeft:p})})},meta:{columnClass:"!min-w-[160px] !w-[160px] !max-w-[160px]"}},{id:"token",accessorKey:"token",header:"Ссылка",cell:({row:r})=>e.jsx("a",{className:"text-blue-600",href:`${m.Auth.Register}?token=${r.original.token}`,target:"_blank",children:`${window.location.origin}${m.Auth.Register}?token=${r.original.token}`}),meta:{columnClass:"!min-w-[320px] !w-[320px] !max-w-[320px] sm:!min-w-[640px] sm:!w-[640px] sm:!max-w-[640px] lg:!min-w-[1524px] sm:!w-[1524px] sm:!max-w-[1524px]"}},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:200,cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{link:`${window.location.origin}${m.Auth.Register}?token=${r.original.token}`}),e.jsx(U,{id:r.original.id}),e.jsx(l,{icon:"delete",variant:"danger",onClick:()=>a(r.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]}),meta:{columnClass:"!min-w-[170px] !w-[170px] !max-w-[170px]"}}];return e.jsxs(v,{children:[e.jsxs("main",{className:"pt-4 pb-10",children:[e.jsxs("h1",{className:"title mb-1",children:["Ссылки для регистрации (",(c=s.data)==null?void 0:c.length,")"]}),s.data?e.jsx(L,{data:s.data,columns:i,sortingState:[{id:"expiresAt",desc:!1}],columnPinningState:{right:["actions"]},actions:e.jsx(B,{})}):e.jsx(A,{className:"w-8 h-8"})]}),e.jsx(C,{isOpen:!!t,children:t&&e.jsx(E,{id:t,setId:a})})]})}const T={superadmin:()=>e.jsx(P,{}),admin:()=>e.jsx(d,{}),director:()=>e.jsx(d,{}),teacher:()=>e.jsx(d,{}),parent:()=>e.jsx(d,{}),student:()=>e.jsx(d,{})};function Q(){const n=h(S);return n?T[n.role]():e.jsx(b,{to:m.Auth.Login})}export{Q as default};
