import{r as o,a as u,j as e,P as w,y as f,c as g,Q as k,R as y,u as h,T as N,g as A,U as b,S as v,t as p,A as m}from"./main-DzOvJ3Bl.js";import{B as l}from"./button-BK2ewXLd.js";import{D as S}from"./data-table-DhQGkLo7.js";import{f as R}from"./index-DnzxYe6g.js";import{M as C}from"./modal-1koiJ247.js";import{F as $,a as L}from"./formik.esm-Cpulkf5n.js";import"./preload-helper-BfFHrpNk.js";import"./icons-B5TgyNC1.js";import"./use-dropdown-D7UlQ3WZ.js";import"./index-D18-tjuz.js";function j(i){const[s,t]=o.useState(i.secondsLeft);return o.useEffect(()=>{if(s<=0)return;const n=setInterval(()=>{t(a=>a-1)},1e3);return()=>clearInterval(n)},[s]),R(s)}function F({id:i,setId:s}){const t=u(),n=async(a,c)=>{c.setSubmitting(!0),await t(w({id:i,onSuccess:()=>s(null),onFail:x=>f.error(x)})),c.setSubmitting(!1)};return e.jsx($,{initialValues:{},onSubmit:n,children:({isSubmitting:a})=>e.jsxs(L,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удаление ссылки"}),e.jsx(l,{className:"ml-auto",type:"reset",icon:"close",variant:"danger",onClick:()=>s(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"mb-2",children:"Вы уверены что хотите удалить эту ссылку?"})}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(l,{className:"justify-center min-w-[92px]",type:"submit",disabled:a,loading:a,variant:"success",icon:"delete",children:"Удалить"})})]})},i)}function I({link:i}){const[s,t]=o.useState(!1),n=async()=>{try{await navigator.clipboard.writeText(i),t(!0),setTimeout(()=>t(!1),1500)}catch(a){console.log("Failed to copy: ",a)}};return e.jsx(l,{className:g(s&&"text-success"),icon:s?"checked":"copy",variant:"light",onClick:n,children:e.jsx("span",{className:"sr-only",children:"Скопировать ссылку"})})}function B({id:i}){const s=u(),[t,n]=o.useState(!1),a=()=>{n(!0),s(k({id:i,onSuccess:()=>n(!1),onFail:c=>{f.error(c),n(!1)}}))};return e.jsx(l,{icon:"autorenew",variant:"warning",onClick:a,disabled:t,loading:t,children:e.jsx("span",{className:"sr-only",children:"Обновить"})})}function D(){const i=u(),[s,t]=o.useState(!1),n=()=>{t(!0),i(y({onSuccess:()=>t(!1),onFail:a=>{f.error(a),t(!1)}}))};return e.jsx(l,{icon:"add",variant:"success",onClick:n,disabled:s,loading:s,children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Сгенерировать"})})}function O(){var x;const i=u(),s=h(N),t=h(A),[n,a]=o.useState(null);o.useEffect(()=>{!s.data&&!s.isFetching&&i(b())},[i,s.data,s.isFetching]);let c=[{id:"expiresAt",accessorKey:"expiresAt",header:"Срок действия",size:320,cell:({row:r})=>{const d=p(r.original.expiresAt).diff(p(),"second");return e.jsx("div",{className:g("text-lg font-medium",d>0?"text-success":"text-danger"),children:e.jsx(j,{secondsLeft:d})})},meta:{columnClass:"!min-w-[160px] !w-[160px] !max-w-[160px]"}},{id:"token",accessorKey:"token",header:"Ссылка",cell:({row:r})=>e.jsx("a",{className:"text-blue-600",href:`${m.Auth.Register}?token=${r.original.token}`,target:"_blank",children:`${window.location.origin}${m.Auth.Register}?token=${r.original.token}`}),meta:{columnClass:"!min-w-[320px] !w-[320px] !max-w-[320px] sm:!min-w-[640px] sm:!w-[640px] sm:!max-w-[640px] lg:!min-w-[1524px] sm:!w-[1524px] sm:!max-w-[1524px]"}}];return(t==null?void 0:t.role)==="superadmin"&&(c=[{id:"expiresAt",accessorKey:"expiresAt",header:"Срок действия",size:320,cell:({row:r})=>{const d=p(r.original.expiresAt).diff(p(),"second");return e.jsx("div",{className:g("text-lg font-medium",d>0?"text-success":"text-danger"),children:e.jsx(j,{secondsLeft:d})})},meta:{columnClass:"!min-w-[160px] !w-[160px] !max-w-[160px]"}},{id:"token",accessorKey:"token",header:"Ссылка",cell:({row:r})=>e.jsx("a",{className:"text-blue-600",href:`${m.Auth.Register}?token=${r.original.token}`,target:"_blank",children:`${window.location.origin}${m.Auth.Register}?token=${r.original.token}`}),meta:{columnClass:"!min-w-[320px] !w-[320px] !max-w-[320px] sm:!min-w-[640px] sm:!w-[640px] sm:!max-w-[640px] lg:!min-w-[1524px] sm:!w-[1524px] sm:!max-w-[1524px]"}},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:200,cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{link:`${window.location.origin}${m.Auth.Register}?token=${r.original.token}`}),e.jsx(B,{id:r.original.id}),e.jsx(l,{icon:"delete",variant:"danger",onClick:()=>a(r.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]}),meta:{columnClass:"!min-w-[170px] !w-[170px] !max-w-[170px]"}}]),e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"pt-4 pb-10",children:[e.jsxs("h1",{className:"title mb-1",children:["Ссылки для регистрации (",(x=s.data)==null?void 0:x.length,")"]}),s.data?e.jsx(S,{data:s.data,columns:c,sortingState:[{id:"expiresAt",desc:!1}],columnPinningState:{right:["actions"]},actions:(t==null?void 0:t.role)==="superadmin"&&e.jsx(D,{})}):e.jsx(v,{className:"w-8 h-8"})]}),e.jsx(C,{isOpen:!!n,children:n&&e.jsx(F,{id:n,setId:a})})]})}export{O as default};
