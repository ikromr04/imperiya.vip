import{a as b,u as j,j as a,az as g,y as m}from"./main-DKRIU25v.js";import{B as p}from"./button-J2Iqlscs.js";import{S as l}from"./select-field-DtHzpE1V.js";import{a as h}from"./users-selector-CgHhQlPM.js";import{F as v,a as N}from"./formik.esm-DIqXr-O1.js";import{c as S,a as y,e as $}from"./index.esm-CjvMGvqH.js";import"./preload-helper-BfFHrpNk.js";import"./icons-Dws060uV.js";import"./cleanable-CuKwX42b.js";import"./use-dropdown-Cxrd9zmy.js";import"./index.browser-OxPLOBIU.js";const E=S().shape({level:$().required("Обязательное поле."),group:y().required("Обязательное поле.")});function D({grade:r,grades:d,setIsOpen:c}){const u=b(),t=j(h),o=t==null?void 0:t.filter(s=>{var i;return((i=s.student)==null?void 0:i.gradeId)===r.id}),x={id:r.id,level:r.level,group:r.group,teacher_id:r.teacherId,students:(o==null?void 0:o.map(({id:s})=>s))||[]},f=async(s,i)=>{if(i.setSubmitting(!0),d.some(e=>e.id!==s.id&&e.level===s.level&&e.group===s.group)){i.setErrors({level:"Выбранный класс уже существует.",group:" "});return}await u(g({dto:s,onSuccess:()=>{m.success("Данные успешно сохранены."),c(!1)},onValidationError:e=>i.setErrors({...e.errors}),onFail:e=>m.success(e)})),i.setSubmitting(!1)};if(t)return a.jsx(v,{initialValues:x,validationSchema:E,onSubmit:f,children:({isSubmitting:s,values:i})=>{var n;return a.jsxs(N,{children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[a.jsx("h3",{className:"title",children:"Редактирование класса"}),a.jsx(p,{className:"ml-auto",type:"reset",icon:"close",variant:"danger",onClick:()=>c(!1),children:a.jsx("span",{className:"sr-only",children:"Отмена"})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-x-4 mb-2",children:[a.jsx(l,{name:"level",label:"Уровень",options:[1,2,3,4,5,6,7,8,9,10,11].map(e=>({value:e,label:e.toString()}))}),a.jsx(l,{name:"group",label:"Группа",options:["А","Б","В","Г","Д","Е"].map(e=>({value:e,label:e.toString()}))})]}),a.jsx(l,{className:"mb-4",name:"teacher_id",searchable:!0,label:"Руководитель",options:(t==null?void 0:t.filter(e=>e.role==="teacher").map(e=>({value:e.id,label:`${e.surname} ${e.name}`})))||[]}),a.jsx(l,{className:"mb-4",name:"students",multiple:!0,searchable:!0,label:`Ученики (${(n=i.students)==null?void 0:n.length})`,options:(t==null?void 0:t.filter(e=>e.role==="student").map(e=>({value:e.id,label:`${e.surname} ${e.name}`})))||[]}),a.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:a.jsx(p,{className:"justify-center min-w-[92px]",type:"submit",icon:"update",disabled:s,loading:s,variant:"success",children:"Сохранить"})})]})}})}export{D as default};
