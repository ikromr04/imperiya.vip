import{a as k,u as x,r as f,j as e,ak as z,y as j,al as I,am as K,i as w,an as R,a7 as $,S as L,L as M}from"./main-Bv3hUDlE.js";import{D as P}from"./data-table-DYZL0fwY.js";import{B as o}from"./button-CLhFIVpf.js";import{M as V}from"./modal-Ds3mSBEq.js";import{a as B,b as G,g as H,c as J}from"./books-selector-DiTYnA5N.js";import{C as F}from"./content-field-Dg6kfmr_.js";import{S as b}from"./select-field-CyyDQ2yq.js";import{T as N}from"./text-field-BcnIF0Fw.js";import{A as T,a as Q}from"./books-BmVPUTHd.js";import{F as q,a as D}from"./formik.esm-BX1ESkeW.js";import{c as E,a as h,e as C}from"./index.esm-Dc9HbSVZ.js";import"./preload-helper-BfFHrpNk.js";import"./icons-CQR9b9Fl.js";import"./use-dropdown-BI5bdOKY.js";import"./index-CYtogc1c.js";import"./cleanable-BufJnOkS.js";import"./index.browser-OxPLOBIU.js";const U=E().shape({category_id:C().required("Обязательное поле.").min(1,"Обязательное поле."),title:h().required("Обязательное поле."),access:h().required("Обязательное поле."),lang:h().required("Обязательное поле.")});function W({dto:r,setDTO:c}){const d=k(),m=r,n=x(B),l=f.useRef(null),g=async(a,t)=>{var p,u;t.setSubmitting(!0);const s=new FormData;s.append("category_id",String(a.category_id)),s.append("title",a.title),s.append("access",a.access),s.append("lang",a.lang),(u=(p=l.current)==null?void 0:p.files)!=null&&u[0]&&s.append("file",l.current.files[0]),a.link&&s.append("link",a.link),a.description&&s.append("description",a.description),await d(z({formData:s,onSuccess:()=>{j.success("Книга успешно добавлена."),c(null)},onValidationError:i=>t.setErrors({...i.errors}),onFail:i=>j.success(i)})),t.setSubmitting(!1)};return e.jsx(q,{initialValues:m,validationSchema:U,onSubmit:g,children:({isSubmitting:a,setFieldValue:t})=>e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление книги"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>c(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(N,{className:"mb-4",name:"title",label:"Название",required:!0}),n&&e.jsx(b,{className:"mb-4",name:"category_id",label:"Укажите категорию",onChange:s=>t("category_id",s.value),options:n.map(s=>({value:s.id,label:s.title})),required:!0}),e.jsx(b,{className:"mb-4",name:"access",label:"Выберите доступность",onChange:s=>t("access",s.value),options:T,required:!0}),e.jsx(b,{className:"mb-4",name:"lang",label:"Укажите язык",onChange:s=>t("lang",s.value),options:["Русский","Таджикский","Английский","Немецкий"].map(s=>({value:s,label:s})),required:!0}),e.jsx(F,{className:"mb-4",name:"description",label:"Описание"}),e.jsx(N,{className:"mb-4",inputClassname:"!p-1 dassfas",name:"link",label:"Ссылка"}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"relative z-0 rounded flex leading-none mb-[2px] max-w-max text-sm text-gray-500 ml-2",children:"Загрузить книгу"}),e.jsx("div",{className:"relative flex",children:e.jsx("input",{ref:l,className:"flex grow bg-gray-50 min-w-0 border border-gray-200 rounded h-8 leading-none text-base focus:outline-none hover:bg-gray-100 focus:border-primary focus:bg-gray-100 p-1",type:"file",name:"file",accept:".pdf"})})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:a,loading:a,variant:"success",children:"Добавить"})})]})})}const X=E().shape({id:C().min(1,"Обязательное поле."),category_id:C().min(1,"Обязательное поле."),title:h().required("Обязательное поле."),access:h().required("Обязательное поле."),lang:h().required("Обязательное поле.")});function Y({dto:r,setDTO:c}){const d=k(),m=r,n=x(B),l=f.useRef(null),g=async(a,t)=>{var p,u;t.setSubmitting(!0);const s=new FormData;s.append("category_id",String(a.category_id)),s.append("title",a.title),s.append("access",a.access),s.append("lang",a.lang),(u=(p=l.current)==null?void 0:p.files)!=null&&u[0]&&s.append("file",l.current.files[0]),a.link&&s.append("link",a.link),a.description&&s.append("description",a.description),await d(I({id:a.id,formData:s,onSuccess:()=>{j.success("Книга успешно обновлена."),c(null)},onValidationError:i=>t.setErrors({...i.errors}),onFail:i=>j.success(i)})),t.setSubmitting(!1)};return e.jsx(q,{initialValues:m,validationSchema:X,onSubmit:g,children:({isSubmitting:a,setFieldValue:t})=>e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование книги"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>c(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(N,{className:"mb-4",name:"title",label:"Название",required:!0}),n&&e.jsx(b,{className:"mb-4",name:"category_id",label:"Укажите категорию",onChange:s=>t("category_id",s.value),options:n.map(s=>({value:s.id,label:s.title})),required:!0}),e.jsx(b,{className:"mb-4",name:"access",label:"Выберите доступность",onChange:s=>t("access",s.value),options:T,required:!0}),e.jsx(b,{className:"mb-4",name:"lang",label:"Укажите язык",onChange:s=>t("lang",s.value),options:["Русский","Таджикский","Английский","Немецкий"].map(s=>({value:s,label:s})),required:!0}),e.jsx(F,{className:"mb-4",name:"description",label:"Описание"}),e.jsx(N,{className:"mb-4",name:"link",label:"Ссылка"}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"relative z-0 rounded flex leading-none mb-[2px] max-w-max text-sm text-gray-500 ml-2",children:"Загрузить книгу"}),e.jsx("div",{className:"relative flex",children:e.jsx("input",{ref:l,className:"flex grow bg-gray-50 min-w-0 border border-gray-200 rounded h-8 leading-none text-base focus:outline-none hover:bg-gray-100 focus:border-primary focus:bg-gray-100 p-1",type:"file",name:"file",accept:".pdf"})})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:a,loading:a,variant:"success",children:"Сохранить"})})]})})}function Z({dto:r,setDTO:c}){const d=k(),m=async(n,l)=>{l.setSubmitting(!0),await d(K({id:r,onSuccess:()=>{j.success("Книга успешно удалена."),c(null)}})),l.setSubmitting(!1)};return e.jsx(q,{initialValues:{},onSubmit:m,children:({isSubmitting:n})=>e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удалить книгу"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>c(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:n,loading:n,variant:"success",children:"Удалить"})})]})})}function be(){const r=k(),c=x(G),d=x(H),m=x(J),n=x(B),[l,g]=f.useState(null),[a,t]=f.useState(null),[s,p]=f.useState(null);f.useEffect(()=>{c===w.Idle&&r(R()),d===w.Idle&&r($())},[c,d,r]);const u=[{id:"title",accessorKey:"title",header:"Название",size:360},{id:"category",accessorKey:"category",header:"Категория",size:360,cell:({row:i})=>{var y;return(y=n==null?void 0:n.find(({id:S})=>+S==+i.original.categoryId))==null?void 0:y.title},sortingFn:(i,y)=>{var _,A;const S=((_=n==null?void 0:n.find(({id:v})=>+v==+i.original.categoryId))==null?void 0:_.title)||"",O=((A=n==null?void 0:n.find(({id:v})=>+v==+y.original.categoryId))==null?void 0:A.title)||"";return S.localeCompare(O)}},{id:"access",accessorKey:"access",header:"Доступность",size:200,cell:({row:i})=>Q[i.original.access]},{id:"lang",accessorKey:"lang",header:"Язык",size:160},{id:"link",accessorKey:"link",header:"Ссылка",size:420,cell:({row:i})=>e.jsx(M,{className:"text-blue-500",to:i.original.link,target:"_blank",children:i.original.link})},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:i})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{icon:"edit",variant:"warning",onClick:()=>t({id:i.original.id,category_id:+i.original.categoryId,title:i.original.title,access:i.original.access,lang:i.original.lang,link:i.original.link,description:i.original.description}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(o,{icon:"delete",variant:"danger",onClick:()=>p(i.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"py-2",children:[e.jsxs("h1",{className:"title mb-1 px-3",children:["Книги (",n==null?void 0:n.length,")"]}),m?e.jsx(P,{data:m,columns:u,sortingState:[{id:"title",desc:!1}],columnPinningState:{right:["actions"]},actions:e.jsx(o,{icon:"add",variant:"success",onClick:()=>g({category_id:0,title:"",access:"all",lang:""}),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(L,{className:"w-8 h-8"})]}),e.jsxs(V,{isOpen:!!(l||a||s),children:[l&&e.jsx(W,{dto:l,setDTO:g}),a&&e.jsx(Y,{dto:a,setDTO:t}),s&&e.jsx(Z,{dto:s,setDTO:p})]})]})}export{be as default};
