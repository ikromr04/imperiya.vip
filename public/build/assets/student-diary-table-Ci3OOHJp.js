import{a as z,u as x,g as I,r as l,i as k,C as A,v as L,a6 as C,a7 as E,j as s,S as _,t as e,c as w}from"./main-DOJC8ST-.js";import{H,L as R}from"./lesson-hour-CWCHPqaI.js";import{I as f}from"./icons-BUoiBP0X.js";import{b as U,c as N}from"./index-onqUwJuH.js";import{g as W,a as T}from"./subjects-selector-Dfm9hxSf.js";import{g as q,a as F}from"./users-selector-BjidioDu.js";import{D as O}from"./diary-item-C19DTdv5.js";function V({user:a}){var S;const n=z(),c=x(I),y=x(W),Y=x(q),M=x(T),h=x(F),[m,i]=l.useState(null),[D,v]=l.useState(null),[d,b]=l.useState(0),o=U(d),j=l.useRef(null);l.useEffect(()=>{y===k.Idle&&n(A()),Y===k.Idle&&n(L())},[n,y,Y]),l.useEffect(()=>{var t,r;!m&&c&&n(C({week:d,gradeId:((t=a==null?void 0:a.student)==null?void 0:t.gradeId)||((r=c.student)==null?void 0:r.gradeId),onSuccess:p=>{i(p),n(E({lessons:p.map(({id:g})=>g),onSuccess:g=>v(g)}))}}))},[c,n,m,(S=a==null?void 0:a.student)==null?void 0:S.gradeId,d]);const u=t=>{if(j.current){const{scrollLeft:r}=t.currentTarget;j.current.querySelectorAll(".sync-scroll").forEach(p=>{p.scrollLeft=r})}};return!m||!h?s.jsx(_,{className:"w-8 h-8"}):s.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)]",children:[s.jsxs("table",{ref:j,className:"flex flex-col w-full",children:[s.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:s.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[s.jsx(f.calendar,{className:"relative top-[1px]",height:16}),N(e(o[0]).format("MMMM - YYYY")),e(o[0]).format("M")!==e(o[5]).format("M")&&` - ${N(e(o[5]).format("MMMM"))}`]})}),s.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:u,children:s.jsxs("tr",{children:[s.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),s.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),s.jsx("th",{className:"min-w-20 w-20 max-w-20"}),s.jsx("th",{className:"p-2 min-w-[260px] w-[260px] max-w-[260px] text-start",children:"Предмет"}),s.jsx("th",{className:"p-2 min-w-[120px] w-[120px] max-w-[120px] text-start",children:"Посещаемость"}),s.jsx("th",{className:"p-2 min-w-20 w-20 max-w-20 text-center font-bold",children:"Оценка"}),s.jsx("th",{className:"p-2 min-w-[360px] w-[360px] max-w-[360px] text-start",children:"Комментарий"}),s.jsx("th",{className:"p-2 min-w-[288px] w-[288px] max-w-[288px] text-start",children:"Домашнее задание"}),s.jsx("th",{className:"p-2 min-w-[288px] w-[288px] max-w-[288px] text-start",children:"Тема урока"}),s.jsx("th",{className:"p-2 min-w-[320px] w-[320px] max-w-[320px] text-start",children:"Педагог"})]})}),s.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:u,children:o.map(t=>s.jsxs(l.Fragment,{children:[s.jsx("tr",{className:w("border-b",e(t).format("YYYY-MM-DD")===e().format("YYYY-MM-DD")&&"bg-green-50"),children:s.jsx("td",{className:w("min-w-7 w-7 max-w-7 sticky left-0 z-10",e(t).format("YYYY-MM-DD")===e().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),rowSpan:9,children:s.jsx("div",{className:"absolute left-1/2 top-1/2 flex gap-2 min-w-max text-blue-700 -translate-x-1/2 -translate-y-1/2 -rotate-90",children:N(t.format("dddd - DD"))})})}),Object.keys(H).map(r=>s.jsxs("tr",{className:w("min-h-10 h-10 border-b",e(t).format("YYYY-MM-DD")===e().format("YYYY-MM-DD")&&"bg-green-50"),children:[s.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-7 z-10",children:s.jsx("div",{className:w("absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",e(t).format("YYYY-MM-DD")===e().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:r})}),s.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:s.jsx(R,{hour:+r})}),M&&h&&D&&s.jsx(O,{date:e(t).format(),hour:+r,lessons:m,subjects:M,marks:D,users:h,studentId:(a==null?void 0:a.id)||(c==null?void 0:c.id)||0})]},r))]},t.format("YYYY-MM-DD")))}),s.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:u,children:s.jsxs("tr",{children:[s.jsx("td",{className:"p-0 min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),s.jsx("td",{className:"p-0 min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),s.jsx("td",{className:"p-0 min-w-20 w-20 max-w-20"}),s.jsx("td",{className:"p-0 border-t min-w-[260px] w-[260px] max-w-[260px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[120px] w-[120px] max-w-[120px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-20 w-20 max-w-20 text-center font-bold"}),s.jsx("td",{className:"p-0 border-t min-w-[360px] w-[360px] max-w-[360px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[288px] w-[288px] max-w-[288px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[288px] w-[288px] max-w-[288px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[320px] w-[320px] max-w-[320px] text-start"})]})})]}),s.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:s.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{b(t=>t-1),i(null)},children:[s.jsx(f.previous,{width:7}),s.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),d!==0&&s.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{b(0),i(null)},children:[s.jsx(f.currentWeek,{width:16,height:16}),s.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{b(t=>t+1),i(null)},children:[s.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),s.jsx(f.next,{width:7})]})]})})]})}export{V as S};
