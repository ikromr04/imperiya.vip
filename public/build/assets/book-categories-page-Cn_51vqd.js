import{a as u,j as e,a4 as v,y as d,a5 as C,a6 as k,u as j,g as B,r as m,i as D,a7 as F,S as w}from"./main-DzOvJ3Bl.js";import{D as E}from"./data-table-DhQGkLo7.js";import{B as o}from"./button-BK2ewXLd.js";import{M as T}from"./modal-1koiJ247.js";import{g as A,a as O}from"./books-selector-DOc_U6u5.js";import{T as N}from"./text-field-yJsTwbK9.js";import{F as h,a as g}from"./formik.esm-Cpulkf5n.js";import{c as b,a as S}from"./index.esm-BCp_SAnH.js";import"./preload-helper-BfFHrpNk.js";import"./icons-B5TgyNC1.js";import"./use-dropdown-D7UlQ3WZ.js";import"./index-D18-tjuz.js";import"./cleanable-37L1pogH.js";import"./index.browser-OxPLOBIU.js";const V=b().shape({title:S().required("Обязательное поле.")});function q({dto:r,setDTO:i}){const t=u(),a={title:r.title},n=async(s,l)=>{l.setSubmitting(!0),await t(v({title:s.title,onSuccess:()=>{d.success("Категория успешно добавлена."),i(null)},onValidationError:c=>l.setErrors({...c.errors}),onFail:c=>d.success(c)})),l.setSubmitting(!1)};return e.jsx(h,{initialValues:a,validationSchema:V,onSubmit:n,children:({isSubmitting:s})=>e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление категории"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>i(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(N,{className:"mb-4",name:"title",label:"Название",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Добавить"})})]})})}const z=b().shape({title:S().required("Обязательное поле.")});function K({dto:r,setDTO:i}){const t=u(),a={id:r.id,title:r.title},n=async(s,l)=>{l.setSubmitting(!0),await t(C({dto:s,onSuccess:()=>{d.success("Категория успешно обновлена."),i(null)},onValidationError:c=>l.setErrors({...c.errors}),onFail:c=>d.success(c)})),l.setSubmitting(!1)};return e.jsx(h,{initialValues:a,validationSchema:z,onSubmit:n,children:({isSubmitting:s})=>e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>i(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(N,{className:"mb-4",name:"title",label:"Название",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Сохранить"})})]})})}function $({dto:r,setDTO:i}){const t=u(),a=async(n,s)=>{s.setSubmitting(!0),await t(k({id:r,onSuccess:()=>{d.success("Категория успешно удалена."),i(null)}})),s.setSubmitting(!1)};return e.jsx(h,{initialValues:{},onSubmit:a,children:({isSubmitting:n})=>e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удалить категорию"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>i(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:n,loading:n,variant:"success",children:"Удалить"})})]})})}function U(){const r=u(),i=j(A),t=j(B),a=j(O),[n,s]=m.useState(null),[l,c]=m.useState(null),[x,f]=m.useState(null);m.useEffect(()=>{i===D.Idle&&r(F())},[i,r]);let y=[{id:"title",accessorKey:"title",header:"Название",size:1686}];return(t==null?void 0:t.role)==="superadmin"&&(y=[{id:"title",accessorKey:"title",header:"Название",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:p})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{icon:"edit",variant:"warning",onClick:()=>c({id:p.original.id,title:p.original.title}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(o,{icon:"delete",variant:"danger",onClick:()=>f(p.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})}]),e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"py-2",children:[e.jsxs("h1",{className:"title mb-1 px-3",children:["Категории книг (",a==null?void 0:a.length,")"]}),a?e.jsx(E,{data:a,columns:y,sortingState:[{id:"title",desc:!1}],columnPinningState:{right:["actions"]},actions:(t==null?void 0:t.role)==="superadmin"&&e.jsx(o,{icon:"add",variant:"success",onClick:()=>s({title:""}),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(w,{className:"w-8 h-8"})]}),e.jsxs(T,{isOpen:!!(n||l||x),children:[n&&e.jsx(q,{dto:n,setDTO:s}),l&&e.jsx(K,{dto:l,setDTO:c}),x&&e.jsx($,{dto:x,setDTO:f})]})]})}export{U as default};
