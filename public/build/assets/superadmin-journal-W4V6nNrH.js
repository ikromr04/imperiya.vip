import{u as E,j as e,y as C,r as R,c as I,a9 as J,aa as U,ab as X,a as S,a4 as A,ac as G,ad as Q,ae as Z,S as D,L as ee,E as se,A as te,p,n as ne,k as ae,M as re,D as le,a2 as ie}from"./main-D1X-5qeh.js";import{D as ce}from"./data-table-Nl3BCqN7.js";import{u as L}from"./use-dropdown-BjzLPdm1.js";import{I as B}from"./icons-Cwm3zsc5.js";import{c as M,a as oe,e as de}from"./index.esm-tVQjNZt4.js";import{B as F}from"./button-BxcCnYcJ.js";import{C as K}from"./content-field-Dj1tSyJD.js";import{S as H}from"./select-field-DvwSWDo-.js";import{A as P,s as ue,u as me,a as fe}from"./marks-api-actions-CIOOhDKh.js";import{F as _,a as z}from"./formik.esm-CEA5_Xoc.js";import{T as $}from"./text-field-D3e8nZd6.js";import{a as xe,b as he,c as pe}from"./lessons-selector-CUOHldBn.js";import{a as ge,R as b,b as je,g as be}from"./ratings-_RkKEnDw.js";import{a as ye,g as Ne}from"./grades-selector-CjDDihwd.js";import{a as we,g as Se}from"./subjects-selector-H4IosHxK.js";import{a as ve,g as Ce}from"./users-selector-Cpbhop2B.js";import"./preload-helper-DPi8upcZ.js";import"./cleanable-BYiEZa8s.js";import"./index.browser-OxPLOBIU.js";const qe=M().shape({attendance:oe().required("Укажите посещаемость.")});function Re({studentId:i,lessonId:o,onSuccess:d}){const s=E(),c={student_id:i,lesson_id:o,attendance:""},n=async(r,a)=>{a.setSubmitting(!0),await s(ue({dto:r,onSuccess:l=>{d&&d(l),C.success("Данные успешно сохранены.")},onValidationError:l=>a.setErrors({...l.errors}),onFail:l=>C.success(l)})),a.setSubmitting(!1)};return e.jsx(_,{initialValues:c,validationSchema:qe,onSubmit:n,children:({isSubmitting:r,setFieldValue:a,values:l})=>e.jsxs(z,{className:"flex flex-col px-2 gap-2",children:[e.jsx(H,{name:"attendance",label:"Посещаемость",onChange:f=>{const g=f.value;["P","L"].includes(g.toString())||a("score_1",null),a("attendance",g)},options:Object.entries(P).map(([f,g])=>({value:f,label:g}))}),l.attendance&&["P","L"].includes(l.attendance)&&e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsx($,{className:"grow min-w-0",name:"score_1",label:"Оценка 1"}),e.jsx("span",{className:"translate-y-2",children:"/"}),e.jsx($,{className:"grow min-w-0",name:"score_2",label:"Оценка 2"})]}),e.jsx(K,{name:"comment",label:"Комментарий"}),e.jsx("div",{className:"flex items-center justify-end gap-2 -mt-1",children:e.jsx(F,{className:"!h-8 bg-transparent !text-success shadow-none hover:!bg-transparent",type:"submit",disabled:r,loading:r,variant:"success",children:"Сохранить"})})]})})}function ke({mark:i,onSuccess:o}){const d=E(),s={id:i.id,score_1:i.score1,score_2:i.score2,attendance:i.attendance,comment:i.comment},c=async(n,r)=>{r.setSubmitting(!0),await d(me({dto:n,onSuccess:a=>{o&&o(a),C.success("Данные успешно сохранены.")},onValidationError:a=>r.setErrors({...a.errors}),onFail:a=>C.success(a)})),r.setSubmitting(!1)};return e.jsx(_,{initialValues:s,onSubmit:c,children:({isSubmitting:n,setFieldValue:r,values:a})=>e.jsxs(z,{className:"flex flex-col px-2 gap-2",children:[e.jsx(H,{name:"attendance",label:"Посещаемость",onChange:l=>{const f=l.value;["P","L"].includes(f.toString())||(r("score_1",null),r("score_2",null)),r("attendance",f)},options:Object.entries(P).map(([l,f])=>({value:l,label:f}))}),a.attendance&&["P","L"].includes(a.attendance)&&e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsx($,{className:"grow min-w-0",name:"score_1",label:"Оценка 1"}),e.jsx("span",{className:"translate-y-2",children:"/"}),e.jsx($,{className:"grow min-w-0",name:"score_2",label:"Оценка 2"})]}),e.jsx(K,{name:"comment",label:"Комментарий"}),e.jsx("div",{className:"flex items-center justify-end gap-2 -mt-1",children:e.jsx(F,{className:"!h-8 bg-transparent !text-success shadow-none hover:!bg-transparent",type:"submit",disabled:n,loading:n,variant:"success",children:"Сохранить"})})]})})}function V(i){const{ref:o,isOpen:d,setIsOpen:s,menuRef:c}=L(),[n,r]=R.useState(i.mark),a=async()=>{if(o.current&&c.current){await s(!d);const l=o.current.getBoundingClientRect();c.current.style.top=`${l.top+l.height+4}px`,c.current.style.left=`${l.left+l.width+4}px`;const f=c.current.getBoundingClientRect();f.right>window.innerWidth&&(c.current.style.transform=`translateX(-${f.right-window.innerWidth+32}px)`),f.bottom>window.innerHeight&&(c.current.style.top="auto",c.current.style.bottom="16px")}};return e.jsxs("div",{ref:o,className:"relative flex w-10 h-10 -m-2 p-2",children:[e.jsxs("button",{className:I("absolute left-0 top-0 flex justify-center items-center w-full h-full hover:bg-gray-100"),onClick:a,children:[n.score1??"",n.score1&&n.score2&&"/",n.score2??"",!n.score1&&!n.score2&&fe[n.attendance]]}),e.jsxs("div",{ref:c,className:I("fixed top-full z-30 min-w-52 max-w-52 flex-col py-1 bg-white rounded border shadow transform font-normal",d?"flex":"hidden"),children:[e.jsxs("div",{className:"flex justify-between items-center pl-2 pr-1",children:[e.jsx("h3",{className:"text-sm leading-none text-gray-400",children:i.studentName}),e.jsx("button",{className:"border rounded p-1 text-danger",type:"button",onClick:()=>s(!1),children:e.jsx(B.close,{width:10,height:10})})]}),e.jsx("hr",{className:"my-1"}),e.jsx(ke,{mark:n,onSuccess:l=>{r(l),s(!1)}})]})]})}function Ie({studentName:i,studentId:o,lessonId:d}){const{ref:s,isOpen:c,setIsOpen:n,menuRef:r}=L(),[a,l]=R.useState(),f=async()=>{if(s.current&&r.current){await n(!c);const g=s.current.getBoundingClientRect();console.log(g.bottom,window.innerHeight),r.current.style.top=`${g.top+g.height+4}px`,r.current.style.left=`${g.left+g.width+4}px`;const y=r.current.getBoundingClientRect();y.right>window.innerWidth&&(r.current.style.transform=`translateX(-${y.right-window.innerWidth+32}px)`),y.bottom>window.innerHeight&&(r.current.style.top="auto",r.current.style.bottom="16px")}};return a?e.jsx(V,{mark:a,studentName:i}):e.jsxs("div",{ref:s,className:"relative flex w-10 h-10 -m-2 p-2",children:[e.jsx("button",{className:I("absolute left-0 top-0 flex justify-center items-center w-full h-full hover:bg-gray-100"),onClick:f}),e.jsxs("div",{ref:r,className:I("fixed top-full z-30 min-w-52 max-w-52 flex-col py-1 bg-white rounded border shadow transform font-normal",c?"flex":"hidden"),children:[e.jsxs("div",{className:"flex justify-between items-center pl-2 pr-1",children:[e.jsx("h3",{className:"text-sm leading-none text-gray-400",children:i}),e.jsx("button",{className:"border rounded p-1 text-danger",type:"button",onClick:()=>n(!1),children:e.jsx(B.close,{width:10,height:10})})]}),e.jsx("hr",{className:"my-1"}),e.jsx(Re,{studentId:o,lessonId:d,onSuccess:g=>{l(g),n(!1)}})]})]})}function $e({lesson:i,setIsOpen:o,types:d}){const s=E(),c={id:i.id,topic:i.topic,homework:i.homework,type_id:i.typeId},n=async(r,a)=>{a.setSubmitting(!0),await s(J({dto:r,onSuccess:()=>{o(!1),C.success("Данные успешно сохранены.")},onValidationError:l=>a.setErrors({...l.errors}),onFail:l=>C.success(l)})),a.setSubmitting(!1)};return e.jsx(_,{initialValues:c,onSubmit:n,children:({isSubmitting:r,setFieldValue:a})=>e.jsxs(z,{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex justify-between items-center pl-2 pr-1",children:e.jsx("button",{className:"absolute right-1 top-1 border rounded p-1 text-danger",type:"button",onClick:()=>o(!1),children:e.jsx(B.close,{width:10,height:10})})}),e.jsx("hr",{className:"-mx-3"}),e.jsx($,{name:"topic",label:"Тема:"}),e.jsx($,{name:"homework",label:"Домашнее задание:"}),e.jsx(H,{name:"type_id",label:"Тип:",cleanable:!0,onClean:()=>a("type_id",null),options:d.map(l=>({value:l.id,label:l.name}))}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2 -mt-1",children:e.jsx(F,{className:"!h-8 bg-transparent !text-success shadow-none hover:!bg-transparent",type:"submit",disabled:r,loading:r,variant:"success",children:"Сохранить"})})]})})}function Ae({rating:i,onSuccess:o}){const d=E(),s={id:i.id,score:i.score},c=async(n,r)=>{r.setSubmitting(!0),await d(U({dto:n,onSuccess:a=>{o&&o(a),C.success("Данные успешно сохранены.")},onValidationError:a=>r.setErrors({...a.errors}),onFail:a=>C.success(a)})),r.setSubmitting(!1)};return e.jsx(_,{initialValues:s,onSubmit:c,children:({isSubmitting:n})=>e.jsxs(z,{className:"flex flex-col px-2 gap-2",children:[e.jsx($,{className:"grow",name:"score",label:"Оценка"}),e.jsx("div",{className:"flex items-center justify-end gap-2 -mt-1",children:e.jsx(F,{className:"!h-8 bg-transparent !text-success shadow-none hover:!bg-transparent",type:"submit",disabled:n,loading:n,variant:"success",children:"Сохранить"})})]})})}function v(i){const{ref:o,isOpen:d,setIsOpen:s,menuRef:c}=L(),[n,r]=R.useState(i.rating),a=async()=>{if(o.current&&c.current){await s(!d);const l=o.current.getBoundingClientRect();c.current.style.top=`${l.top+l.height+4}px`,c.current.style.left=`${l.left+l.width+4}px`;const f=c.current.getBoundingClientRect();f.right>window.innerWidth&&(c.current.style.transform=`translateX(-${f.right-window.innerWidth+32}px)`),f.bottom>window.innerHeight&&(c.current.style.top="auto",c.current.style.bottom="16px")}};return e.jsxs("div",{ref:o,className:"relative flex w-10 h-10 -m-2 p-2",children:[e.jsx("button",{className:I("absolute left-0 top-0 flex justify-center items-center w-full h-full hover:bg-gray-100"),onClick:a,children:n.score??""}),e.jsxs("div",{ref:c,className:I("fixed top-full z-30 min-w-52 max-w-52 flex-col py-1 bg-white rounded border shadow transform font-normal",d?"flex":"hidden"),children:[e.jsxs("div",{className:"flex justify-between items-center pl-2 pr-1",children:[e.jsx("h3",{className:"text-sm leading-none text-gray-400",children:i.studentName}),e.jsx("button",{className:"border rounded p-1 text-danger",type:"button",onClick:()=>s(!1),children:e.jsx(B.close,{width:10,height:10})})]}),e.jsx("hr",{className:"my-1"}),e.jsx(Ae,{rating:n,onSuccess:l=>{r(l),s(!1)}})]})]})}const Ee=M().shape({score:de().required("")});function _e({createDTO:i,onSuccess:o}){const d=E(),s={years:i.years,rating:i.rating,score:null,student_id:i.studentId,grade_id:i.gradeId,subject_id:i.subjectId},c=async(n,r)=>{r.setSubmitting(!0),await d(X({dto:n,onSuccess:a=>{o&&o(a),C.success("Данные успешно сохранены.")},onValidationError:a=>r.setErrors({...a.errors}),onFail:a=>C.success(a)})),r.setSubmitting(!1)};return e.jsx(_,{initialValues:s,validationSchema:Ee,onSubmit:c,children:({isSubmitting:n})=>e.jsxs(z,{className:"flex flex-col px-2 gap-2",children:[e.jsx($,{className:"grow",name:"score",label:"Оценка"}),e.jsx("div",{className:"flex items-center justify-end gap-2 -mt-1",children:e.jsx(F,{className:"!h-8 bg-transparent !text-success shadow-none hover:!bg-transparent",type:"submit",disabled:n,loading:n,variant:"success",children:"Сохранить"})})]})})}function q({studentName:i,createDTO:o}){const{ref:d,isOpen:s,setIsOpen:c,menuRef:n}=L(),[r,a]=R.useState(),l=async()=>{if(d.current&&n.current){await c(!s);const f=d.current.getBoundingClientRect();n.current.style.top=`${f.top+f.height+4}px`,n.current.style.left=`${f.left+f.width+4}px`;const g=n.current.getBoundingClientRect();g.right>window.innerWidth&&(n.current.style.transform=`translateX(-${g.right-window.innerWidth+32}px)`),g.bottom>window.innerHeight&&(n.current.style.top="auto",n.current.style.bottom="16px")}};return r?e.jsx(v,{rating:r,studentName:i}):e.jsxs("div",{ref:d,className:"relative flex w-10 h-10 -m-2 p-2",children:[e.jsx("button",{className:I("absolute left-0 top-0 flex justify-center items-center w-full h-full hover:bg-gray-100"),onClick:l}),e.jsxs("div",{ref:n,className:I("fixed top-full z-30 min-w-52 max-w-52 flex-col py-1 bg-white rounded border shadow transform font-normal",s?"flex":"hidden"),children:[e.jsxs("div",{className:"flex justify-between items-center pl-2 pr-1",children:[e.jsx("h3",{className:"text-sm leading-none text-gray-400",children:i}),e.jsx("button",{className:"border rounded p-1 text-danger",type:"button",onClick:()=>c(!1),children:e.jsx(B.close,{width:10,height:10})})]}),e.jsx("hr",{className:"my-1"}),e.jsx(_e,{createDTO:o,onSuccess:f=>{a(f),c(!1)}})]})]})}function ze({students:i,subjectId:o,gradeId:d,ratingDate:s}){const c=E(),n=S(xe),r=S(ge),a=S(he),l=S(pe),[f,g]=R.useState(null),[y,k]=R.useState(null),[N,O]=R.useState(null);if(R.useEffect(()=>{n===A.Idle&&c(G()),s&&!N&&r!==A.Loading&&c(Q({dto:{years:s.years,gradeId:d,subjectId:o},onSuccess:h=>O(h)})),!f&&a!==A.Loading&&c(Z({subjectId:o,gradeId:d,onSuccess:h=>{k(h),g(i.map(m=>({...h.reduce((u,x)=>{var T;const W=(T=x.marks)==null?void 0:T.find(Y=>Y.studentId===m.id);return u[`${x.date} ${x.hour}`]=W||"",u},{}),id:m.id,name:`${m.surname} ${m.name}`})))}}))},[c,d,f,a,n,s,N,r,i,o]),!f||!l||!y||!N)return e.jsx(D,{className:"w-8 h-8"});const j={quarter1:!1,quarter2:!1,semester1:!1,quarter3:!1,quarter4:!1,semester2:!1,annual:!1,assessment:!1,final:!1},w=[{id:"name",accessorKey:"name",header:"ФИО",size:240,cell:({row:h})=>e.jsx(ee,{to:se(te.Users.Show,{id:h.original.id}),children:h.original.name}),meta:{columnClass:"truncate",thClass:"items-end h-24"}},...y.reduce((h,m)=>(s!=null&&s.quarter1&&s.quarter1<m.date&&!j.quarter1&&(j.quarter1=!0,h.push({id:"quarter1",accessorKey:"quarter1",header:b.quarter1,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="quarter1"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"quarter1",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.quarter1})})}})),s!=null&&s.quarter2&&s.quarter2<m.date&&!j.quarter2&&(j.quarter2=!0,h.push({id:"quarter2",accessorKey:"quarter2",header:b.quarter2,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="quarter2"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"quarter2",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.quarter2})})}})),s!=null&&s.semester1&&s.semester1<m.date&&!j.semester1&&(j.semester1=!0,h.push({id:"semester1",accessorKey:"semester1",header:b.semester1,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="semester1"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"semester1",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.semester1})})}})),s!=null&&s.quarter3&&s.quarter3<m.date&&!j.quarter3&&(j.quarter3=!0,h.push({id:"quarter3",accessorKey:"quarter3",header:b.quarter3,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="quarter3"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"quarter3",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.quarter3})})}})),s!=null&&s.quarter4&&s.quarter4<m.date&&!j.quarter4&&(j.quarter4=!0,h.push({id:"quarter4",accessorKey:"quarter4",header:b.quarter4,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="quarter4"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"quarter4",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.quarter4})})}})),s!=null&&s.semester2&&s.semester2<m.date&&!j.semester2&&(j.semester2=!0,h.push({id:"semester2",accessorKey:"semester2",header:b.semester2,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="semester2"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"semester2",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.semester2})})}})),s!=null&&s.annual&&s.annual<m.date&&!j.annual&&(j.annual=!0,h.push({id:"annual",accessorKey:"annual",header:b.annual,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="annual"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"annual",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.annual})})}})),s!=null&&s.assessment&&s.assessment<m.date&&!j.assessment&&(j.assessment=!0,h.push({id:"assessment",accessorKey:"assessment",header:b.assessment,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="assessment"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"assessment",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.assessment})})}})),s!=null&&s.final&&s.final<m.date&&!j.final&&(j.final=!0,h.push({id:"final",accessorKey:"final",header:b.final,size:40,cell:({row:t})=>{const u=N.find(x=>x.rating==="final"&&x.studentId===t.original.id);return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(v,{studentName:t.original.name,rating:u})}):p(m.date)>p()?null:e.jsx(q,{studentName:t.original.name,createDTO:{years:s.years,rating:"final",studentId:t.original.id,gradeId:d,subjectId:o}})},enableSorting:!1,meta:{columnClass:"border-r text-blue-600",thClass:"items-end font-medium text-blue-600",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:b.final})})}})),h.push({id:`${m.date} ${m.hour}`,accessorKey:m.date,header:m.date,size:40,cell:({row:t})=>{const u=t.original[`${m.date} ${m.hour}`];return u?e.jsx("div",{className:"flex items-center justify-center -m-2 p-2",children:e.jsx(V,{mark:u,studentName:t.original.name},u.id)}):p(m.date)>p()?null:e.jsx(Ie,{studentName:t.original.name,studentId:t.original.id,lessonId:m.id})},enableSorting:!1,meta:{columnClass:p(m.date).format("YYYY-MM-DD")===p().format("YYYY-MM-DD")?"!bg-green-50 border-r":"border-r",thClass:"items-end font-medium",renderHeader:()=>e.jsx("span",{className:"relative flex items-end w-6 h-20",children:e.jsx("span",{className:"absolute w-24 h-10 top-[calc(100%+8px)] -left-2 -rotate-90 origin-top-left flex items-center justify-center",children:m.date})}),renderFilter:(t,u)=>e.jsx($e,{lesson:m,types:l,setIsOpen:u})}}),h),[])];return e.jsx(ce,{data:f,columns:w,pageSize:50,columnPinningState:{left:["name"],right:[]},sortingState:[{id:"name",desc:!1}]})}function es(){const i=E(),o=S(ye),d=S(ve),s=S(we),c=S(je),n=S(Ne),r=S(Ce),a=S(Se),l=S(be),[f,g]=ne(),y=f.get("gradeId"),k=f.get("subjectId"),N=l==null?void 0:l.find(({years:w})=>w==="2024-2025");R.useEffect(()=>{o===A.Idle&&i(ae()),s===A.Idle&&i(re()),d===A.Idle&&i(le()),c===A.Idle&&i(ie())},[i,o,c,s,d]);const O=async w=>{w.gradeId&&g({subjectId:w.subjectId.toString(),gradeId:w.gradeId.toString()})},j={gradeId:isNaN(Number(y))?0:Number(y),subjectId:isNaN(Number(k))?0:Number(k)};return e.jsxs("main",{className:"pt-4 pb-40",children:[e.jsxs("header",{className:"relative z-50 flex flex-wrap gap-x-4 gap-y-1 px-3 items-end mb-1",children:[e.jsx("h1",{className:"title",children:"Журнал"}),e.jsx(_,{initialValues:j,onSubmit:O,children:({handleSubmit:w})=>e.jsxs(z,{className:"flex gap-1",children:[n&&e.jsx(H,{className:"min-w-16",inputClassname:"!bg-white",placeholder:"Класс",options:n.map(h=>({value:h.id,label:`${h.level} ${h.group}`})),name:"gradeId",onChange:()=>w()}),a&&e.jsx(H,{className:"min-w-[200px]",inputClassname:"!bg-white",placeholder:"Предмет",options:a.map(h=>({value:h.id,label:h.name})),name:"subjectId",onChange:()=>w(),searchable:!0})]})})]}),y&&+y>0&&k&&+k>0&&r&&n&&a&&e.jsx(ze,{students:r.filter(w=>{var h;return((h=w.student)==null?void 0:h.gradeId)===+y}),subjectId:+k,gradeId:+y,ratingDate:N},`${k.toString()}${y.toString()}`)]})}export{es as default};
