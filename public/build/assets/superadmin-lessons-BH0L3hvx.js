const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lessons-create-form-DmiNwW54.js","assets/main-DzOvJ3Bl.js","assets/preload-helper-BfFHrpNk.js","assets/main-CSYpzwAj.css","assets/index.esm-BCp_SAnH.js","assets/button-BK2ewXLd.js","assets/icons-B5TgyNC1.js","assets/checkbox-DXyiXLGr.js","assets/formik.esm-Cpulkf5n.js","assets/select-field-Dot3bTik.js","assets/cleanable-37L1pogH.js","assets/use-dropdown-D7UlQ3WZ.js","assets/index.browser-OxPLOBIU.js","assets/users-selector-BLV6X7VS.js","assets/subjects-selector-CkFIZtiD.js","assets/lessons-edit-form-Z8G3AoE1.js","assets/lessons-delete-form-Zvn8l_mo.js"])))=>i.map(i=>d[i]);
import{_ as L}from"./preload-helper-BfFHrpNk.js";import{r as s,u as h,i as S,j as e,t as g,L as O,A as E,X as T,c as y,a as $,ae as R,n as P,v as F,C as U,S as W}from"./main-DzOvJ3Bl.js";import{a as C,g as G}from"./grades-selector-XXuKk_5g.js";import{a as H,g as V}from"./users-selector-BLV6X7VS.js";import{a as B,g as q}from"./subjects-selector-CkFIZtiD.js";import{c as I,b as J}from"./index-DnzxYe6g.js";import{I as v}from"./icons-B5TgyNC1.js";import{H as X,L as K}from"./lesson-hour-BRJkREIE.js";import{B as Y}from"./button-BK2ewXLd.js";import{b as Q}from"./lessons-selector-53yG18IO.js";import{M as Z}from"./modal-1koiJ247.js";function ee({date:c,hour:x,grade:u,lesson:o,subject:i,teacher:r,setCreateDTO:f,setEditDTO:l,setDeleteDTO:d}){return h(Q)===S.Loading?e.jsxs("div",{className:"flex flex-col gap-1 items-center animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/5"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]}):o?e.jsxs("div",{className:"flex flex-col text-center leading-none group",children:[i&&e.jsx(O,{className:"duration-150 hover:text-blue-600 truncate",to:`${E.Journal}?gradeId=${o.gradeId}&subjectId=${o.subjectId}`,children:i.name}),r&&e.jsxs("div",{className:"flex justify-center text-sm items-baseline",children:["(",e.jsxs(O,{className:"duration-150 hover:text-blue-600 truncate",to:T(E.Users.Show,{id:o.teacherId}),children:[r.surname," ",r.name]}),")"]}),e.jsxs("div",{className:"absolute right-0 top-0 p-1 flex gap-1 invisible group-hover:visible",children:[e.jsx(Y,{icon:"edit",variant:"warning",onClick:()=>l({id:o.id,subject_id:o.subjectId,teacher_id:o.teacherId}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(Y,{icon:"delete",variant:"danger",onClick:()=>d({id:o.id}),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})]}):e.jsx("button",{className:"absolute left-0 top-0 w-full h-full transition-all duration-150 hover:bg-blue-50",type:"button",onClick:()=>f({date:g(c).format("YYYY-MM-DD"),hour:x,grade_id:u.id,subject_id:0}),children:e.jsx("span",{className:"sr-only",children:"Добавить урок"})})}const se=s.memo(ee);function te({date:c,isToday:x,lessons:u,setCreateDTO:o,setEditDTO:i,setDeleteDTO:r}){const f=h(C),l=h(B),d=h(H),w=s.useMemo(()=>{const t={};return u==null||u.forEach(a=>{const b=`${a.date}_${a.gradeId}_${a.hour}`;t[b]=a}),t},[u]),p=s.useMemo(()=>{const t={};return l==null||l.forEach(a=>{t[a.id]=a}),t},[l]),N=s.useMemo(()=>{const t={};return d==null||d.forEach(a=>{a.role==="teacher"&&(t[a.id]=a)}),t},[d]);return e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:y("border-b",x&&"bg-green-50"),children:e.jsx("td",{className:y("min-w-7 w-7 max-w-7 sticky left-0 z-10",x?"bg-green-50":"bg-white"),rowSpan:9,children:e.jsx("div",{className:"absolute left-1/2 top-1/2 flex gap-2 min-w-max text-blue-700 -translate-x-1/2 -translate-y-1/2 -rotate-90",children:I(c.format("dddd - DD"))})})}),Object.keys(X).map(t=>e.jsxs("tr",{className:y("min-h-[53px] h-[53px] max-h-[53px] border-b",x&&"bg-green-50"),children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-7 z-10",children:e.jsx("div",{className:y("absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",x?"bg-green-50":"bg-white"),children:t})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(K,{hour:+t})}),f==null?void 0:f.map(a=>{const b=`${c.format("YYYY-MM-DD")}_${a.id}_${t}`,m=w[b],_=m!=null&&m.subjectId?p[m.subjectId]:void 0,j=m!=null&&m.teacherId?N[m.teacherId]:void 0;return e.jsx("td",{className:"relative z-0 p-2 border-l min-w-[260px]",children:e.jsx(se,{date:c,hour:+t,grade:a,lesson:m,subject:_,teacher:j,setCreateDTO:o,setEditDTO:i,setDeleteDTO:r})},a.id)})]},t))]})}const ae=s.memo(te),re=s.lazy(()=>L(()=>import("./lessons-create-form-DmiNwW54.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),ne=s.lazy(()=>L(()=>import("./lessons-edit-form-Z8G3AoE1.js"),__vite__mapDeps([15,1,2,3,5,6,7,8,9,10,11,12,14,13]))),oe=s.lazy(()=>L(()=>import("./lessons-delete-form-Zvn8l_mo.js"),__vite__mapDeps([16,1,2,3,5,6,7,8])));function je(){const c=$(),x=h(G),u=h(V),o=h(q),i=h(C),[r,f]=s.useState(0),l=s.useMemo(()=>J(r),[r]),[d,w]=s.useState(),[p,N]=s.useState(),[t,a]=s.useState(),b=s.useRef(null),m=s.useMemo(()=>g().format("YYYY-MM-DD"),[]),[_,j]=s.useState();s.useEffect(()=>{c(R({week:r,onSuccess:j}))},[c,r]),s.useEffect(()=>{x===S.Idle&&c(P()),u===S.Idle&&c(F()),o===S.Idle&&c(U())},[c,x,o,u]);const D=s.useCallback(n=>{const{scrollLeft:M}=n.currentTarget;b.current&&b.current.querySelectorAll(".sync-scroll").forEach(z=>{z.scrollLeft=M})},[]),k=s.useCallback(n=>()=>{f(M=>n===0?0:M+n)},[]),A=s.useMemo(()=>d?e.jsx(re,{dto:d,week:r,setDTO:w,setLessons:j}):p?e.jsx(ne,{dto:p,week:r,setDTO:N,setLessons:j}):t?e.jsx(oe,{dto:t,week:r,setDTO:a,setLessons:j}):null,[d,p,t,r]);return e.jsxs("main",{className:"py-2",children:[e.jsx("h1",{className:"title mb-1 px-3",children:"Расписание занятий"}),e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)]",children:[e.jsxs("table",{ref:b,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(v.calendar,{className:"relative top-[1px]",height:16}),I(g(l[0]).format("MMMM")),g(l[0]).format("M")!==g(l[5]).format("M")&&` - ${I(g(l[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:D,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),i==null?void 0:i.map(n=>e.jsxs("th",{className:"p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",children:["Класс ",n.level," ",n.group]},n.id))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:D,children:l.map(n=>e.jsx(ae,{date:n,isToday:n.format("YYYY-MM-DD")===m,lessons:_,setCreateDTO:w,setEditDTO:N,setDeleteDTO:a},n.toString()))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:D,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),i==null?void 0:i.map(n=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},n.id))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:k(-1),children:[e.jsx(v.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),r!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:k(0),children:[e.jsx(v.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:k(1),children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(v.next,{width:7})]})]})}),e.jsx(Z,{isOpen:!!(d||p||t),children:e.jsx(s.Suspense,{fallback:e.jsx(W,{className:"w-10 h-10"}),children:A})})]})]})}export{je as default};
