import{r as c,u as d,i as g,j as e,L as v,A as k,X as L,c as j,a as D,t as p,ae as Y,n as $,v as A,C as z}from"./main-DzOvJ3Bl.js";import{a as M,g as _}from"./grades-selector-XXuKk_5g.js";import{a as C,g as E}from"./users-selector-BLV6X7VS.js";import{a as R,g as O}from"./subjects-selector-CkFIZtiD.js";import{c as S,b as U}from"./index-DnzxYe6g.js";import{I as w}from"./icons-B5TgyNC1.js";import{H as W,L as G}from"./lesson-hour-BRJkREIE.js";import{b as H}from"./lessons-selector-53yG18IO.js";import"./preload-helper-BfFHrpNk.js";function q({lesson:r,subject:i,teacher:o}){if(d(H)===g.Loading)return e.jsxs("div",{className:"flex flex-col gap-1 items-center animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/5"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]});if(r)return e.jsxs("div",{className:"flex flex-col text-center leading-none group",children:[i&&e.jsx(v,{className:"duration-150 hover:text-blue-600 truncate",to:`${k.Journal}?gradeId=${r.gradeId}&subjectId=${r.subjectId}`,children:i.name}),o&&e.jsxs("div",{className:"flex justify-center text-sm items-baseline",children:["(",e.jsxs(v,{className:"duration-150 hover:text-blue-600 truncate",to:L(k.Users.Show,{id:r.teacherId}),children:[o.surname," ",o.name]}),")"]})]})}const F=c.memo(q);function J({date:r,isToday:i,lessons:o}){const x=d(M),l=d(R),m=d(C),N=c.useMemo(()=>{const t={};return o==null||o.forEach(s=>{const h=`${s.date}_${s.gradeId}_${s.hour}`;t[h]=s}),t},[o]),u=c.useMemo(()=>{const t={};return l==null||l.forEach(s=>{t[s.id]=s}),t},[l]),f=c.useMemo(()=>{const t={};return m==null||m.forEach(s=>{s.role==="teacher"&&(t[s.id]=s)}),t},[m]);return e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:j("border-b",i&&"bg-green-50"),children:e.jsx("td",{className:j("min-w-7 w-7 max-w-7 sticky left-0 z-10",i?"bg-green-50":"bg-white"),rowSpan:9,children:e.jsx("div",{className:"absolute left-1/2 top-1/2 flex gap-2 min-w-max text-blue-700 -translate-x-1/2 -translate-y-1/2 -rotate-90",children:S(r.format("dddd - DD"))})})}),Object.keys(W).map(t=>e.jsxs("tr",{className:j("min-h-[53px] h-[53px] max-h-[53px] border-b",i&&"bg-green-50"),children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-7 z-10",children:e.jsx("div",{className:j("absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",i?"bg-green-50":"bg-white"),children:t})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(G,{hour:+t})}),x==null?void 0:x.map(s=>{const h=`${r.format("YYYY-MM-DD")}_${s.id}_${t}`,n=N[h],b=n!=null&&n.subjectId?u[n.subjectId]:void 0,a=n!=null&&n.teacherId?f[n.teacherId]:void 0;return e.jsx("td",{className:"relative z-0 p-2 border-l min-w-[260px]",children:e.jsx(F,{date:r,hour:+t,grade:s,lesson:n,subject:b,teacher:a})},s.id)})]},t))]})}const P=c.memo(J);function te(){const r=D(),i=d(_),o=d(E),x=d(O),l=d(M),[m,N]=c.useState(0),u=c.useMemo(()=>U(m),[m]),f=c.useRef(null),t=c.useMemo(()=>p().format("YYYY-MM-DD"),[]),[s,h]=c.useState();c.useEffect(()=>{r(Y({week:m,onSuccess:h}))},[r,m]),c.useEffect(()=>{i===g.Idle&&r($()),o===g.Idle&&r(A()),x===g.Idle&&r(z())},[r,i,x,o]);const n=c.useCallback(a=>{const{scrollLeft:y}=a.currentTarget;f.current&&f.current.querySelectorAll(".sync-scroll").forEach(I=>{I.scrollLeft=y})},[]),b=c.useCallback(a=>()=>{N(y=>a===0?0:y+a)},[]);return e.jsxs("main",{className:"py-2",children:[e.jsx("h1",{className:"title mb-1 px-3",children:"Расписание занятий"}),e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)]",children:[e.jsxs("table",{ref:f,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(w.calendar,{className:"relative top-[1px]",height:16}),S(p(u[0]).format("MMMM")),p(u[0]).format("M")!==p(u[5]).format("M")&&` - ${S(p(u[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:n,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),l==null?void 0:l.map(a=>e.jsxs("th",{className:"p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",children:["Класс ",a.level," ",a.group]},a.id))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:n,children:u.map(a=>e.jsx(P,{date:a,isToday:a.format("YYYY-MM-DD")===t,lessons:s},a.toString()))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:n,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),l==null?void 0:l.map(a=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},a.id))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:b(-1),children:[e.jsx(w.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),m!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:b(0),children:[e.jsx(w.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:b(1),children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(w.next,{width:7})]})]})})]})]})}export{te as default};
