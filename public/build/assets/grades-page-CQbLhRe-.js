import{u as w,j as e,Q as E,y as S,r as F,a as y,k as C,D as I,z as k,S as B,L as b,E as v,A as f,B as G,N as U}from"./main-D1X-5qeh.js";import x from"./not-found-page-Dlt1yDD_.js";import{B as N}from"./button-BxcCnYcJ.js";import{S as A}from"./select-field-DvwSWDo-.js";import{F as z,a as D}from"./formik.esm-CEA5_Xoc.js";import{c as L,a as P,e as K}from"./index.esm-tVQjNZt4.js";import{D as $}from"./data-table-Nl3BCqN7.js";import{M as q}from"./modal-COah0HVy.js";import{g as M}from"./grades-selector-CjDDihwd.js";import{g as R}from"./users-selector-Cpbhop2B.js";import"./preload-helper-DPi8upcZ.js";import"./icons-Cwm3zsc5.js";import"./cleanable-BYiEZa8s.js";import"./use-dropdown-BjzLPdm1.js";import"./index.browser-OxPLOBIU.js";const V=L().shape({level:K().required("Обязательное поле."),group:P().required("Обязательное поле.")});function O({grades:d,setIsOpen:u}){const o=w(),i={level:1,group:"А"},p=async(l,r)=>{if(r.setSubmitting(!0),d.some(s=>s.level===l.level&&s.group===l.group)){r.setErrors({level:"Выбранный класс уже существует.",group:" "});return}await o(E({dto:l,onSuccess:()=>{S.success("Класс успешно добавлен."),u(!1)},onValidationError:s=>r.setErrors({...s.errors}),onFail:s=>S.success(s)})),r.setSubmitting(!1)};return e.jsx(z,{initialValues:i,validationSchema:V,onSubmit:p,children:({isSubmitting:l})=>e.jsxs(D,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавления класса"}),e.jsx(N,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>u(!1),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 mb-4",children:[e.jsx(A,{name:"level",label:"Уровень",options:[1,2,3,4,5,6,7,8,9,10,11].map(r=>({value:r,label:r.toString()}))}),e.jsx(A,{name:"group",label:"Группа",options:["А","Б","В","Г","Д","Е"].map(r=>({value:r,label:r.toString()}))})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(N,{className:"justify-center min-w-[92px]",type:"submit",icon:"add",disabled:l,loading:l,variant:"success",children:"Добавить"})})]})})}function Q(){var r;const[d,u]=F.useState(!1),o=y(M),i=y(R),p=w();F.useEffect(()=>{!o.data&&!o.isFetching&&p(C()),!i.data&&!i.isFetching&&p(I())},[p,o.data,o.isFetching,i.data,i.isFetching]);const l=[{id:"name",accessorKey:"name",header:"Класс",size:88,cell:({row:t})=>e.jsxs(b,{className:"text-lg font-semibold flex items-center w-full justify-center",to:v(f.Classes.Show,{id:t.original.id}),children:[t.original.level," ",e.jsx("sup",{children:'"'}),t.original.group,e.jsx("sup",{children:'"'})]}),sortingFn:(t,s)=>{const a=t.original.level,n=s.original.level;return a<n?-1:a>n?1:0}},{id:"teacher",accessorKey:"teacher",header:"Руководитель",size:320,cell:({row:t})=>{var a;const s=(a=i.data)==null?void 0:a.find(({id:n})=>n===t.original.teacherId);if(s)return e.jsxs(b,{className:"block leading-[1.2]",to:v(f.Users.Show,{id:s.id}),children:[s.surname," ",s.name," ",s.patronymic]})},sortingFn:(t,s)=>{var g,h,m,c;const a=((h=(g=i.data)==null?void 0:g.find(({id:j})=>j===t.original.teacherId))==null?void 0:h.surname)||"",n=((c=(m=i.data)==null?void 0:m.find(({id:j})=>j===s.original.teacherId))==null?void 0:c.surname)||"";return a.localeCompare(n)}},{id:"students",accessorKey:"students",header:"Ученики",size:240,cell:({row:t})=>{var s;return e.jsx("div",{className:"flex flex-wrap gap-1 p-1",children:(s=i.data)==null?void 0:s.filter(a=>{var n;return((n=a.student)==null?void 0:n.gradeId)===t.original.id}).map(a=>e.jsxs(b,{className:"py-1 px-2 border rounded bg-gray-100 hover:bg-blue-50 min-w-max",to:v(f.Users.Show,{id:a.id}),children:[a.surname," ",a.name]},a.id))})},sortingFn:(t,s)=>{var g,h;const a=((g=i.data)==null?void 0:g.filter(m=>{var c;return((c=m.student)==null?void 0:c.gradeId)===t.original.id}).length)||0,n=((h=i.data)==null?void 0:h.filter(m=>{var c;return((c=m.student)==null?void 0:c.gradeId)===s.original.id}).length)||0;return a<n?-1:a>n?1:0},meta:{columnClass:"!min-w-none !w-full !max-w-none"}}];return e.jsxs(k,{children:[e.jsxs("main",{className:"pt-4 pb-40",children:[e.jsx("header",{className:"flex justify-between px-3 items-end mb-1",children:e.jsxs("h1",{className:"title",children:["Классы (",(r=o.data)==null?void 0:r.length,")"]})}),o.data?e.jsx($,{data:o.data,columns:l,sortingState:[{id:"name",desc:!1}],actions:e.jsx(N,{icon:"add",variant:"success",onClick:()=>u(!0),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(B,{className:"w-8 h-8"})]}),e.jsx(q,{isOpen:d,children:e.jsx(O,{grades:o.data||[],setIsOpen:u})})]})}const T={superadmin:()=>e.jsx(Q,{}),admin:()=>e.jsx(x,{}),director:()=>e.jsx(x,{}),teacher:()=>e.jsx(x,{}),parent:()=>e.jsx(x,{}),student:()=>e.jsx(x,{})};function le(){const d=y(G);return d?T[d.role]():e.jsx(U,{to:f.Auth.Login})}export{le as default};
