import{a as u,j as s,G as v,y as m,H as P,I as D,u as j,g as F,r as d,i as w,m as E,S as T}from"./main-C3zapZtd.js";import{D as A}from"./data-table-C_fhXAN-.js";import{B as o}from"./button-k6U4pBlW.js";import{M as C}from"./modal-Dx9j0xvg.js";import{g as k,a as O}from"./professions-selector-BBMQhaob.js";import{T as N}from"./text-field-DVRwjedT.js";import{F as h,a as f}from"./formik.esm-ShEui-VR.js";import{c as b,a as S}from"./index.esm-CBOWuRvE.js";import"./preload-helper-BfFHrpNk.js";import"./icons-CmdP5zNp.js";import"./use-dropdown-idH_Ahq5.js";import"./index-dlLad1ED.js";import"./cleanable-xJmsbn0p.js";import"./index.browser-OxPLOBIU.js";const V=b().shape({name:S().required("Обязательное поле.")});function q({dto:r,setDTO:a}){const n=u(),l={name:r.name},i=async(e,t)=>{t.setSubmitting(!0),await n(v({name:e.name,onSuccess:()=>{m.success("Сфера деятельности добавлен."),a(null)},onValidationError:c=>t.setErrors({...c.errors}),onFail:c=>m.success(c)})),t.setSubmitting(!1)};return s.jsx(h,{initialValues:l,validationSchema:V,onSubmit:i,children:({isSubmitting:e})=>s.jsxs(f,{children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[s.jsx("h3",{className:"title",children:"Добавление"}),s.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>a(null),children:s.jsx("span",{className:"sr-only",children:"Отмена"})})]}),s.jsx(N,{className:"mb-4",name:"name",label:"Сфера деятельности",required:!0}),s.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:s.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:e,loading:e,variant:"success",children:"Добавить"})})]})})}const z=b().shape({name:S().required("Обязательное поле.")});function K({dto:r,setDTO:a}){const n=u(),l={id:r.id,name:r.name},i=async(e,t)=>{t.setSubmitting(!0),await n(P({dto:e,onSuccess:()=>{m.success("Сфера деятельности обновлен."),a(null)},onValidationError:c=>t.setErrors({...c.errors}),onFail:c=>m.success(c)})),t.setSubmitting(!1)};return s.jsx(h,{initialValues:l,validationSchema:z,onSubmit:i,children:({isSubmitting:e})=>s.jsxs(f,{children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[s.jsx("h3",{className:"title",children:"Редактирование"}),s.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>a(null),children:s.jsx("span",{className:"sr-only",children:"Отмена"})})]}),s.jsx(N,{className:"mb-4",name:"name",label:"Сфера деятельности",required:!0}),s.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:s.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:e,loading:e,variant:"success",children:"Сохранить"})})]})})}function $({dto:r,setDTO:a}){const n=u(),l=async(i,e)=>{e.setSubmitting(!0),await n(D({id:r,onSuccess:()=>{m.success("Сфера деятельности удалена."),a(null)}})),e.setSubmitting(!1)};return s.jsx(h,{initialValues:{},onSubmit:l,children:({isSubmitting:i})=>s.jsxs(f,{children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[s.jsx("h3",{className:"title",children:"Удаление"}),s.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>a(null),children:s.jsx("span",{className:"sr-only",children:"Отмена"})})]}),s.jsx("p",{children:"Вы уверены что хотите удалить?"}),s.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:s.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:i,loading:i,variant:"success",children:"Удалить"})})]})})}function _(){const r=u(),a=j(k),n=j(O),l=j(F),[i,e]=d.useState(null),[t,c]=d.useState(null),[x,g]=d.useState(null);d.useEffect(()=>{a===w.Idle&&r(E())},[r,a]);let y=[{id:"name",accessorKey:"name",header:"Название",size:1686}];return(l==null?void 0:l.role)==="superadmin"&&(y=[{id:"name",accessorKey:"name",header:"Название",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:p})=>s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(o,{icon:"edit",variant:"warning",onClick:()=>c({id:p.original.id,name:p.original.name}),children:s.jsx("span",{className:"sr-only",children:"Редактировать"})}),s.jsx(o,{icon:"delete",variant:"danger",onClick:()=>g(p.original.id),children:s.jsx("span",{className:"sr-only",children:"Удалить"})})]})}]),s.jsxs(s.Fragment,{children:[s.jsxs("main",{className:"py-2",children:[s.jsxs("h1",{className:"title mb-1 px-3",children:["Сфера деятельности (",n==null?void 0:n.length,")"]}),n?s.jsx(A,{data:n,columns:y,sortingState:[{id:"name",desc:!1}],columnPinningState:{right:["actions"]},actions:s.jsx(o,{icon:"add",variant:"success",onClick:()=>e({name:""}),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):s.jsx(T,{className:"w-8 h-8"})]}),s.jsxs(C,{isOpen:!!(i||t||x),children:[i&&s.jsx(q,{dto:i,setDTO:e}),t&&s.jsx(K,{dto:t,setDTO:c}),x&&s.jsx($,{dto:x,setDTO:g})]})]})}export{_ as default};
