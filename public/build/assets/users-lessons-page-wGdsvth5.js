import{u as N,r as h,a as u,M as Y,D as y,O as k,j as s,S as v,p as a,c as w,e as D,k as L,B as A,N as F,A as z}from"./main-D1X-5qeh.js";import p from"./not-found-page-Dlt1yDD_.js";import{L as U}from"./layout-BguUlnse.js";import{g as M}from"./users-selector-Cpbhop2B.js";import{g as E}from"./grades-selector-CjDDihwd.js";import{I as b}from"./icons-Cwm3zsc5.js";import{g as I,c as g}from"./index-Y5BpZlJY.js";import{H as P,L as _}from"./lesson-hour-DTH_J5YM.js";import{S as C}from"./student-lessons-item-CPDh2JQs.js";import{g as R}from"./subjects-selector-H4IosHxK.js";import"./preload-helper-DPi8upcZ.js";import"./button-BxcCnYcJ.js";import"./users-DUqPc0QS.js";import"./nationalities-selector-BQnDI0q3.js";import"./description-list-D0pPZU8B.js";function H({grade:l}){const i=N(),[d,r]=h.useState(null),[n,m]=h.useState(0),o=I(n),x=h.useRef(null),t=u(R),c=u(M);h.useEffect(()=>{!t.data&&!t.isFetching&&i(Y()),!c.data&&!c.isFetching&&i(y()),d||i(k({week:n,gradeId:l.id,onSuccess:e=>r(e)}))},[i,l.id,d,t.data,t.isFetching,c.data,c.isFetching,n]);const j=e=>{if(x.current){const{scrollLeft:f}=e.currentTarget;x.current.querySelectorAll(".sync-scroll").forEach(S=>{S.scrollLeft=f})}};return!d||!t.data||!c.data?s.jsx(v,{className:"w-8 h-8"}):s.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)] max-w-full",children:[s.jsxs("table",{ref:x,className:"flex flex-col w-full",children:[s.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:s.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[s.jsx(b.calendar,{className:"relative top-[1px]",height:16}),g(a(o[0]).format("MMMM")),a(o[0]).format("M")!==a(o[5]).format("M")&&` - ${g(a(o[5]).format("MMMM"))}`]})}),s.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:j,children:s.jsxs("tr",{children:[s.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),s.jsx("th",{className:"min-w-20 w-20 max-w-20"}),o.map(e=>s.jsx("th",{className:w("p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",a(e).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")&&"bg-green-50"),children:g(e.format("dddd - DD"))},a(e).format()))]})}),s.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:j,children:Object.keys(P).map(e=>s.jsxs("tr",{className:"min-h-[53px] h-[53px] max-h-[53px] border-b",children:[s.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-0 z-10 bg-white",children:s.jsx("div",{className:"absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",children:e})}),s.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:s.jsx(_,{hour:+e})}),o.map(f=>s.jsx("td",{className:w("relative z-0 p-2 border-l min-w-[260px] w-[260px] max-w-[260px]",a(f).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:t.data&&c.data&&s.jsx(C,{date:f,hour:Number(e),subjects:t.data,users:c.data,lessons:d})},a(f).format()))]},e))}),s.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:j,children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),s.jsx("th",{className:"p-0 border-b min-w-[91px]"}),o.map(e=>s.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},a(e).format()))]})})]}),s.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:s.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{m(e=>e-1),r(null)},children:[s.jsx(b.previous,{width:7}),s.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),n!==0&&s.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{m(0),r(null)},children:[s.jsx(b.currentWeek,{width:16,height:16}),s.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{m(e=>e+1),r(null)},children:[s.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),s.jsx(b.next,{width:7})]})]})})]})}function W(){var o,x;const l=N(),i=D(),d=u(M),r=((o=d.data)==null?void 0:o.find(t=>t.id===+(i.id||0)))||null,n=u(E),m=(x=n.data)==null?void 0:x.find(({id:t})=>{var c;return t===((c=r==null?void 0:r.student)==null?void 0:c.gradeId)});return h.useEffect(()=>{!r&&i.id&&!d.isFetching&&l(y()),!n.data&&!n.isFetching&&l(L())},[r,i.id,l,d.isFetching,n.data,n.isFetching]),s.jsx(U,{children:m&&s.jsx(H,{grade:m})})}const G={superadmin:()=>s.jsx(p,{}),admin:()=>s.jsx(p,{}),director:()=>s.jsx(p,{}),teacher:()=>s.jsx(p,{}),parent:()=>s.jsx(W,{}),student:()=>s.jsx(p,{})};function rs(){const l=u(A);return l?G[l.role]():s.jsx(F,{to:z.Auth.Login})}export{rs as default};
