import{t,j as e,L as v,X as D,A as k,a as I,u as x,g as A,r as f,i as S,C as L,v as z,ae as U,S as C,c as M}from"./main-DS_fTM3x.js";import{I as b}from"./icons-8R8i3bGk.js";import{b as E,c as y}from"./index-CkeUNUaj.js";import{H as _,L as R}from"./lesson-hour-D2PBHkUP.js";import{g as H,a as W}from"./subjects-selector-CI-ZzRFN.js";import{g as T,a as q}from"./users-selector-CYBNvOPH.js";import"./preload-helper-BfFHrpNk.js";function O({date:r,hour:c,subjects:h,lessons:p,users:m}){var i;const n=p.find(a=>t(a.date).format("YYYY-MM-DD")===t(r).format("YYYY-MM-DD")&&+a.hour==+c);if(!n)return;const l=m.find(({id:a})=>a===n.teacherId);return e.jsxs("div",{className:"flex flex-col text-center leading-none group",children:[e.jsx("span",{className:"truncate",children:(i=h.find(({id:a})=>a===n.subjectId))==null?void 0:i.name}),l&&e.jsxs("div",{className:"flex justify-center text-sm items-baseline",children:["(",e.jsxs(v,{className:"duration-150 hover:text-blue-600 truncate",to:D(k.Users.Show,{id:n.teacherId}),children:[l.surname," ",l.name]}),")"]})]})}function K({user:r}){var Y;const c=I(),h=x(T),p=x(H),m=x(A),n=x(q),l=x(W),[i,a]=f.useState(),[u,j]=f.useState(0),d=E(u),w=f.useRef(null);f.useEffect(()=>{p===S.Idle&&c(L()),h===S.Idle&&c(z())},[c,p,h]),f.useEffect(()=>{var s,o;!i&&m&&c(U({week:u,gradeId:((s=r==null?void 0:r.student)==null?void 0:s.gradeId)||((o=m.student)==null?void 0:o.gradeId),onSuccess:N=>a(N)}))},[m,c,i,(Y=r==null?void 0:r.student)==null?void 0:Y.gradeId,u]);const g=s=>{if(w.current){const{scrollLeft:o}=s.currentTarget;w.current.querySelectorAll(".sync-scroll").forEach(N=>{N.scrollLeft=o})}};return!i||!l||!n?e.jsx(C,{className:"w-8 h-8"}):e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)] max-w-full",children:[e.jsxs("table",{ref:w,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(b.calendar,{className:"relative top-[1px]",height:16}),y(t(d[0]).format("MMMM")),t(d[0]).format("M")!==t(d[5]).format("M")&&` - ${y(t(d[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:g,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),d.map(s=>e.jsx("th",{className:M("p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",t(s).format("YYYY-MM-DD")===t().format("YYYY-MM-DD")&&"bg-green-50"),children:y(s.format("dddd - DD"))},t(s).format()))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:g,children:Object.keys(_).map(s=>e.jsxs("tr",{className:"min-h-[53px] h-[53px] max-h-[53px] border-b",children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-0 z-10 bg-white",children:e.jsx("div",{className:"absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",children:s})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(R,{hour:+s})}),d.map(o=>e.jsx("td",{className:M("relative z-0 p-2 border-l min-w-[260px] w-[260px] max-w-[260px]",t(o).format("YYYY-MM-DD")===t().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:l&&n&&e.jsx(O,{date:o,hour:Number(s),subjects:l,users:n,lessons:i})},t(o).format()))]},s))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:g,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),d.map(s=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},t(s).format()))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{j(s=>s-1),a(void 0)},children:[e.jsx(b.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),u!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{j(0),a(void 0)},children:[e.jsx(b.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{j(s=>s+1),a(void 0)},children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(b.next,{width:7})]})]})})]})}export{K as default};
