import{r as n,j as t,c as g,a as N,u as w,i as R,C as v,ac as C,ad as A,S as T}from"./main-DyZOqu_f.js";import{R as y,a as E}from"./ratings-CKd6Gnpx.js";import{g as M,a as k}from"./subjects-selector-CXlH5nlQ.js";import{g as j}from"./index-Cel6jvoj.js";import{u as D,c as $,f as z}from"./index-B7h0mGKW.js";function I({data:d,columns:o}){const[u,x]=n.useState({left:["name"],right:[]}),i=D({data:d,columns:o,getCoreRowModel:$(),state:{columnPinning:u},onColumnPinningChange:x});return t.jsxs("div",{className:"flex flex-col rounded-md shadow border bg-white overflow-scroll max-h-[calc(100vh-52px)] styled-scrollbar text-sm md:text-[16px]",children:[t.jsx("div",{className:"sticky top-0 z-40 shadow min-w-max",children:i.getHeaderGroups().map(m=>t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex items-end leading-none justify-end p-1 min-w-7 max-w-7 font-semibold bg-gray-100 md:p-2 md:min-w-9 md:max-w-9",children:"№"}),m.headers.map(s=>s.id==="name"?t.jsx("div",{className:"flex items-end bg-gray-100 p-1 md:p-2 leading-none font-semibold min-w-[180px] max-w-[180px)] md:min-w-[220px] md:max-w-[220px] min-h-20 max-h-20 sticky left-0 z-10 border-r",children:"Предмет"},s.id):t.jsx("div",{className:"relative flex bg-gray-100 min-w-9 max-w-9 min-h-[80px] max-h-[80px] border-r text-[13px]",children:t.jsx("span",{className:"absolute left-full bottom-0 flex items-center justify-start px-1 origin-bottom-left -rotate-90 h-9 w-[80px] text-blue-600",children:y[s.id]})},s.id))]},m.id))}),t.jsx("div",{className:"min-w-max",children:i.getRowModel().rows.map((m,s)=>t.jsxs("div",{className:g("flex",s%2?"bg-gray-50":"bg-white"),children:[t.jsxs("div",{className:g("flex items-center justify-end p-1 min-w-7 max-w-7 min-h-9 max-h-9 md:p-2 md:min-w-9 md:max-w-9",s%2?"bg-gray-50":"bg-white"),children:[s+1,"."]}),m.getVisibleCells().map((c,r)=>{var l;return t.jsx("div",{className:g(r===0&&"sticky left-0 border-r",s%2?"bg-gray-50 border-r":"bg-white border-r",(l=c.column.columnDef.meta)==null?void 0:l.columnClass),children:z(c.column.columnDef.cell,c.getContext())},JSON.stringify(c))})]},m.original.id))})]})}const P=n.memo(I);function U({user:d}){const o=N(),u=w(M),x=w(k),[i,m]=n.useState(),[s,c]=n.useState();n.useEffect(()=>{u===R.Idle&&o(v())},[o,u]),n.useEffect(()=>{!s&&d&&o(C({id:d.id,years:j(),onSuccess:e=>{m(e.subjectIds),c(e.ratings)}})),!s&&!d&&o(A({years:j(),onSuccess:e=>{m(e.subjectIds),c(e.ratings)}}))},[o,s,i,d]);const r=n.useMemo(()=>{const e={};if(s)return s.forEach(a=>{const f=`${a.subjectId}_${a.rating}`;e[f]=a.score}),e},[s]),l=Object.keys(E),p=n.useMemo(()=>{if(x)return x.filter(e=>i==null?void 0:i.includes(e.id)).map(e=>{const a=l.reduce((f,h)=>{const S=r==null?void 0:r[`${e.id}_${h}`];return f[h]=S,f},{});return{id:e.id,name:e.name,...a}})},[l,r,i,x]),b=n.useMemo(()=>{if(r)return[{id:"name",accessorKey:"name",header:"Предмет",size:180,meta:{columnClass:"flex items-center min-w-[180px] max-w-[180px)] md:min-w-[220px] md:max-w-[220px]"}},...l.reduce((e,a)=>(e.push({id:a,accessorKey:a,header:y[a],size:40,enableSorting:!1,meta:{columnClass:g("flex items-center justify-center min-w-9 max-w-9 min-h-9 max-h-9 border-r")}}),e),[])]},[l,r]);return!p||!b?t.jsx(T,{className:"w-8 h-8"}):t.jsx(P,{data:p,columns:b})}export{U as S};
