import{u as A,a as j,r as g,h as E,D as C,k as I,i as R,j as a,P as D,y,z as U,A as B}from"./main-D1X-5qeh.js";import{B as L}from"./button-BxcCnYcJ.js";import{C as q}from"./content-field-Dj1tSyJD.js";import{L as v}from"./cleanable-BYiEZa8s.js";import{S as d}from"./select-field-DvwSWDo-.js";import{T as t}from"./text-field-D3e8nZd6.js";import{a as O,b as P,S as G,R as K}from"./users-DUqPc0QS.js";import{g as T}from"./grades-selector-CjDDihwd.js";import{g as z}from"./nationalities-selector-BQnDI0q3.js";import{g as W}from"./professions-selector-Lr4nX4_U.js";import{g as H}from"./users-selector-Cpbhop2B.js";import{F as J,a as M}from"./formik.esm-CEA5_Xoc.js";import{c as f,a as r,e as u,d as _}from"./index.esm-tVQjNZt4.js";import{B as Q}from"./breadcrumbs-YnKa2wrI.js";import"./preload-helper-DPi8upcZ.js";import"./icons-Cwm3zsc5.js";import"./use-dropdown-BjzLPdm1.js";import"./index.browser-OxPLOBIU.js";const X=f().shape({name:r().required("Имя обязательно для заполнения."),surname:r().required("Фамилия обязательна для заполнения."),patronymic:r(),role:r().required("Укажите позицию пользователя."),sex:r().required("Укажите пол."),birth_date:r().required("Укажите дату рождения."),nationality_id:u().required("Укажите национальность.").min(1,"Укажите национальность."),email:r().email("Неверный адрес электронной почты."),address:f({physical_address:r().required("Фактический адрес обязателен."),region:r().required("Укажите район.")}).required("Укажите адрес."),teacher:f({grades:_().of(u().typeError("ID класса должен быть числом.").integer("ID класса должен быть целым числом.").min(1,"ID класса должен быть больше нуля."))}),parent:f({children:_().of(u().typeError("ID ребенка должен быть числом.").integer("ID ребенка должен быть целым числом.").min(1,"ID ребенка должен быть больше нуля.")),profession_id:u().required("Укажите профессию.").min(1,"Укажите профессию."),workplace:r().required("Укажите место работы."),position:r().required("Укажите должность.")}).nullable().notRequired().default(void 0).transform((n,l)=>l===void 0?void 0:n),student:f({grade_id:u().required("Укажите класс."),mother_id:u(),father_id:u(),admission_date:r().required("Укажите дату поступления."),previous_schools:r().required("Предыдущие школы обязательны."),medical_recommendations:r().required("Медицинские рекомендации обязательны.")}).nullable().notRequired().default(void 0).transform((n,l)=>l===void 0?void 0:n)});function Y(){const n=A(),l=j(z),c=j(T),m=j(H),h=j(W),[N,w]=g.useState(1);g.useEffect(()=>{!l.data&&!l.isFetching&&n(E()),!m.data&&!m.isFetching&&n(C()),!c.data&&!c.isFetching&&n(I()),!h.data&&!h.isFetching&&n(R())},[n,c.data,c.isFetching,l.data,l.isFetching,h.data,h.isFetching,m.data,m.isFetching]);const $={name:"",surname:"",role:"",sex:"",nationality_id:0,birth_date:"",address:{physical_address:"",region:""},phone_numbers:[{code:"",numbers:""}],whatsapp:{code:"",numbers:""}},F=async(s,i)=>{var o,p,e,b;i.setSubmitting(!0),(!((o=s.whatsapp)!=null&&o.code)||!((p=s.whatsapp)!=null&&p.numbers))&&delete s.whatsapp,(!((e=s.phone_numbers)!=null&&e[0].code)||!((b=s.phone_numbers)!=null&&b[0].numbers))&&delete s.phone_numbers,await n(D({dto:s,onSuccess:()=>{y.success("Пользователь успешно добавлен."),i.resetForm(),w(x=>x+1)},onValidationError:x=>i.setErrors({...x.errors}),onFail:x=>y.error(x)})),i.setSubmitting(!1)},k=s=>()=>{var e;let i="";const o=Object.keys(s)[0];i=o;const p=s[o];if(typeof p=="object"){const b=Object.keys(p)[0];i=`${o}.${b}`}(e=document.body.querySelector(`[name="${i}"]`))==null||e.scrollIntoView({block:"center"})},S=s=>i=>{switch(i.value){case"teacher":s("teacher",{}),s("parent",void 0),s("student",void 0);break;case"parent":s("teacher",void 0),s("parent",{profession_id:0,workplace:"",position:""}),s("student",void 0);break;case"student":s("teacher",void 0),s("parent",void 0),s("student",{grade_id:0,admission_date:"",previous_schools:"",medical_recommendations:""});break;default:s("teacher",void 0),s("parent",void 0),s("student",void 0);break}};return a.jsx(J,{initialValues:$,validationSchema:X,onSubmit:F,children:({isSubmitting:s,errors:i,values:o,setFieldValue:p})=>a.jsxs(M,{className:"flex flex-col gap-3 md:bg-white md:rounded md:shadow md:px-8 md:py-4 md:grid md:grid-cols-2 lg:grid-cols-3 max-w-7xl",children:[a.jsx(t,{name:"name",label:"Имя",required:!0}),a.jsx(t,{name:"surname",label:"Фамилия",required:!0}),a.jsx(t,{name:"patronymic",label:"Отчество"}),a.jsx(d,{name:"role",label:"Позиция",onChange:S(p),options:O.map(e=>({value:e,label:P[e]})),required:!0}),a.jsx(d,{name:"sex",label:"Пол",options:["male","female"].map(e=>({value:e,label:G[e]})),required:!0}),a.jsx(t,{name:"birth_date",label:"Дата рождения",type:"date",required:!0}),l.data&&a.jsx(d,{name:"nationality_id",label:"Национальность",options:l.data.map(({id:e,name:b})=>({value:e,label:b})),required:!0}),a.jsx(t,{type:"email",name:"email",label:"E-mail (если имеется)"}),a.jsx(t,{name:"address.physical_address",label:"Адрес проживания (фактический)",required:!0}),a.jsx(d,{name:"address.region",label:"Район",options:K.map(e=>({value:e,label:e})),required:!0}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx(v,{label:"Телефон"}),a.jsxs("div",{className:"flex gap-1 w-full",children:[a.jsxs("div",{className:"relative",children:[a.jsx(t,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:"phone_numbers[0].code",placeholder:"Код"}),a.jsx("span",{className:"absolute top-4 left-3 -translate-y-1/2 text-xl",children:"+"})]}),a.jsx(t,{className:"w-[120px] grow",type:"number",name:"phone_numbers[0].numbers",placeholder:"Номер"})]})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx(v,{label:"WhatsApp"}),a.jsxs("div",{className:"flex gap-1 w-full",children:[a.jsxs("div",{className:"relative",children:[a.jsx(t,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:"whatsapp.code",placeholder:"Код"}),a.jsx("span",{className:"absolute top-4 left-3 -translate-y-1/2 text-xl",children:"+"})]}),a.jsx(t,{className:"w-[120px] grow",type:"number",name:"whatsapp.numbers",placeholder:"Номер"})]})]}),o.role==="teacher"&&c.data&&a.jsx(d,{name:"teacher.grades",label:"Назначить руководителем класса",multiple:!0,options:c.data.map(e=>({value:e.id,label:`${e.level} ${e.group}`}))}),o.role==="parent"&&m.data&&h.data&&a.jsxs(a.Fragment,{children:[a.jsx(d,{name:"parent.children",label:"Дети",multiple:!0,searchable:!0,options:m.data.filter(({role:e})=>e==="student").map(e=>({value:e.id,label:`${e.surname} ${e.name} ${e.patronymic??""}`}))}),a.jsx(d,{name:"parent.profession_id",label:"Сфера деятельности",options:h.data.map(e=>({value:e.id,label:e.name})),required:!0}),a.jsx(t,{name:"parent.workplace",label:"Место работы",required:!0}),a.jsx(t,{name:"parent.position",label:"Должность",required:!0})]}),o.role==="student"&&m.data&&c.data&&a.jsxs(a.Fragment,{children:[a.jsx(d,{name:"student.grade_id",label:"Класс",options:c.data.map(e=>({value:e.id,label:`${e.level} ${e.group}`})),required:!0}),a.jsx(d,{name:"student.mother_id",label:"Мать",searchable:!0,options:m.data.filter(e=>e.role==="parent"&&e.sex==="female").map(e=>({value:e.id,label:`${e.surname} ${e.name} ${e.patronymic??""}`}))}),a.jsx(d,{name:"student.father_id",label:"Отец",searchable:!0,options:m.data.filter(e=>e.role==="parent"&&e.sex==="male").map(e=>({value:e.id,label:`${e.surname} ${e.name} ${e.patronymic??""}`}))}),a.jsx(t,{className:"lg:col-span-2",name:"student.admission_date",label:"С какого года ребенок обучается в ЧОУ «Империя знаний»",type:"date",required:!0}),a.jsx(q,{className:"md:col-span-2 lg:col-span-3",name:"student.previous_schools",label:"Перечислите предыдущие школы",placeholder:"Если нет — пишите «Нет»",required:!0}),a.jsx(q,{className:"md:col-span-2 lg:col-span-3",name:"student.medical_recommendations",label:"Медицинские и психологические рекомендации для ребенка",placeholder:"Если нет — пишите «Нет»",required:!0})]}),a.jsx("div",{className:"ml-auto md:col-span-2 lg:col-span-3",children:a.jsx(L,{className:"justify-center md:ml-auto",type:"submit",variant:"success",disabled:s,loading:s,onClick:k(i),children:"Зарегистрировать"})})]})},N)}function xe(){return a.jsx(U,{children:a.jsxs("main",{className:"pt-4 pb-40",children:[a.jsx(Q,{items:[["Справочник пользователей",B.Users.Index],["Добавить",""]]}),a.jsx("h1",{className:"title mb-1",children:"Регистрация нового пользователя"}),a.jsx(Y,{})]})})}export{xe as default};
