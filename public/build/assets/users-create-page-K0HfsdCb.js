import{a as D,u as d,r as N,i as j,k as U,v as B,n as G,m as O,j as a,w as P,y as w,A as L}from"./main-XRo2qOUM.js";import{B as K}from"./button-Y4UR9_BE.js";import{C as S}from"./content-field-tIYjuVXj.js";import{L as $}from"./cleanable-vEQcTMeq.js";import{S as o}from"./select-field-DvwDrwa-.js";import{T as t}from"./text-field-DZyLsNjz.js";import{a as T,b as W,S as z,R as H}from"./users-DUqPc0QS.js";import{g as J,a as M}from"./grades-selector-BPd7_f6O.js";import{g as Q,a as X}from"./nationalities-selector-DurcRylD.js";import{g as Y,a as Z}from"./professions-selector-CFvWVWsI.js";import{g as V,a as ee}from"./users-selector-BbhGeZy6.js";import{F as ae,a as se}from"./formik.esm-Be66R8Pj.js";import{c as h,a as r,e as c,d as k}from"./index.esm-DPaSKxW4.js";import{B as re}from"./breadcrumbs-5FabMUaW.js";import"./preload-helper-DPi8upcZ.js";import"./icons-B9HDjQFM.js";import"./use-dropdown-BNrZcIiO.js";import"./index.browser-OxPLOBIU.js";const te=h().shape({name:r().required("Имя обязательно для заполнения."),surname:r().required("Фамилия обязательна для заполнения."),patronymic:r(),role:r().required("Укажите позицию пользователя."),sex:r().required("Укажите пол."),birth_date:r().required("Укажите дату рождения."),nationality_id:c().required("Укажите национальность.").min(1,"Укажите национальность."),email:r().email("Неверный адрес электронной почты."),address:h({physical_address:r().required("Фактический адрес обязателен."),region:r().required("Укажите район.")}).required("Укажите адрес."),teacher:h({grades:k().of(c().typeError("ID класса должен быть числом.").integer("ID класса должен быть целым числом.").min(1,"ID класса должен быть больше нуля."))}),parent:h({children:k().of(c().typeError("ID ребенка должен быть числом.").integer("ID ребенка должен быть целым числом.").min(1,"ID ребенка должен быть больше нуля.")),profession_id:c().required("Укажите профессию.").min(1,"Укажите профессию."),workplace:r().required("Укажите место работы."),position:r().required("Укажите должность.")}).nullable().notRequired().default(void 0).transform((l,p)=>p===void 0?void 0:l),student:h({grade_id:c().required("Укажите класс."),mother_id:c(),father_id:c(),admission_date:r().required("Укажите дату поступления."),previous_schools:r().required("Предыдущие школы обязательны."),medical_recommendations:r().required("Медицинские рекомендации обязательны.")}).nullable().notRequired().default(void 0).transform((l,p)=>p===void 0?void 0:l)});function ie(){const l=D(),p=d(Q),g=d(J),y=d(V),v=d(Y),q=d(X),f=d(M),b=d(ee),_=d(Z),[I,A]=N.useState(1);N.useEffect(()=>{p===j.Idle&&l(U()),g===j.Idle&&l(B()),y===j.Idle&&l(G()),v===j.Idle&&l(O())},[l,g,p,v,y]);const E={name:"",surname:"",role:"",sex:"",nationality_id:0,birth_date:"",address:{physical_address:"",region:""},phone_numbers:[{code:"",numbers:""}],whatsapp:{code:"",numbers:""}},F=async(s,i)=>{var n,m,e,u;i.setSubmitting(!0),(!((n=s.whatsapp)!=null&&n.code)||!((m=s.whatsapp)!=null&&m.numbers))&&delete s.whatsapp,(!((e=s.phone_numbers)!=null&&e[0].code)||!((u=s.phone_numbers)!=null&&u[0].numbers))&&delete s.phone_numbers,await l(P({dto:s,onSuccess:()=>{w.success("Пользователь успешно добавлен."),i.resetForm(),A(x=>x+1)},onValidationError:x=>i.setErrors({...x.errors}),onFail:x=>w.error(x)})),i.setSubmitting(!1)},C=s=>()=>{var e;let i="";const n=Object.keys(s)[0];i=n;const m=s[n];if(typeof m=="object"){const u=Object.keys(m)[0];i=`${n}.${u}`}(e=document.body.querySelector(`[name="${i}"]`))==null||e.scrollIntoView({block:"center"})},R=s=>i=>{switch(i.value){case"teacher":s("teacher",{}),s("parent",void 0),s("student",void 0);break;case"parent":s("teacher",void 0),s("parent",{profession_id:0,workplace:"",position:""}),s("student",void 0);break;case"student":s("teacher",void 0),s("parent",void 0),s("student",{grade_id:0,admission_date:"",previous_schools:"",medical_recommendations:""});break;default:s("teacher",void 0),s("parent",void 0),s("student",void 0);break}};return a.jsx(ae,{initialValues:E,validationSchema:te,onSubmit:F,children:({isSubmitting:s,errors:i,values:n,setFieldValue:m})=>a.jsxs(se,{className:"flex flex-col gap-3 md:bg-white md:rounded md:shadow md:px-8 md:py-4 md:grid md:grid-cols-2 lg:grid-cols-3 max-w-7xl",children:[a.jsx(t,{name:"name",label:"Имя",required:!0}),a.jsx(t,{name:"surname",label:"Фамилия",required:!0}),a.jsx(t,{name:"patronymic",label:"Отчество"}),a.jsx(o,{name:"role",label:"Позиция",onChange:R(m),options:T.map(e=>({value:e,label:W[e]})),required:!0}),a.jsx(o,{name:"sex",label:"Пол",options:["male","female"].map(e=>({value:e,label:z[e]})),required:!0}),a.jsx(t,{name:"birth_date",label:"Дата рождения",type:"date",required:!0}),q&&a.jsx(o,{name:"nationality_id",label:"Национальность",options:q.map(({id:e,name:u})=>({value:e,label:u})),required:!0}),a.jsx(t,{type:"email",name:"email",label:"E-mail (если имеется)"}),a.jsx(t,{name:"address.physical_address",label:"Адрес проживания (фактический)",required:!0}),a.jsx(o,{name:"address.region",label:"Район",options:H.map(e=>({value:e,label:e})),required:!0}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx($,{label:"Телефон"}),a.jsxs("div",{className:"flex gap-1 w-full",children:[a.jsxs("div",{className:"relative",children:[a.jsx(t,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:"phone_numbers[0].code",placeholder:"Код"}),a.jsx("span",{className:"absolute top-4 left-3 -translate-y-1/2 text-xl",children:"+"})]}),a.jsx(t,{className:"w-[120px] grow",type:"number",name:"phone_numbers[0].numbers",placeholder:"Номер"})]})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx($,{label:"WhatsApp"}),a.jsxs("div",{className:"flex gap-1 w-full",children:[a.jsxs("div",{className:"relative",children:[a.jsx(t,{className:"w-[88px]",inputClassname:"pl-7",type:"number",name:"whatsapp.code",placeholder:"Код"}),a.jsx("span",{className:"absolute top-4 left-3 -translate-y-1/2 text-xl",children:"+"})]}),a.jsx(t,{className:"w-[120px] grow",type:"number",name:"whatsapp.numbers",placeholder:"Номер"})]})]}),n.role==="teacher"&&f&&a.jsx(o,{name:"teacher.grades",label:"Назначить руководителем класса",multiple:!0,options:f.map(e=>({value:e.id,label:`${e.level} ${e.group}`}))}),n.role==="parent"&&b&&_&&a.jsxs(a.Fragment,{children:[a.jsx(o,{name:"parent.children",label:"Дети",multiple:!0,searchable:!0,options:b.filter(({role:e})=>e==="student").map(e=>({value:e.id,label:`${e.surname} ${e.name} ${e.patronymic??""}`}))}),a.jsx(o,{name:"parent.profession_id",label:"Сфера деятельности",options:_.map(e=>({value:e.id,label:e.name})),required:!0}),a.jsx(t,{name:"parent.workplace",label:"Место работы",required:!0}),a.jsx(t,{name:"parent.position",label:"Должность",required:!0})]}),n.role==="student"&&b&&f&&a.jsxs(a.Fragment,{children:[a.jsx(o,{name:"student.grade_id",label:"Класс",options:f.map(e=>({value:e.id,label:`${e.level} ${e.group}`})),required:!0}),a.jsx(o,{name:"student.mother_id",label:"Мать",searchable:!0,options:b.filter(e=>e.role==="parent"&&e.sex==="female").map(e=>({value:e.id,label:`${e.surname} ${e.name} ${e.patronymic??""}`}))}),a.jsx(o,{name:"student.father_id",label:"Отец",searchable:!0,options:b.filter(e=>e.role==="parent"&&e.sex==="male").map(e=>({value:e.id,label:`${e.surname} ${e.name} ${e.patronymic??""}`}))}),a.jsx(t,{className:"lg:col-span-2",name:"student.admission_date",label:"С какого года ребенок обучается в ЧОУ «Империя знаний»",type:"date",required:!0}),a.jsx(S,{className:"md:col-span-2 lg:col-span-3",name:"student.previous_schools",label:"Перечислите предыдущие школы",placeholder:"Если нет — пишите «Нет»",required:!0}),a.jsx(S,{className:"md:col-span-2 lg:col-span-3",name:"student.medical_recommendations",label:"Медицинские и психологические рекомендации для ребенка",placeholder:"Если нет — пишите «Нет»",required:!0})]}),a.jsx("div",{className:"ml-auto md:col-span-2 lg:col-span-3",children:a.jsx(K,{className:"justify-center md:ml-auto",type:"submit",variant:"success",disabled:s,loading:s,onClick:C(i),children:"Зарегистрировать"})})]})},I)}function Ne(){return a.jsxs("main",{className:"pt-4 pb-40",children:[a.jsx(re,{items:[["Справочник пользователей",L.Users.Index],["Добавить",""]]}),a.jsx("h1",{className:"title mb-1",children:"Регистрация нового пользователя"}),a.jsx(ie,{})]})}export{Ne as default};
