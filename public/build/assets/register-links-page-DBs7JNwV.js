import{r as o,a as d,j as e,P as f,y as u,c as g,Q as h,R as j,u as k,T as w,U as y,S as N,t as p,A as m}from"./main-XRo2qOUM.js";import{B as l}from"./button-Y4UR9_BE.js";import{D as b}from"./data-table-B29iB-Aw.js";import{f as S}from"./index-_akthio-.js";import{M as v}from"./modal-AOG68gOm.js";import{F as A,a as R}from"./formik.esm-Be66R8Pj.js";import"./preload-helper-DPi8upcZ.js";import"./icons-B9HDjQFM.js";import"./use-dropdown-BNrZcIiO.js";import"./index-BIxH57RT.js";function C(a){const[s,t]=o.useState(a.secondsLeft);return o.useEffect(()=>{if(s<=0)return;const n=setInterval(()=>{t(i=>i-1)},1e3);return()=>clearInterval(n)},[s]),S(s)}function F({id:a,setId:s}){const t=d(),n=async(i,r)=>{r.setSubmitting(!0),await t(f({id:a,onSuccess:()=>s(null),onFail:c=>u.error(c)})),r.setSubmitting(!1)};return e.jsx(A,{initialValues:{},onSubmit:n,children:({isSubmitting:i})=>e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удаление ссылки"}),e.jsx(l,{className:"ml-auto",type:"reset",icon:"close",variant:"danger",onClick:()=>s(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"mb-2",children:"Вы уверены что хотите удалить эту ссылку?"})}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(l,{className:"justify-center min-w-[92px]",type:"submit",disabled:i,loading:i,variant:"success",icon:"delete",children:"Удалить"})})]})},a)}function L({link:a}){const[s,t]=o.useState(!1),n=async()=>{try{await navigator.clipboard.writeText(a),t(!0),setTimeout(()=>t(!1),1500)}catch(i){console.log("Failed to copy: ",i)}};return e.jsx(l,{className:g(s&&"text-success"),icon:s?"checked":"copy",variant:"light",onClick:n,children:e.jsx("span",{className:"sr-only",children:"Скопировать ссылку"})})}function $({id:a}){const s=d(),[t,n]=o.useState(!1),i=()=>{n(!0),s(h({id:a,onSuccess:()=>n(!1),onFail:r=>{u.error(r),n(!1)}}))};return e.jsx(l,{icon:"autorenew",variant:"warning",onClick:i,disabled:t,loading:t,children:e.jsx("span",{className:"sr-only",children:"Обновить"})})}function I(){const a=d(),[s,t]=o.useState(!1),n=()=>{t(!0),a(j({onSuccess:()=>t(!1),onFail:i=>{u.error(i),t(!1)}}))};return e.jsx(l,{icon:"add",variant:"success",onClick:n,disabled:s,loading:s,children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Сгенерировать"})})}function H(){var r;const a=d(),s=k(w),[t,n]=o.useState(null);o.useEffect(()=>{!s.data&&!s.isFetching&&a(y())},[a,s.data,s.isFetching]);const i=[{id:"expiresAt",accessorKey:"expiresAt",header:"Срок действия",size:320,cell:({row:c})=>{const x=p(c.original.expiresAt).diff(p(),"second");return e.jsx("div",{className:g("text-lg font-medium",x>0?"text-success":"text-danger"),children:e.jsx(C,{secondsLeft:x})})},meta:{columnClass:"!min-w-[160px] !w-[160px] !max-w-[160px]"}},{id:"token",accessorKey:"token",header:"Ссылка",cell:({row:c})=>e.jsx("a",{className:"text-blue-600",href:`${m.Auth.Register}?token=${c.original.token}`,target:"_blank",children:`${window.location.origin}${m.Auth.Register}?token=${c.original.token}`}),meta:{columnClass:"!min-w-[320px] !w-[320px] !max-w-[320px] sm:!min-w-[640px] sm:!w-[640px] sm:!max-w-[640px] lg:!min-w-[1524px] sm:!w-[1524px] sm:!max-w-[1524px]"}},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:200,cell:({row:c})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{link:`${window.location.origin}${m.Auth.Register}?token=${c.original.token}`}),e.jsx($,{id:c.original.id}),e.jsx(l,{icon:"delete",variant:"danger",onClick:()=>n(c.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]}),meta:{columnClass:"!min-w-[170px] !w-[170px] !max-w-[170px]"}}];return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"pt-4 pb-10",children:[e.jsxs("h1",{className:"title mb-1",children:["Ссылки для регистрации (",(r=s.data)==null?void 0:r.length,")"]}),s.data?e.jsx(b,{data:s.data,columns:i,sortingState:[{id:"expiresAt",desc:!1}],columnPinningState:{right:["actions"]},actions:e.jsx(I,{})}):e.jsx(N,{className:"w-8 h-8"})]}),e.jsx(v,{isOpen:!!t,children:t&&e.jsx(F,{id:t,setId:n})})]})}export{H as default};
