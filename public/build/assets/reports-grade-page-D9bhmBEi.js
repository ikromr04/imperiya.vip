import{f as S,r as h,a as G,u as m,i as u,v as M,n as y,Y as w,j as s,S as A,A as j,L as _,X as E}from"./main-DOJC8ST-.js";import{B as F}from"./breadcrumbs-BXYj8psP.js";import{B}from"./button-BdkHwEk1.js";import{D as R}from"./description-list-Bqc_iF6P.js";import{g as D,a as U}from"./grades-selector-DTsrrSJ9.js";import{g as L,a as P}from"./users-selector-BjidioDu.js";import{e as z}from"./reports-mLEm09XL.js";import"./preload-helper-DPi8upcZ.js";import"./icons-BUoiBP0X.js";import"./FileSaver.min-Cel3sAVr.js";function V(){const v=S(),[l,b]=h.useState(),c=G(),g=m(L),f=m(D),p=m(P),i=m(U),r=(i==null?void 0:i.find(a=>a.id===+(v.id||0)))||null,n=r&&p?p.filter(a=>{var t;return a.role==="student"&&((t=a.student)==null?void 0:t.gradeId)===(r==null?void 0:r.id)}):void 0;h.useEffect(()=>{g===u.Idle&&c(M()),f===u.Idle&&c(y())},[c,f,g]),h.useEffect(()=>{!l&&n&&c(w({ids:n.map(({id:a})=>a),onSuccess:a=>b(a)}))},[c,l,n]);const d=h.useMemo(()=>{const a={};if(l&&i&&p)return l.forEach(t=>{!a[t.studentId]&&(t.score1||t.score2)&&(a[t.studentId]=[]),t.score1&&a[t.studentId].push(t.score1),t.score2&&a[t.studentId].push(t.score2)}),a},[i,l,p]),o=h.useMemo(()=>{if(d&&r&&n){const a=n.map(e=>{const x=d[e.id]?d[e.id].reduce((N,$)=>N+$,0)/d[e.id].length:0;return{id:e.id,name:`${e.surname} ${e.name} ${e.patronymic||""}`,average:x,rounded:Math.round(x)}}),t={excellent:a.filter(e=>e.average&&Math.round(e.average)===5),good:a.filter(e=>e.average&&Math.round(e.average)===4),average:a.filter(e=>e.average&&Math.round(e.average)===3),poor:a.filter(e=>e.average&&Math.round(e.average)===2),noGrades:a.filter(e=>!e.average)};return{classInfo:{class:`${r.level}${r.group}`,totalStudents:n.length,girls:n.filter(({sex:e})=>e==="female").length,boys:n.filter(({sex:e})=>e==="male").length,excellent:{count:t.excellent.length,percent:+(t.excellent.length*100/n.length).toFixed(4)},good:{count:t.good.length,percent:+(t.good.length*100/n.length).toFixed(4)},average:{count:t.average.length,percent:+(t.average.length*100/n.length).toFixed(4)},poor:{count:t.poor.length,percent:+(t.poor.length*100/n.length).toFixed(4)},noGrades:{count:t.noGrades.length,percent:+(t.noGrades.length*100/n.length).toFixed(4)}},students:t}}},[r,d,n]),I={excellent:"Отличники",good:"Четвёрочники",average:"Троечники",poor:"Двоечники",noGrades:"Без оценок"};return o?s.jsxs("main",{className:"pt-2 pb-40 flex flex-col",children:[s.jsxs("h1",{className:"title",children:["Класс ",o.classInfo.class]}),s.jsx(F,{items:[["Отчеты",j.Reports.Index],[`${o.classInfo.class}`,""]]}),s.jsx(B,{className:"max-h-7 ml-auto mb-2",icon:"fileExport",variant:"light",onClick:()=>z(o),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),s.jsxs("section",{className:"box",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:"Общая информация"})}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"box__body",list:{"Количество учеников":`${o.classInfo.totalStudents} (девочек ${o.classInfo.girls} / мальчиков ${o.classInfo.boys})`,Отличники:`${o.classInfo.excellent.count} (${o.classInfo.excellent.percent}%)`,Четвёрочники:`${o.classInfo.good.count} (${o.classInfo.good.percent}%)`,Троечники:`${o.classInfo.average.count} (${o.classInfo.average.percent}%)`,Двоечники:`${o.classInfo.poor.count} (${o.classInfo.poor.percent}%)`,"Без оценок":`${o.classInfo.noGrades.count} (${o.classInfo.noGrades.percent}%)`}}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]}),Object.entries(I).map(([a,t])=>s.jsxs("section",{className:"box mt-4",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:t})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"box__body",children:o.students[a].length?s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[320px]",children:"ФИО"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[140px]",children:"Средний балл"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[160px]",children:"Округлённая оценка"})]})}),s.jsx("tbody",{children:o.students[a].map(e=>{var x;return s.jsxs("tr",{className:"py-1",children:[s.jsx("td",{className:"pr-10",children:s.jsx(_,{className:"text-blue-600",to:E(j.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:(x=e.average)==null?void 0:x.toFixed(5)}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:e.rounded})]},e.id)})})]}):"Нет учеников"}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]},a))]}):s.jsx(A,{className:"w-8 h-8 m-2"})}export{V as default};
