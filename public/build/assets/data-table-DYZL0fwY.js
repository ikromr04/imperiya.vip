import{j as e,c as u,r as R}from"./main-Bv3hUDlE.js";import{I as p}from"./icons-CQR9b9Fl.js";import{u as U}from"./use-dropdown-BI5bdOKY.js";import{f as _,u as q,g as Y,a as Z,b as K,c as Q}from"./index-CYtogc1c.js";import{B as ee}from"./button-CLhFIVpf.js";function te({header:o,columnPinning:f,setColumnPinning:w,setColumnVisibility:S}){var k,h,C,D,F,T,A,P;const{ref:j,isOpen:v,setIsOpen:N,menuRef:x}=U(),a=async()=>{if(j.current&&x.current){await N(!v);const l=j.current.getBoundingClientRect();x.current.style.top=`${l.top+l.height+12}px`,x.current.style.left=`${l.left+l.width}px`;const c=x.current.getBoundingClientRect();c.right>window.innerWidth&&(x.current.style.transform=`translateX(-${c.right-window.innerWidth+32}px)`)}};return e.jsxs("div",{ref:j,className:"relative ml-auto column-filter",children:[e.jsx("button",{className:u("justify-center items-center min-w-6 min-h-6 rounded-full bg-gray-100 hover:bg-gray-200",(k=f.left)!=null&&k.includes(o.column.id)||(h=f.right)!=null&&h.includes(o.column.id)||o.column.getCanFilter()?"flex text-error":"hidden group-hover:flex"),onClick:a,children:e.jsx(p.moreVert,{width:3})}),e.jsxs("div",{ref:x,className:u("fixed top-full z-30 min-w-max flex-col py-1 bg-white rounded border shadow transform font-normal",v?"flex":"hidden"),onClick:l=>!l.target.closest(".column-filter-header")&&N(!1),children:[e.jsxs("div",{className:"flex flex-col column-filter-header px-3 py-1",children:[e.jsx("h3",{className:"text-sm leading-none text-gray-400 mb-1",children:_(o.column.columnDef.header,o.getContext())}),(D=(C=o.column.columnDef.meta)==null?void 0:C.renderFilter)==null?void 0:D.call(C,o.column,N)]}),e.jsx("hr",{className:"my-1"}),!((F=f.left)!=null&&F.includes(o.column.id))&&e.jsxs("button",{className:"flex items-center gap-2 pl-3 pr-4 py-1 transition-all duration-150 hover:bg-gray-100",type:"button",onClick:()=>w(l=>{var c;return{left:l.left&&(l.left.includes(o.column.id)?[...l.left]:[...l.left,o.column.id]),right:(c=l.right)==null?void 0:c.filter(i=>i!==o.column.id)}}),children:[e.jsx("span",{className:"flex items-center justify-center w-4 h-4",children:e.jsx(p.keep,{className:"transform rotate-[30deg]",width:10})}),"Закрепить слева"]}),!((T=f.right)!=null&&T.includes(o.column.id))&&e.jsxs("button",{className:"flex items-center gap-2 pl-3 pr-4 py-1 transition-all duration-150 hover:bg-gray-100",type:"button",onClick:()=>w(l=>{var c;return{left:(c=l.left)==null?void 0:c.filter(i=>i!==o.column.id),right:l.right&&(l.right.includes(o.column.id)?[...l.right]:[...l.right,o.column.id])}}),children:[e.jsx("span",{className:"flex items-center justify-center w-4 h-4",children:e.jsx(p.keep,{className:"transform -rotate-[30deg]",width:10})}),"Закрепить справа"]}),(((A=f.right)==null?void 0:A.includes(o.column.id))||((P=f.left)==null?void 0:P.includes(o.column.id)))&&e.jsxs("button",{className:"flex items-center gap-2 pl-3 pr-4 py-1 transition-all duration-150 hover:bg-gray-100",type:"button",onClick:()=>w(l=>{var c,i;return{left:(c=l.left)==null?void 0:c.filter(z=>z!==o.column.id),right:(i=l.right)==null?void 0:i.filter(z=>z!==o.column.id)}}),children:[e.jsx("span",{className:"flex items-center justify-center w-4 h-4",children:e.jsx(p.keep,{className:"opacity-0",width:10})}),"Открепить"]}),e.jsx("hr",{className:"my-1"}),e.jsxs("button",{className:"flex items-center gap-2 pl-3 pr-4 py-1 transition-all duration-150 hover:bg-gray-100",type:"button",onClick:()=>S(l=>({...l,[o.column.id]:!1})),children:[e.jsx("span",{className:"flex items-center justify-center w-4 h-4",children:e.jsx(p.visibilityOff,{width:16})}),"Скрыть столбец"]})]})]})}function ne({table:o,columnVisibility:f,setColumnVisibility:w}){const{ref:S,isOpen:j,setIsOpen:v}=U(),N=o.getAllColumns().map(a=>({id:a.columnDef.id,header:a.columnDef.header})),x=a=>k=>{k.target.checked?w(h=>({...h,[a]:!0})):w(h=>({...h,[a]:!1}))};return e.jsxs("div",{ref:S,className:"relative z-30",children:[e.jsxs("button",{className:"flex items-center gap-2 h-8 text-blue-700",type:"button",onClick:()=>v(!j),children:[e.jsx(p.viewColumn,{width:16}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Столбцы"})]}),e.jsx("div",{className:u("absolute left-0 top-full bg-white py-1 border rounded shadow max-h-[240px] overflow-y-auto overflow-x-hidden styled-scrollbar",j?"visible opacity-100":"invisible opacity-0"),children:N.map(a=>e.jsxs("label",{className:"flex items-center gap-2 min-w-max pl-3 pr-5 h-8 transition-all duration-150 hover:bg-gray-100 cursor-pointer",children:[e.jsx("input",{type:"checkbox",onChange:x(a.id),checked:f[a.id]===void 0?!0:f[a.id]}),a.header]},a.id))})]})}const se=16,le=[],oe={},ie={left:[],right:[]};function me({data:o,columns:f,className:w,pageSize:S=se,sortingState:j=le,visibilityState:v=oe,columnPinningState:N=ie,actions:x,onExport:a,searchValue:k,onSearchInput:h}){const[C,D]=R.useState(""),[F,T]=R.useState({pageIndex:0,pageSize:S}),[A,P]=R.useState(j),[l,c]=R.useState(v),[i,z]=R.useState(N),$=R.useRef(null),m=q({data:o,columns:f,defaultColumn:{maxSize:Number.MAX_SAFE_INTEGER,sortDescFirst:!1,enableSorting:!0,enableColumnFilter:!1},getCoreRowModel:Q(),getSortedRowModel:K(),getFilteredRowModel:Z(),getPaginationRowModel:Y(),state:{sorting:A,globalFilter:C,columnVisibility:l,pagination:F,columnPinning:i},onSortingChange:P,onGlobalFilterChange:D,onColumnVisibilityChange:c,onPaginationChange:T,onColumnPinningChange:z}),E=m.getPageCount(),I=m.getState().pagination.pageIndex+1,H=()=>{const n=[];if(E<=7)for(let s=1;s<=E;s++)n.push(s);else{n.push(1),I>4&&n.push("...");const s=Math.max(2,I-2),r=Math.min(E-1,I+2);for(let d=s;d<=r;d++)n.push(d);I<E-3&&n.push("..."),n.push(E)}return n},L=m.getHeaderGroups()[0].headers.map(n=>({id:n.column.id,size:n.getSize()})),O=n=>{if(i.left){const t=i.left.findIndex(r=>r===n);return t&&t<0?{}:{left:`${i.left.reduce((r,d,b)=>{var g;return b<t&&(r+=((g=L.find(y=>y.id===d))==null?void 0:g.size)||0),r},0)}px`}}return{}},W=n=>{if(i.right){const t=i.right.findIndex(r=>r===n);return t&&t<0?{}:{right:`${i.right.reduce((r,d,b)=>{var g;return b<t&&(r+=((g=L.find(y=>y.id===d))==null?void 0:g.size)||0),r},0)}px`}}return{}},V=n=>{const t=p[n==="desc"?"arrowDownwardAlt":"arrowUpwardAlt"];return e.jsx("span",{className:u("flex justify-center items-center min-w-6 min-h-6 rounded-full hover:bg-black/5",!n&&"hidden opacity-40 group-hover:flex"),children:e.jsx(t,{width:10})})},M=n=>{if($.current){const{scrollLeft:t}=n.currentTarget;$.current.querySelectorAll(".sync-scroll").forEach(s=>{s.scrollLeft=t})}},J=n=>{h?h(n):D(n.target.value)};return e.jsxs("div",{className:u("rounded-md shadow border bg-white",w),children:[e.jsxs("div",{className:"flex gap-4 p-2 pl-4 border-b relative z-50",children:[e.jsx(ne,{table:m,columnVisibility:l,setColumnVisibility:c}),e.jsxs("label",{className:"flex grow items-center gap-2 h-8 cursor-pointer text-blue-700",children:[e.jsx(p.search,{width:14}),e.jsx("input",{className:"flex cursor-pointer focus:cursor-auto grow min-w-none w-full focus:outline-none placeholder:text-inherit focus:placeholder:font-normal focus:placeholder:text-gray-400",type:"search",placeholder:"Искать",value:k||C,onInput:J})]}),e.jsxs("div",{className:"flex gap-2",children:[a&&e.jsx(ee,{icon:"fileExport",variant:"light",onClick:()=>a(o,l),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),x]})]}),e.jsxs("table",{ref:$,className:"flex flex-col w-full",children:[e.jsx("thead",{className:"sticky top-0 z-40 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:M,children:m.getHeaderGroups().map(n=>e.jsxs("tr",{children:[e.jsx("th",{className:"relative p-2 min-w-10 w-10 max-w-10 text-start bg-gray-100 cursor-pointer group",children:e.jsx("span",{className:"absolute left-0 top-0 w-full h-full flex items-end p-2",children:"№"})}),n.headers.map(t=>{var s,r,d,b,g,y,G,B;return e.jsx("th",{className:u("p-0 text-start bg-gray-100 cursor-pointer group",((s=i.left)==null?void 0:s.includes(t.column.id))&&"sticky z-10",((r=i.right)==null?void 0:r.includes(t.column.id))&&"sticky z-10",(d=t.column.columnDef.meta)==null?void 0:d.columnClass),onClick:X=>!X.target.closest(".column-filter")&&t.column.toggleSorting(),style:{minWidth:`${t.getSize()}px`,width:`${t.getSize()}px`,maxWidth:`${t.getSize()}px`,...O(t.column.id),...W(t.column.id)},children:e.jsxs("div",{className:u("flex p-2 border-gray-200",((b=i.left)==null?void 0:b.includes(t.column.id))&&"border-r",((g=i.right)==null?void 0:g.includes(t.column.id))&&"border-l",(y=t.column.columnDef.meta)==null?void 0:y.thClass),children:[(G=t.column.columnDef.meta)!=null&&G.renderHeader?(B=t.column.columnDef.meta)==null?void 0:B.renderHeader(t.column):e.jsx("span",{className:"text-start truncate select-none",children:_(t.column.columnDef.header,t.getContext())}),t.column.getCanSort()&&V(t.column.getIsSorted()),e.jsx(te,{header:t,columnPinning:i,setColumnPinning:z,setColumnVisibility:c})]})},t.id)})]},n.id))}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll",onScroll:M,children:m.getRowModel().rows.map((n,t)=>e.jsxs("tr",{className:u(t%2?"bg-gray-50":"bg-white"),children:[e.jsx("td",{className:u("relative p-2 min-w-10 w-10 max-w-10",t%2?"bg-gray-50":"bg-white"),children:(I-1)*S+t+1}),n.getVisibleCells().map(s=>{var r,d,b,g,y;return e.jsx("td",{className:u("p-0",t%2?"bg-gray-50":"bg-white",((r=i.left)==null?void 0:r.includes(s.column.id))&&"sticky left-0 z-10",((d=i.right)==null?void 0:d.includes(s.column.id))&&"sticky right-0 z-10",(b=s.column.columnDef.meta)==null?void 0:b.columnClass),style:{minWidth:`${s.column.getSize()}px`,width:`${s.column.getSize()}px`,maxWidth:`${s.column.getSize()}px`,...O(s.column.id),...W(s.column.id)},children:e.jsx("div",{className:u("p-2 h-full before:absolute before:top-0 before:w-[1px] before:h-full before:bg-transparent",((g=i.left)==null?void 0:g.includes(s.column.id))&&"before:right-0 before:!bg-gray-200",((y=i.right)==null?void 0:y.includes(s.column.id))&&"before:left-0 before:!bg-gray-200"),children:_(s.column.columnDef.cell,s.getContext())})},JSON.stringify(s))})]},JSON.stringify(n.original)))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:M,children:m.getHeaderGroups().map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-t p-0 min-w-10 w-10 max-w-10"}),n.headers.map(t=>{var s;return e.jsx("td",{className:u("border-t p-0",(s=t.column.columnDef.meta)==null?void 0:s.columnClass),style:{minWidth:t.getSize()?`${t.getSize()}px`:"auto",width:t.getSize()?`${t.getSize()}px`:"auto",maxWidth:t.getSize()?`${t.getSize()}px`:"auto"}},t.id)})]},n.id))})]}),e.jsx("div",{className:"sticky bottom-0 z-10 rounded-b-md p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto",children:[e.jsx("button",{className:"flex justify-center items-center h-8 w-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>m.previousPage(),disabled:!m.getCanPreviousPage(),children:e.jsx(p.previous,{width:7})}),H().map((n,t)=>e.jsx("button",{className:u("flex justify-center items-center h-8 rounded-md border transform hover:font-bold",I===n?"w-10 bg-white border-gray-200 pointer-events-none":"w-8 border-transparent",n==="..."?"pointer-events-none":"disabled:opacity-50 disabled:pointer-events-none"),onClick:()=>typeof n=="number"&&m.setPageIndex(n-1),disabled:n==="...",children:n},t)),e.jsx("button",{className:"flex justify-center items-center h-8 w-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>m.nextPage(),disabled:!m.getCanNextPage(),children:e.jsx(p.next,{width:7})})]})})]})}export{me as D};
