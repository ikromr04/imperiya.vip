import{a as u,j as e,x as v,y as m,z as D,B as F,u as p,g as w,r as d,i as C,C as E,S as T}from"./main-DzOvJ3Bl.js";import{g as A,a as k}from"./subjects-selector-CkFIZtiD.js";import{D as O}from"./data-table-DhQGkLo7.js";import{B as o}from"./button-BK2ewXLd.js";import{M as V}from"./modal-1koiJ247.js";import{T as g}from"./text-field-yJsTwbK9.js";import{F as h,a as f}from"./formik.esm-Cpulkf5n.js";import{c as y,a as N}from"./index.esm-BCp_SAnH.js";import"./preload-helper-BfFHrpNk.js";import"./icons-B5TgyNC1.js";import"./use-dropdown-D7UlQ3WZ.js";import"./index-D18-tjuz.js";import"./cleanable-37L1pogH.js";import"./index.browser-OxPLOBIU.js";const q=y().shape({name:N().required("Обязательное поле.")});function z({dto:r,setDTO:t}){const a=u(),n={name:r.name},i=async(s,c)=>{c.setSubmitting(!0),await a(v({name:s.name,onSuccess:()=>{m.success("Предмет успешно добавлен."),t(null)},onValidationError:l=>c.setErrors({...l.errors}),onFail:l=>m.success(l)})),c.setSubmitting(!1)};return e.jsx(h,{initialValues:n,validationSchema:q,onSubmit:i,children:({isSubmitting:s})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление предмета"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>t(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(g,{className:"mb-4",name:"name",label:"Название предмета",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Добавить"})})]})})}const B=y().shape({name:N().required("Обязательное поле.")});function K({dto:r,setDTO:t}){const a=u(),n={id:r.id,name:r.name},i=async(s,c)=>{c.setSubmitting(!0),await a(D({dto:s,onSuccess:()=>{m.success("Предмет успешно обновлен."),t(null)},onValidationError:l=>c.setErrors({...l.errors}),onFail:l=>m.success(l)})),c.setSubmitting(!1)};return e.jsx(h,{initialValues:n,validationSchema:B,onSubmit:i,children:({isSubmitting:s})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование предмета"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>t(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(g,{className:"mb-4",name:"name",label:"Название предмета",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Сохранить"})})]})})}function $({dto:r,setDTO:t}){const a=u(),n=async(i,s)=>{s.setSubmitting(!0),await a(F({id:r,onSuccess:()=>{m.success("Предмет успешно удален."),t(null)}})),s.setSubmitting(!1)};return e.jsx(h,{initialValues:{},onSubmit:n,children:({isSubmitting:i})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удаление предмета"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>t(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить этот предмет?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:i,loading:i,variant:"success",children:"Удалить"})})]})})}function U(){const r=u(),t=p(A),a=p(w),n=p(k),[i,s]=d.useState(null),[c,l]=d.useState(null),[j,b]=d.useState(null);d.useEffect(()=>{t==C.Idle&&r(E())},[r,t]);let S=[{id:"name",accessorKey:"name",header:"Название",size:1686}];return(a==null?void 0:a.role)==="superadmin"&&(S=[{id:"name",accessorKey:"name",header:"Название",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:x})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{icon:"edit",variant:"warning",onClick:()=>l({id:x.original.id,name:x.original.name}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(o,{icon:"delete",variant:"danger",onClick:()=>b(x.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})}]),e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"py-2",children:[e.jsxs("h1",{className:"title mb-1 px-3",children:["Предметы (",n==null?void 0:n.length,")"]}),n?e.jsx(O,{data:n,columns:S,sortingState:[{id:"name",desc:!1}],columnPinningState:{right:["actions"]},actions:(a==null?void 0:a.role)==="superadmin"&&e.jsx(o,{icon:"add",variant:"success",onClick:()=>s({name:""}),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(T,{className:"w-8 h-8"})]}),e.jsxs(V,{isOpen:!!(i||c||j),children:[i&&e.jsx(z,{dto:i,setDTO:s}),c&&e.jsx(K,{dto:c,setDTO:l}),j&&e.jsx($,{dto:j,setDTO:b})]})]})}export{U as default};
