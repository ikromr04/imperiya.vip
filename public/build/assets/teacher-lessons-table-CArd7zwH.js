import{u as p,g as M,t as a,j as e,L as S,A as D,c as y,a as k,r as b,i as Y,C as I,n as L,ae as A,S as z}from"./main-DzOvJ3Bl.js";import{I as j}from"./icons-B5TgyNC1.js";import{b as C,c as N}from"./index-DnzxYe6g.js";import{H as _,L as E}from"./lesson-hour-BRJkREIE.js";import{g as G,a as R}from"./grades-selector-XXuKk_5g.js";import{g as $,a as H}from"./subjects-selector-CkFIZtiD.js";import"./preload-helper-BfFHrpNk.js";function T({date:l,hour:d,subjects:m,lessons:x,grades:f}){const o=p(M),c=x.filter(t=>a(t.date).format("YYYY-MM-DD")===a(l).format("YYYY-MM-DD")&&+t.hour==+d);if(!c)return;const n=f.filter(({id:t})=>c.some(r=>r.gradeId===t));return e.jsx("div",{className:"flex justify-evenly text-center leading-none group",children:c.map(t=>{var h;const r=n.find(({id:i})=>i===t.gradeId);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-center text-sm items-baseline",children:e.jsxs(S,{className:y("duration-150 hover:text-blue-600 truncate text-lg leading-none font-bold",(o==null?void 0:o.role)==="admin"&&"pointer-events-none"),to:`${D.Journal}?gradeId=${t.gradeId}&subjectId=${t.subjectId}`,children:[r==null?void 0:r.level," ",r==null?void 0:r.group]})}),e.jsxs("span",{className:"truncate text-sm leading-none",children:["(",(h=m.find(({id:i})=>i===t.subjectId))==null?void 0:h.name,")"]})]},t.id)})})}function K({user:l}){const d=k(),m=p(M),[x,f]=b.useState(null),[o,c]=b.useState(0),n=C(o),t=b.useRef(null),r=p($),h=p(G),i=p(H),w=p(R);b.useEffect(()=>{r===Y.Idle&&d(I()),h===Y.Idle&&d(L()),!x&&m&&d(A({week:o,teacherId:(l==null?void 0:l.id)||m.id,onSuccess:s=>f(s)}))},[m,d,h,x,r,l==null?void 0:l.id,o]);const g=s=>{if(t.current){const{scrollLeft:u}=s.currentTarget;t.current.querySelectorAll(".sync-scroll").forEach(v=>{v.scrollLeft=u})}};return!x||!i||!m||!w?e.jsx(z,{className:"w-8 h-8"}):e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)] max-w-full",children:[e.jsxs("table",{ref:t,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(j.calendar,{className:"relative top-[1px]",height:16}),N(a(n[0]).format("MMMM")),a(n[0]).format("M")!==a(n[5]).format("M")&&` - ${N(a(n[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:g,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),n.map(s=>e.jsx("th",{className:y("p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",a(s).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")&&"bg-green-50"),children:N(s.format("dddd - DD"))},a(s).format()))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:g,children:Object.keys(_).map(s=>e.jsxs("tr",{className:"min-h-[53px] h-[53px] max-h-[53px] border-b",children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-0 z-10 bg-white",children:e.jsx("div",{className:"absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",children:s})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(E,{hour:+s})}),n.map(u=>e.jsx("td",{className:y("relative z-0 p-2 border-l min-w-[260px] w-[260px] max-w-[260px]",a(u).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:i&&w&&e.jsx(T,{date:u,hour:Number(s),subjects:i,lessons:x,grades:w})},a(u).format()))]},s))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:g,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),n.map(s=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},a(s).format()))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{c(s=>s-1),f(null)},children:[e.jsx(j.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),o!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{c(0),f(null)},children:[e.jsx(j.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{c(s=>s+1),f(null)},children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(j.next,{width:7})]})]})})]})}export{K as default};
