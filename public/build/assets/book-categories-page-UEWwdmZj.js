import{a as u,j as e,a4 as S,y as d,a5 as v,a6 as C,u as g,r as m,i as k,a7 as B,S as D}from"./main-Bv3hUDlE.js";import{D as F}from"./data-table-DYZL0fwY.js";import{B as o}from"./button-CLhFIVpf.js";import{M as w}from"./modal-Ds3mSBEq.js";import{g as E,a as T}from"./books-selector-DiTYnA5N.js";import{T as f}from"./text-field-BcnIF0Fw.js";import{F as j,a as p}from"./formik.esm-BX1ESkeW.js";import{c as y,a as N}from"./index.esm-Dc9HbSVZ.js";import"./preload-helper-BfFHrpNk.js";import"./icons-CQR9b9Fl.js";import"./use-dropdown-BI5bdOKY.js";import"./index-CYtogc1c.js";import"./cleanable-BufJnOkS.js";import"./index.browser-OxPLOBIU.js";const A=y().shape({title:N().required("Обязательное поле.")});function O({dto:l,setDTO:t}){const a=u(),r={title:l.title},n=async(s,c)=>{c.setSubmitting(!0),await a(S({title:s.title,onSuccess:()=>{d.success("Категория успешно добавлена."),t(null)},onValidationError:i=>c.setErrors({...i.errors}),onFail:i=>d.success(i)})),c.setSubmitting(!1)};return e.jsx(j,{initialValues:r,validationSchema:A,onSubmit:n,children:({isSubmitting:s})=>e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление категории"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>t(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(f,{className:"mb-4",name:"title",label:"Название",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Добавить"})})]})})}const V=y().shape({title:N().required("Обязательное поле.")});function q({dto:l,setDTO:t}){const a=u(),r={id:l.id,title:l.title},n=async(s,c)=>{c.setSubmitting(!0),await a(v({dto:s,onSuccess:()=>{d.success("Категория успешно обновлена."),t(null)},onValidationError:i=>c.setErrors({...i.errors}),onFail:i=>d.success(i)})),c.setSubmitting(!1)};return e.jsx(j,{initialValues:r,validationSchema:V,onSubmit:n,children:({isSubmitting:s})=>e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>t(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(f,{className:"mb-4",name:"title",label:"Название",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Сохранить"})})]})})}function $({dto:l,setDTO:t}){const a=u(),r=async(n,s)=>{s.setSubmitting(!0),await a(C({id:l,onSuccess:()=>{d.success("Категория успешно удалена."),t(null)}})),s.setSubmitting(!1)};return e.jsx(j,{initialValues:{},onSubmit:r,children:({isSubmitting:n})=>e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удалить категорию"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>t(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:n,loading:n,variant:"success",children:"Удалить"})})]})})}function Y(){const l=u(),t=g(E),a=g(T),[r,n]=m.useState(null),[s,c]=m.useState(null),[i,h]=m.useState(null);m.useEffect(()=>{t===k.Idle&&l(B())},[t,l]);const b=[{id:"title",accessorKey:"title",header:"Название",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:x})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{icon:"edit",variant:"warning",onClick:()=>c({id:x.original.id,title:x.original.title}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(o,{icon:"delete",variant:"danger",onClick:()=>h(x.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"py-2",children:[e.jsxs("h1",{className:"title mb-1 px-3",children:["Категории книг (",a==null?void 0:a.length,")"]}),a?e.jsx(F,{data:a,columns:b,sortingState:[{id:"title",desc:!1}],columnPinningState:{right:["actions"]},actions:e.jsx(o,{icon:"add",variant:"success",onClick:()=>n({title:""}),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(D,{className:"w-8 h-8"})]}),e.jsxs(w,{isOpen:!!(r||s||i),children:[r&&e.jsx(O,{dto:r,setDTO:n}),s&&e.jsx(q,{dto:s,setDTO:c}),i&&e.jsx($,{dto:i,setDTO:h})]})]})}export{Y as default};
