import{a as u,j as s,a0 as v,y as d,a1 as D,a2 as R,u as j,g as F,r as m,i as w,a3 as E,S as T}from"./main-DzOvJ3Bl.js";import{D as A}from"./data-table-DhQGkLo7.js";import{B as o}from"./button-BK2ewXLd.js";import{M as C}from"./modal-1koiJ247.js";import{g as k,a as O}from"./reasons-selector-BU2UGHTt.js";import{T as N}from"./text-field-yJsTwbK9.js";import{F as h,a as f}from"./formik.esm-Cpulkf5n.js";import{c as b,a as S}from"./index.esm-BCp_SAnH.js";import"./preload-helper-BfFHrpNk.js";import"./icons-B5TgyNC1.js";import"./use-dropdown-D7UlQ3WZ.js";import"./index-D18-tjuz.js";import"./cleanable-37L1pogH.js";import"./index.browser-OxPLOBIU.js";const V=b().shape({description:S().required("Обязательное поле.")});function q({dto:l,setDTO:a}){const t=u(),i={description:l.description},n=async(e,c)=>{c.setSubmitting(!0),await t(v({description:e.description,onSuccess:()=>{d.success("Причина успешно добавлена."),a(null)},onValidationError:r=>c.setErrors({...r.errors}),onFail:r=>d.success(r)})),c.setSubmitting(!1)};return s.jsx(h,{initialValues:i,validationSchema:V,onSubmit:n,children:({isSubmitting:e})=>s.jsxs(f,{children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[s.jsx("h3",{className:"title",children:"Добавление причины"}),s.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>a(null),children:s.jsx("span",{className:"sr-only",children:"Отмена"})})]}),s.jsx(N,{className:"mb-4",name:"description",label:"Описание",required:!0}),s.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:s.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:e,loading:e,variant:"success",children:"Добавить"})})]})})}const z=b().shape({description:S().required("Обязательное поле.")});function K({dto:l,setDTO:a}){const t=u(),i={id:l.id,description:l.description},n=async(e,c)=>{c.setSubmitting(!0),await t(D({dto:e,onSuccess:()=>{d.success("Причина успешно обновлена."),a(null)},onValidationError:r=>c.setErrors({...r.errors}),onFail:r=>d.success(r)})),c.setSubmitting(!1)};return s.jsx(h,{initialValues:i,validationSchema:z,onSubmit:n,children:({isSubmitting:e})=>s.jsxs(f,{children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[s.jsx("h3",{className:"title",children:"Редактирование"}),s.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>a(null),children:s.jsx("span",{className:"sr-only",children:"Отмена"})})]}),s.jsx(N,{className:"mb-4",name:"description",label:"Описание",required:!0}),s.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:s.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:e,loading:e,variant:"success",children:"Сохранить"})})]})})}function $({dto:l,setDTO:a}){const t=u(),i=async(n,e)=>{e.setSubmitting(!0),await t(R({id:l,onSuccess:()=>{d.success("Причина успешно удалена."),a(null)}})),e.setSubmitting(!1)};return s.jsx(h,{initialValues:{},onSubmit:i,children:({isSubmitting:n})=>s.jsxs(f,{children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[s.jsx("h3",{className:"title",children:"Удалить причину"}),s.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>a(null),children:s.jsx("span",{className:"sr-only",children:"Отмена"})})]}),s.jsx("p",{children:"Вы уверены что хотите удалить?"}),s.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:s.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:n,loading:n,variant:"success",children:"Удалить"})})]})})}function U(){const l=u(),a=j(k),t=j(O),i=j(F),[n,e]=m.useState(null),[c,r]=m.useState(null),[p,g]=m.useState(null);m.useEffect(()=>{a===w.Idle&&l(E())},[l,a]);let y=[{id:"description",accessorKey:"description",header:"Описание",size:1686}];return(i==null?void 0:i.role)==="superadmin"&&(y=[{id:"description",accessorKey:"description",header:"Описание",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:x})=>s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(o,{icon:"edit",variant:"warning",onClick:()=>r({id:x.original.id,description:x.original.description}),children:s.jsx("span",{className:"sr-only",children:"Редактировать"})}),s.jsx(o,{icon:"delete",variant:"danger",onClick:()=>g(x.original.id),children:s.jsx("span",{className:"sr-only",children:"Удалить"})})]})}]),s.jsxs(s.Fragment,{children:[s.jsxs("main",{className:"py-2",children:[s.jsxs("h1",{className:"title mb-1 px-3",children:["Причины (",t==null?void 0:t.length,")"]}),t?s.jsx(A,{data:t,columns:y,sortingState:[{id:"description",desc:!1}],columnPinningState:{right:["actions"]},actions:(i==null?void 0:i.role)==="superadmin"&&s.jsx(o,{icon:"add",variant:"success",onClick:()=>e({description:""}),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):s.jsx(T,{className:"w-8 h-8"})]}),s.jsxs(C,{isOpen:!!(n||c||p),children:[n&&s.jsx(q,{dto:n,setDTO:e}),c&&s.jsx(K,{dto:c,setDTO:r}),p&&s.jsx($,{dto:p,setDTO:g})]})]})}export{U as default};
