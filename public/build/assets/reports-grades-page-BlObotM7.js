import{r as d,a as I,u as h,i as g,v as S,n as $,Y as G,j as s,S as y,A as u,L as M,X as w}from"./main-BjKjkFnO.js";import{B as A}from"./breadcrumbs-CzH_7Pz9.js";import{B as E}from"./button-C0MfaOJU.js";import{D as _}from"./description-list-DhGr_30r.js";import{R}from"./users-DUqPc0QS.js";import{g as F,a as B}from"./grades-selector-vTNl7uIh.js";import{g as D,a as U}from"./users-selector-5OWV2O4j.js";import{e as L}from"./reports-Ca94wfXG.js";import"./preload-helper-BfFHrpNk.js";import"./icons-2GKCzqG_.js";import"./FileSaver.min-Bu_h6g19.js";function Q(){const[o,j]=d.useState(),l=I(),m=h(D),p=h(F),x=h(U),f=h(B),n=x?x.filter(a=>a.role==="student"):void 0;d.useEffect(()=>{m===g.Idle&&l(S()),p===g.Idle&&l($())},[l,p,m]),d.useEffect(()=>{!o&&n&&l(G({ids:n.map(({id:a})=>a),onSuccess:a=>j(a)}))},[l,o,n]);const c=d.useMemo(()=>{const a={};if(o&&f&&x)return o.forEach(t=>{!a[t.studentId]&&(t.score1||t.score2)&&(a[t.studentId]=[]),t.score1&&a[t.studentId].push(t.score1),t.score2&&a[t.studentId].push(t.score2)}),a},[f,o,x]),r=d.useMemo(()=>{if(c&&n){const a=n.map(e=>{const i=c[e.id]?c[e.id].reduce((N,b)=>N+b,0)/c[e.id].length:0;return{id:e.id,name:`${e.surname} ${e.name} ${e.patronymic||""}`,average:i,rounded:Math.round(i)}}),t={excellent:a.filter(e=>e.average&&Math.round(e.average)===5),good:a.filter(e=>e.average&&Math.round(e.average)===4),average:a.filter(e=>e.average&&Math.round(e.average)===3),poor:a.filter(e=>e.average&&Math.round(e.average)===2),noGrades:a.filter(e=>!e.average)};return{classInfo:{class:"Все классы",totalStudents:n.length,girls:n.filter(({sex:e})=>e==="female"),boys:n.filter(({sex:e})=>e==="male"),excellent:{count:t.excellent.length,percent:+(t.excellent.length*100/n.length).toFixed(2)},good:{count:t.good.length,percent:+(t.good.length*100/n.length).toFixed(2)},average:{count:t.average.length,percent:+(t.average.length*100/n.length).toFixed(2)},poor:{count:t.poor.length,percent:+(t.poor.length*100/n.length).toFixed(2)},noGrades:{count:t.noGrades.length,percent:+(t.noGrades.length*100/n.length).toFixed(2)}},students:t}}},[c,n]),v={excellent:"Отличники",good:"Четвёрочники",average:"Троечники",poor:"Двоечники",noGrades:"Без оценок"};return r?s.jsxs("main",{className:"pt-2 pb-40 flex flex-col",children:[s.jsxs("h1",{className:"title",children:["Класс ",r.classInfo.class]}),s.jsx(A,{items:[["Отчеты",u.Reports.Index],[`${r.classInfo.class}`,""]]}),s.jsx(E,{className:"max-h-7 ml-auto mb-2",icon:"fileExport",variant:"light",onClick:()=>L(r),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),s.jsxs("section",{className:"box",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:"Общая информация"})}),s.jsxs("div",{className:"relative",children:[s.jsx(_,{className:"box__body",list:{"Количество учеников":s.jsxs("div",{className:"flex justify-between gap-8",children:[r.classInfo.totalStudents," (девочек ",r.classInfo.girls.length," / мальчиков ",r.classInfo.boys.length,")",s.jsx("div",{className:"flex flex-col",children:R.map(a=>s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:a})," (девочек ",r.classInfo.girls.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===a}).length," / мальчиков ",r.classInfo.boys.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===a}).length,")"]}))})]}),Отличники:`${r.classInfo.excellent.count} (${r.classInfo.excellent.percent}%)`,Четвёрочники:`${r.classInfo.good.count} (${r.classInfo.good.percent}%)`,Троечники:`${r.classInfo.average.count} (${r.classInfo.average.percent}%)`,Двоечники:`${r.classInfo.poor.count} (${r.classInfo.poor.percent}%)`,"Без оценок":`${r.classInfo.noGrades.count} (${r.classInfo.noGrades.percent}%)`}}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]}),Object.entries(v).map(([a,t])=>s.jsxs("section",{className:"box mt-4",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:t})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"box__body",children:r.students[a].length?s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[320px]",children:"ФИО"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[140px]",children:"Средний балл"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[160px]",children:"Округлённая оценка"})]})}),s.jsx("tbody",{children:r.students[a].map(e=>{var i;return s.jsxs("tr",{className:"py-1",children:[s.jsx("td",{className:"pr-10",children:s.jsx(M,{className:"text-blue-600",to:w(u.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:(i=e.average)==null?void 0:i.toFixed(2)}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:e.rounded})]},e.id)})})]}):"Нет учеников"}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]},a))]}):s.jsx(y,{className:"w-8 h-8 m-2"})}export{Q as default};
