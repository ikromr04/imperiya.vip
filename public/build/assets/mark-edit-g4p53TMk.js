import{a as f,j as e,ag as p,y as d,r as u}from"./main-XRo2qOUM.js";import{I as h}from"./icons-B9HDjQFM.js";import{B as g}from"./button-Y4UR9_BE.js";import{C as j}from"./content-field-tIYjuVXj.js";import{S as b}from"./select-field-DvwDrwa-.js";import{T as x}from"./text-field-DZyLsNjz.js";import{A as w}from"./marks-KWTxiGgr.js";import{F as y,a as N}from"./formik.esm-Be66R8Pj.js";import"./preload-helper-DPi8upcZ.js";import"./cleanable-vEQcTMeq.js";import"./use-dropdown-BNrZcIiO.js";import"./index.browser-OxPLOBIU.js";function v({dto:i,onSuccess:r}){const c=f(),a=i,l=async(t,n)=>{n.setSubmitting(!0),await c(p({dto:t,onSuccess:s=>{r&&r(s),d.success("Данные успешно сохранены.")},onValidationError:s=>n.setErrors({...s.errors}),onFail:s=>d.success(s)})),n.setSubmitting(!1)};return e.jsx(y,{initialValues:a,onSubmit:l,children:({isSubmitting:t,setFieldValue:n,values:s})=>e.jsxs(N,{className:"flex flex-col px-2 gap-2",children:[e.jsx(b,{name:"attendance",label:"Посещаемость",onChange:m=>{const o=m.value;["P","L"].includes(o.toString())||(n("score_1",null),n("score_2",null)),n("attendance",o)},options:Object.entries(w).map(([m,o])=>({value:m,label:o}))}),s.attendance&&["P","L"].includes(s.attendance)&&e.jsxs("div",{className:"flex gap-x-2 items-center",children:[e.jsx(x,{className:"grow min-w-0",name:"score_1",label:"Оценка 1",autoFocus:!0}),e.jsx("span",{className:"translate-y-2",children:"/"}),e.jsx(x,{className:"grow min-w-0",name:"score_2",label:"Оценка 2"})]}),e.jsx(j,{name:"comment",label:"Комментарий"}),e.jsx("div",{className:"flex items-center justify-end gap-2 -mt-1",children:e.jsx(g,{className:"!h-8 bg-transparent !text-success shadow-none hover:!bg-transparent",type:"submit",disabled:t,loading:t,variant:"success",children:"Сохранить"})})]})})}function I({studentName:i,position:r,dto:c,onClose:a,onSuccess:l}){const t=u.useRef(null);return u.useEffect(()=>{if(t.current){t.current.style.top=`${r.top}px`,t.current.style.left=`${r.left}px`;const s=t.current.getBoundingClientRect();s.right>window.innerWidth&&(t.current.style.transform=`translateX(-${s.right-window.innerWidth+32}px)`),s.bottom>window.innerHeight&&(t.current.style.top="auto",t.current.style.bottom="16px")}const n=s=>{t.current&&!t.current.contains(s.target)&&a()};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[a,r.left,r.top]),e.jsxs("div",{ref:t,className:"fixed flex z-30 min-w-52 max-w-52 flex-col py-1 bg-white rounded border shadow transform font-normal",children:[e.jsxs("div",{className:"flex justify-between items-center pl-2 pr-1",children:[e.jsx("h3",{className:"text-sm leading-none text-gray-400",children:i}),e.jsx("button",{className:"border rounded p-1 text-danger",type:"button",onClick:a,children:e.jsx(h.close,{width:10,height:10})})]}),e.jsx("hr",{className:"my-1"}),e.jsx(v,{dto:c,onSuccess:n=>{l(n),a()}})]})}export{I as default};
