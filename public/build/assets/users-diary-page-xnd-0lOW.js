import{u as M,a as j,r as m,M as v,D,O as A,j as s,S as z,p as r,c as u,e as F,k as L,B as P,N as U,A as E}from"./main-D1X-5qeh.js";import h from"./not-found-page-Dlt1yDD_.js";import{H as I,L as _}from"./lesson-hour-DTH_J5YM.js";import{I as b}from"./icons-Cwm3zsc5.js";import{g as C,c as Y}from"./index-Y5BpZlJY.js";import{g as R}from"./subjects-selector-H4IosHxK.js";import{g as k}from"./users-selector-Cpbhop2B.js";import{D as H}from"./diary-item-NXGveQed.js";import{f as W}from"./marks-api-actions-CIOOhDKh.js";import{L as G}from"./layout-BguUlnse.js";import{g as O}from"./grades-selector-CjDDihwd.js";import"./preload-helper-DPi8upcZ.js";import"./button-BxcCnYcJ.js";import"./users-DUqPc0QS.js";import"./nationalities-selector-BQnDI0q3.js";import"./description-list-D0pPZU8B.js";function T({grade:n,studentId:x}){const c=M(),e=j(R),a=j(k),[o,l]=m.useState(null),[p,f]=m.useState(null),[i,g]=m.useState(0),w=C(i),N=m.useRef(null);m.useEffect(()=>{!e.data&&!e.isFetching&&c(v()),!a.data&&!a.isFetching&&c(D()),o||c(A({week:i,gradeId:n.id,onSuccess:t=>l(t)})),o&&c(W({studentId:x,lessons:o.map(({id:t})=>t),onSuccess:t=>f(t)}))},[c,n.id,o,x,e.data,e.isFetching,a.data,a.isFetching,i]);const y=t=>{if(N.current){const{scrollLeft:d}=t.currentTarget;N.current.querySelectorAll(".sync-scroll").forEach(S=>{S.scrollLeft=d})}};return!o||!a.data?s.jsx(z,{className:"w-8 h-8"}):s.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)]",children:[s.jsxs("table",{ref:N,className:"flex flex-col w-full",children:[s.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:s.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[s.jsx(b.calendar,{className:"relative top-[1px]",height:16}),Y(r(w[0]).format("MMMM - YYYY")),r(w[0]).format("M")!==r(w[5]).format("M")&&` - ${Y(r(w[5]).format("MMMM"))}`]})}),s.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:y,children:s.jsxs("tr",{children:[s.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),s.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),s.jsx("th",{className:"min-w-20 w-20 max-w-20"}),s.jsx("th",{className:"p-2 min-w-[260px] w-[260px] max-w-[260px] text-start",children:"Предмет"}),s.jsx("th",{className:"p-2 min-w-[120px] w-[120px] max-w-[120px] text-start",children:"Посещаемость"}),s.jsx("th",{className:"p-2 min-w-20 w-20 max-w-20 text-center font-bold",children:"Оценка"}),s.jsx("th",{className:"p-2 min-w-[360px] w-[360px] max-w-[360px] text-start",children:"Комментарий"}),s.jsx("th",{className:"p-2 min-w-[288px] w-[288px] max-w-[288px] text-start",children:"Домашнее задание"}),s.jsx("th",{className:"p-2 min-w-[288px] w-[288px] max-w-[288px] text-start",children:"Тема урока"}),s.jsx("th",{className:"p-2 min-w-[320px] w-[320px] max-w-[320px] text-start",children:"Педагог"})]})}),s.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:y,children:w.map(t=>s.jsxs(m.Fragment,{children:[s.jsx("tr",{className:u("border-b",r(t).format("YYYY-MM-DD")===r().format("YYYY-MM-DD")&&"bg-green-50"),children:s.jsx("td",{className:u("min-w-7 w-7 max-w-7 sticky left-0 z-10",r(t).format("YYYY-MM-DD")===r().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),rowSpan:9,children:s.jsx("div",{className:"absolute left-1/2 top-1/2 flex gap-2 min-w-max text-blue-700 -translate-x-1/2 -translate-y-1/2 -rotate-90",children:Y(t.format("dddd - DD"))})})}),Object.keys(I).map(d=>s.jsxs("tr",{className:u("min-h-10 h-10 border-b",r(t).format("YYYY-MM-DD")===r().format("YYYY-MM-DD")&&"bg-green-50"),children:[s.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-7 z-10",children:s.jsx("div",{className:u("absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",r(t).format("YYYY-MM-DD")===r().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:d})}),s.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:s.jsx(_,{hour:+d})}),e.data&&a.data&&p&&s.jsx(H,{date:r(t).format(),hour:+d,lessons:o,subjects:e.data,marks:p,users:a.data})]},d))]},t.format("YYYY-MM-DD")))}),s.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:y,children:s.jsxs("tr",{children:[s.jsx("td",{className:"p-0 min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),s.jsx("td",{className:"p-0 min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),s.jsx("td",{className:"p-0 min-w-20 w-20 max-w-20"}),s.jsx("td",{className:"p-0 border-t min-w-[260px] w-[260px] max-w-[260px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[120px] w-[120px] max-w-[120px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-20 w-20 max-w-20 text-center font-bold"}),s.jsx("td",{className:"p-0 border-t min-w-[360px] w-[360px] max-w-[360px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[288px] w-[288px] max-w-[288px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[288px] w-[288px] max-w-[288px] text-start"}),s.jsx("td",{className:"p-0 border-t min-w-[320px] w-[320px] max-w-[320px] text-start"})]})})]}),s.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:s.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{g(t=>t-1),l(null)},children:[s.jsx(b.previous,{width:7}),s.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),i!==0&&s.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{g(0),l(null)},children:[s.jsx(b.currentWeek,{width:16,height:16}),s.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{g(t=>t+1),l(null)},children:[s.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),s.jsx(b.next,{width:7})]})]})})]})}function q(){var l,p;const n=M(),x=F(),c=j(k),e=((l=c.data)==null?void 0:l.find(f=>f.id===+(x.id||0)))||null,a=j(O),o=(p=a.data)==null?void 0:p.find(({id:f})=>{var i;return f===((i=e==null?void 0:e.student)==null?void 0:i.gradeId)});return m.useEffect(()=>{!e&&x.id&&!c.isFetching&&n(D()),!a.data&&!a.isFetching&&n(L())},[e,x.id,n,c.isFetching,a.data,a.isFetching]),s.jsx(G,{children:o&&e&&s.jsx(T,{grade:o,studentId:e==null?void 0:e.id})})}const B={superadmin:()=>s.jsx(h,{}),admin:()=>s.jsx(h,{}),director:()=>s.jsx(h,{}),teacher:()=>s.jsx(h,{}),parent:()=>s.jsx(q,{}),student:()=>s.jsx(h,{})};function is(){const n=j(P);return n?B[n.role]():s.jsx(U,{to:E.Auth.Login})}export{is as default};
