const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lessons-create-form-BoD8-NGn.js","assets/main-DOJC8ST-.js","assets/preload-helper-DPi8upcZ.js","assets/main-D-GEwkhe.css","assets/index.esm-Do6kmWbX.js","assets/button-BdkHwEk1.js","assets/icons-BUoiBP0X.js","assets/checkbox-Dl_Wu15E.js","assets/formik.esm-BjJf2Lh0.js","assets/select-field-m-r1v48W.js","assets/cleanable-rmotnKUR.js","assets/use-dropdown-BW2Nsp9S.js","assets/index.browser-OxPLOBIU.js","assets/users-selector-BjidioDu.js","assets/subjects-selector-Dfm9hxSf.js","assets/lessons-edit-form-9CC5rg9S.js","assets/lessons-delete-form-GckVuSiU.js"])))=>i.map(i=>d[i]);
import{_ as I}from"./preload-helper-DPi8upcZ.js";import{r as s,u as h,i as D,j as e,c as N,t as x,L,A as O,X as T,a as $,a6 as R,n as P,v as F,C as U,S as W}from"./main-DOJC8ST-.js";import{a as C,g as G}from"./grades-selector-DTsrrSJ9.js";import{a as H,g as V}from"./users-selector-BjidioDu.js";import{a as B,g as q}from"./subjects-selector-Dfm9hxSf.js";import{c as k,b as J}from"./index-onqUwJuH.js";import{I as v}from"./icons-BUoiBP0X.js";import{H as X,L as K}from"./lesson-hour-CWCHPqaI.js";import{B as E}from"./button-BdkHwEk1.js";import{b as Q}from"./lessons-selector-ySK9DS2N.js";import{M as Z}from"./modal-PVDpU2Tq.js";function ee({date:n,hour:u,grade:f,lesson:c,subject:i,teacher:r,setCreateDTO:p,setEditDTO:l,setDeleteDTO:d}){return h(Q)===D.Loading?e.jsxs("div",{className:"flex flex-col gap-1 items-center animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/5"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]}):c?e.jsxs("div",{className:"flex flex-col text-center leading-none group",children:[i&&e.jsx(L,{className:"duration-150 hover:text-blue-600 truncate",to:`${O.Journal}?gradeId=${c.gradeId}&subjectId=${c.subjectId}`,children:i.name}),r&&e.jsxs("div",{className:"flex justify-center text-sm items-baseline",children:["(",e.jsxs(L,{className:"duration-150 hover:text-blue-600 truncate",to:T(O.Users.Show,{id:c.teacherId}),children:[r.surname," ",r.name]}),")"]}),x().format("YYYY-MM-DD")<=x(n).format("YYYY-MM-DD")&&e.jsxs("div",{className:"absolute right-0 top-0 p-1 flex gap-1 invisible group-hover:visible",children:[e.jsx(E,{icon:"edit",variant:"warning",onClick:()=>l({id:c.id,subject_id:c.subjectId,teacher_id:c.teacherId}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(E,{icon:"delete",variant:"danger",onClick:()=>d({id:c.id}),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})]}):e.jsx("button",{className:N("absolute left-0 top-0 w-full h-full transition-all duration-150 hover:bg-blue-50",x().format("YYYY-MM-DD")>x(n).format("YYYY-MM-DD")&&"pointer-events-none"),type:"button",onClick:()=>p({date:x(n).format("YYYY-MM-DD"),hour:u,grade_id:f.id,subject_id:0}),children:e.jsx("span",{className:"sr-only",children:"Добавить урок"})})}const se=s.memo(ee);function te({date:n,isToday:u,lessons:f,setCreateDTO:c,setEditDTO:i,setDeleteDTO:r}){const p=h(C),l=h(B),d=h(H),w=s.useMemo(()=>{const t={};return f==null||f.forEach(a=>{const b=`${a.date}_${a.gradeId}_${a.hour}`;t[b]=a}),t},[f]),j=s.useMemo(()=>{const t={};return l==null||l.forEach(a=>{t[a.id]=a}),t},[l]),y=s.useMemo(()=>{const t={};return d==null||d.forEach(a=>{a.role==="teacher"&&(t[a.id]=a)}),t},[d]);return e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:N("border-b",u&&"bg-green-50"),children:e.jsx("td",{className:N("min-w-7 w-7 max-w-7 sticky left-0 z-10",u?"bg-green-50":"bg-white"),rowSpan:9,children:e.jsx("div",{className:"absolute left-1/2 top-1/2 flex gap-2 min-w-max text-blue-700 -translate-x-1/2 -translate-y-1/2 -rotate-90",children:k(n.format("dddd - DD"))})})}),Object.keys(X).map(t=>e.jsxs("tr",{className:N("min-h-[53px] h-[53px] max-h-[53px] border-b",u&&"bg-green-50"),children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-7 z-10",children:e.jsx("div",{className:N("absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",u?"bg-green-50":"bg-white"),children:t})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(K,{hour:+t})}),p==null?void 0:p.map(a=>{const b=`${n.format("YYYY-MM-DD")}_${a.id}_${t}`,m=w[b],M=m!=null&&m.subjectId?j[m.subjectId]:void 0,g=m!=null&&m.teacherId?y[m.teacherId]:void 0;return e.jsx("td",{className:"relative z-0 p-2 border-l min-w-[260px]",children:e.jsx(se,{date:n,hour:+t,grade:a,lesson:m,subject:M,teacher:g,setCreateDTO:c,setEditDTO:i,setDeleteDTO:r})},a.id)})]},t))]})}const ae=s.memo(te),re=s.lazy(()=>I(()=>import("./lessons-create-form-BoD8-NGn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),ne=s.lazy(()=>I(()=>import("./lessons-edit-form-9CC5rg9S.js"),__vite__mapDeps([15,1,2,3,5,6,7,8,9,10,11,12,14,13]))),oe=s.lazy(()=>I(()=>import("./lessons-delete-form-GckVuSiU.js"),__vite__mapDeps([16,1,2,3,5,6,7,8])));function je(){const n=$(),u=h(G),f=h(V),c=h(q),i=h(C),[r,p]=s.useState(0),l=s.useMemo(()=>J(r),[r]),[d,w]=s.useState(),[j,y]=s.useState(),[t,a]=s.useState(),b=s.useRef(null),m=s.useMemo(()=>x().format("YYYY-MM-DD"),[]),[M,g]=s.useState();s.useEffect(()=>{n(R({week:r,onSuccess:g}))},[n,r]),s.useEffect(()=>{u===D.Idle&&n(P()),f===D.Idle&&n(F()),c===D.Idle&&n(U())},[n,u,c,f]);const S=s.useCallback(o=>{const{scrollLeft:_}=o.currentTarget;b.current&&b.current.querySelectorAll(".sync-scroll").forEach(z=>{z.scrollLeft=_})},[]),Y=s.useCallback(o=>()=>{p(_=>o===0?0:_+o)},[]),A=s.useMemo(()=>d?e.jsx(re,{dto:d,week:r,setDTO:w,setLessons:g}):j?e.jsx(ne,{dto:j,week:r,setDTO:y,setLessons:g}):t?e.jsx(oe,{dto:t,week:r,setDTO:a,setLessons:g}):null,[d,j,t,r]);return e.jsxs("main",{className:"py-2",children:[e.jsx("h1",{className:"title mb-1 px-3",children:"Расписание занятий"}),e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)]",children:[e.jsxs("table",{ref:b,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(v.calendar,{className:"relative top-[1px]",height:16}),k(x(l[0]).format("MMMM")),x(l[0]).format("M")!==x(l[5]).format("M")&&` - ${k(x(l[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:S,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-7 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),i==null?void 0:i.map(o=>e.jsxs("th",{className:"p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",children:["Класс ",o.level," ",o.group]},o.id))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:S,children:l.map(o=>e.jsx(ae,{date:o,isToday:o.format("YYYY-MM-DD")===m,lessons:M,setCreateDTO:w,setEditDTO:y,setDeleteDTO:a},o.toString()))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:S,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),i==null?void 0:i.map(o=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},o.id))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:Y(-1),children:[e.jsx(v.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),r!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:Y(0),children:[e.jsx(v.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:Y(1),children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(v.next,{width:7})]})]})}),e.jsx(Z,{isOpen:!!(d||j||t),children:e.jsx(s.Suspense,{fallback:e.jsx(W,{className:"w-10 h-10"}),children:A})})]})]})}export{je as default};
