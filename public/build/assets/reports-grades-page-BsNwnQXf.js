import{r as d,a as S,u as m,i as g,v as $,n as G,Y as y,j as s,S as w,A as u,L as A,X as E}from"./main-DS_fTM3x.js";import{B as M}from"./breadcrumbs-DFdHew-6.js";import{B as _}from"./button-CnelchTr.js";import{D as R}from"./description-list-B7F4FRlZ.js";import{R as F}from"./users-DUqPc0QS.js";import{g as B,a as D}from"./grades-selector-BFbBCNeZ.js";import{g as U,a as L}from"./users-selector-CYBNvOPH.js";import{e as O}from"./reports-DMM9l4ql.js";import"./preload-helper-BfFHrpNk.js";import"./icons-8R8i3bGk.js";import"./FileSaver.min-BSDPwh7t.js";function V(){const[l,j]=d.useState(),c=S(),h=m(U),p=m(B),x=m(L),f=m(D),o=x?x.filter(a=>a.role==="student"):void 0;d.useEffect(()=>{h===g.Idle&&c($()),p===g.Idle&&c(G())},[c,p,h]),d.useEffect(()=>{!l&&o&&c(y({ids:o.map(({id:a})=>a),onSuccess:a=>j(a)}))},[c,l,o]);const r=d.useMemo(()=>{const a={};if(l&&f&&x)return l.forEach(t=>{!a[t.studentId]&&(t.score1||t.score2)&&(a[t.studentId]=[]),t.score1&&a[t.studentId].push(t.score1),t.score2&&a[t.studentId].push(t.score2)}),a},[f,l,x]),n=d.useMemo(()=>{if(r&&o){const a=o.map(e=>{const i=r[e.id]?r[e.id].reduce((I,v)=>I+v,0)/r[e.id].length:0,b=r[e.id]?Math.min(...r[e.id]):0;return{id:e.id,name:`${e.surname} ${e.name} ${e.patronymic||""}`,average:i,rounded:Math.round(i),score:b}}),t={excellent:a.filter(e=>[10,9].includes(e.score)),good:a.filter(e=>[8,7].includes(e.score)),average:a.filter(e=>[6,5,4].includes(e.score)),poor:a.filter(e=>[3,2,1].includes(e.score)),noGrades:a.filter(e=>[0].includes(e.score))};return{classInfo:{class:"Все классы",totalStudents:o.length,girls:o.filter(({sex:e})=>e==="female"),boys:o.filter(({sex:e})=>e==="male"),excellent:{count:t.excellent.length,percent:+(t.excellent.length*100/o.length).toFixed(2)},good:{count:t.good.length,percent:+(t.good.length*100/o.length).toFixed(2)},average:{count:t.average.length,percent:+(t.average.length*100/o.length).toFixed(2)},poor:{count:t.poor.length,percent:+(t.poor.length*100/o.length).toFixed(2)},noGrades:{count:t.noGrades.length,percent:+(t.noGrades.length*100/o.length).toFixed(2)}},students:t}}},[r,o]),N={excellent:"Отличники",good:"Четвёрочники",average:"Троечники",poor:"Двоечники",noGrades:"Без оценок"};return n?s.jsxs("main",{className:"pt-2 pb-40 flex flex-col",children:[s.jsxs("h1",{className:"title",children:["Класс ",n.classInfo.class]}),s.jsx(M,{items:[["Отчеты",u.Reports.Index],[`${n.classInfo.class}`,""]]}),s.jsx(_,{className:"max-h-7 ml-auto mb-2",icon:"fileExport",variant:"light",onClick:()=>O(n),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),s.jsxs("section",{className:"box",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:"Общая информация"})}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"box__body",list:{"Количество учеников":s.jsxs("div",{className:"flex justify-between gap-8",children:[n.classInfo.totalStudents," (девочек ",n.classInfo.girls.length," / мальчиков ",n.classInfo.boys.length,")",s.jsx("div",{className:"flex flex-col",children:F.map(a=>s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:a})," (девочек ",n.classInfo.girls.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===a}).length," / мальчиков ",n.classInfo.boys.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===a}).length,")"]}))})]}),Отличники:`${n.classInfo.excellent.count} (${n.classInfo.excellent.percent}%)`,Четвёрочники:`${n.classInfo.good.count} (${n.classInfo.good.percent}%)`,Троечники:`${n.classInfo.average.count} (${n.classInfo.average.percent}%)`,Двоечники:`${n.classInfo.poor.count} (${n.classInfo.poor.percent}%)`,"Без оценок":`${n.classInfo.noGrades.count} (${n.classInfo.noGrades.percent}%)`}}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]}),Object.entries(N).map(([a,t])=>s.jsxs("section",{className:"box mt-4",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:t})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"box__body",children:n.students[a].length?s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[320px]",children:"ФИО"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[140px]",children:"Средний балл"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[160px]",children:"Округлённая оценка"})]})}),s.jsx("tbody",{children:n.students[a].map(e=>{var i;return s.jsxs("tr",{className:"py-1",children:[s.jsx("td",{className:"pr-10",children:s.jsx(A,{className:"text-blue-600",to:E(u.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:(i=e.average)==null?void 0:i.toFixed(2)}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:e.rounded})]},e.id)})})]}):"Нет учеников"}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]},a))]}):s.jsx(w,{className:"w-8 h-8 m-2"})}export{V as default};
