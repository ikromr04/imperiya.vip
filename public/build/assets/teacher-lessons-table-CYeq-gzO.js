import{p as a,j as e,L as N,A as y,u as Y,a as b,B as M,r as h,M as v,k as D,O as k,S,c as g}from"./main-D1X-5qeh.js";import{I as p}from"./icons-Cwm3zsc5.js";import{g as I,c as j}from"./index-Y5BpZlJY.js";import{H as L,L as A}from"./lesson-hour-DTH_J5YM.js";import{g as z}from"./grades-selector-CjDDihwd.js";import{g as T}from"./subjects-selector-H4IosHxK.js";function _({date:o,hour:c,subjects:i,lessons:d,grades:m}){var x;const n=d.find(t=>a(t.date).format("YYYY-MM-DD")===a(o).format("YYYY-MM-DD")&&+t.hour==+c);if(!n)return;const r=m.find(({id:t})=>t===n.gradeId);return e.jsxs("div",{className:"flex flex-col text-center leading-none group",children:[r&&e.jsx("div",{className:"flex justify-center text-sm items-baseline",children:e.jsxs(N,{className:"duration-150 hover:text-blue-600 truncate text-lg leading-none font-bold",to:`${y.Journal}?gradeId=${n.gradeId}&subjectId=${n.subjectId}`,children:[r.level," ",r.group]})}),e.jsxs("span",{className:"truncate text-sm leading-none",children:["(",(x=i.find(({id:t})=>t===n.subjectId))==null?void 0:x.name,")"]})]})}function W(){const o=Y(),c=b(M),[i,d]=h.useState(null),[m,n]=h.useState(0),r=I(m),x=h.useRef(null),t=b(T),l=b(z);h.useEffect(()=>{!t.data&&!t.isFetching&&o(v()),!l.data&&!l.isFetching&&o(D()),!i&&c&&o(k({week:m,teacherId:c.id,onSuccess:s=>d(s)}))},[c,o,l.data,l.isFetching,i,t.data,t.isFetching,m]);const u=s=>{if(x.current){const{scrollLeft:f}=s.currentTarget;x.current.querySelectorAll(".sync-scroll").forEach(w=>{w.scrollLeft=f})}};return!i||!t.data||!c||!l.data?e.jsx(S,{className:"w-8 h-8"}):e.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)] max-w-full",children:[e.jsxs("table",{ref:x,className:"flex flex-col w-full",children:[e.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:e.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[e.jsx(p.calendar,{className:"relative top-[1px]",height:16}),j(a(r[0]).format("MMMM")),a(r[0]).format("M")!==a(r[5]).format("M")&&` - ${j(a(r[5]).format("MMMM"))}`]})}),e.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:u,children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),e.jsx("th",{className:"min-w-20 w-20 max-w-20"}),r.map(s=>e.jsx("th",{className:g("p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",a(s).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")&&"bg-green-50"),children:j(s.format("dddd - DD"))},a(s).format()))]})}),e.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:u,children:Object.keys(L).map(s=>e.jsxs("tr",{className:"min-h-[53px] h-[53px] max-h-[53px] border-b",children:[e.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-0 z-10 bg-white",children:e.jsx("div",{className:"absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",children:s})}),e.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:e.jsx(A,{hour:+s})}),r.map(f=>e.jsx("td",{className:g("relative z-0 p-2 border-l min-w-[260px] w-[260px] max-w-[260px]",a(f).format("YYYY-MM-DD")===a().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:t.data&&l.data&&e.jsx(_,{date:f,hour:Number(s),subjects:t.data,lessons:i,grades:l.data})},a(f).format()))]},s))}),e.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:u,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),e.jsx("th",{className:"p-0 border-b min-w-[91px]"}),r.map(s=>e.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},a(s).format()))]})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:e.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{n(s=>s-1),d(null)},children:[e.jsx(p.previous,{width:7}),e.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),m!==0&&e.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{n(0),d(null)},children:[e.jsx(p.currentWeek,{width:16,height:16}),e.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),e.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{n(s=>s+1),d(null)},children:[e.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),e.jsx(p.next,{width:7})]})]})})]})}export{W as T};
