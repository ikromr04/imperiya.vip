import{f as G,r as m,a as y,u as h,i as g,v as w,n as A,Y as E,j as s,S as M,A as j,L as _,X as R}from"./main-yWuhb5Gt.js";import{B as F}from"./breadcrumbs-DA-Ti6wZ.js";import{B}from"./button-BKPH64SX.js";import{D}from"./description-list-MiWBkjCF.js";import{R as U}from"./users-DUqPc0QS.js";import{g as L,a as O}from"./grades-selector-B6pCE8aG.js";import{g as P,a as z}from"./users-selector-D5J-7fb-.js";import{e as C}from"./reports-RKa9g-T7.js";import"./preload-helper-BfFHrpNk.js";import"./icons-CK1IQmfH.js";import"./FileSaver.min-P9aWVRN6.js";function k(){const N=G(),[c,I]=m.useState(),i=y(),f=h(P),u=h(L),p=h(z),d=h(O),r=(d==null?void 0:d.find(n=>n.id===+(N.id||0)))||null,o=r&&p?p.filter(n=>{var t;return n.role==="student"&&((t=n.student)==null?void 0:t.gradeId)===(r==null?void 0:r.id)}):void 0;m.useEffect(()=>{f===g.Idle&&i(w()),u===g.Idle&&i(A())},[i,u,f]),m.useEffect(()=>{!c&&o&&i(E({ids:o.map(({id:n})=>n),onSuccess:n=>I(n)}))},[i,c,o]);const l=m.useMemo(()=>{const n={};if(c&&d&&p)return c.forEach(t=>{!n[t.studentId]&&(t.score1||t.score2)&&(n[t.studentId]=[]),t.score1&&n[t.studentId].push(t.score1),t.score2&&n[t.studentId].push(t.score2)}),n},[d,c,p]),a=m.useMemo(()=>{if(l&&r&&o){const n=o.map(e=>{const x=l[e.id]?l[e.id].reduce((S,$)=>S+$,0)/l[e.id].length:0,v=l[e.id]?Math.min(...l[e.id]):0;return{id:e.id,name:`${e.surname} ${e.name} ${e.patronymic||""}`,average:x,rounded:Math.round(x),score:v}}),t={excellent:n.filter(e=>[10,9].includes(e.score)),good:n.filter(e=>[8,7].includes(e.score)),average:n.filter(e=>[6,5,4].includes(e.score)),poor:n.filter(e=>[3,2,1].includes(e.score)),noGrades:n.filter(e=>[0].includes(e.score))};return{classInfo:{class:`${r.level}${r.group}`,totalStudents:o.length,girls:o.filter(({sex:e})=>e==="female"),boys:o.filter(({sex:e})=>e==="male"),excellent:{count:t.excellent.length,percent:+(t.excellent.length*100/o.length).toFixed(2)},good:{count:t.good.length,percent:+(t.good.length*100/o.length).toFixed(2)},average:{count:t.average.length,percent:+(t.average.length*100/o.length).toFixed(2)},poor:{count:t.poor.length,percent:+(t.poor.length*100/o.length).toFixed(2)},noGrades:{count:t.noGrades.length,percent:+(t.noGrades.length*100/o.length).toFixed(2)}},students:t}}},[r,l,o]),b={excellent:"Отличники",good:"Четвёрочники",average:"Троечники",poor:"Двоечники",noGrades:"Без оценок"};return a?s.jsxs("main",{className:"pt-2 pb-40 flex flex-col",children:[s.jsxs("h1",{className:"title",children:["Класс ",a.classInfo.class]}),s.jsx(F,{items:[["Отчеты",j.Reports.Index],[`${a.classInfo.class}`,""]]}),s.jsx(B,{className:"max-h-7 ml-auto mb-2",icon:"fileExport",variant:"light",onClick:()=>C(a),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),s.jsxs("section",{className:"box",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:"Общая информация"})}),s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"box__body",list:{"Количество учеников":s.jsxs("div",{className:"flex justify-between gap-8",children:[a.classInfo.totalStudents," (девочек ",a.classInfo.girls.length," / мальчиков ",a.classInfo.boys.length,")",s.jsx("div",{className:"flex flex-col",children:U.map(n=>s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:n})," (девочек ",a.classInfo.girls.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===n}).length," / мальчиков ",a.classInfo.boys.filter(t=>{var e;return((e=t.address)==null?void 0:e.region)===n}).length,")"]}))})]}),Отличники:`${a.classInfo.excellent.count} (${a.classInfo.excellent.percent}%)`,Четвёрочники:`${a.classInfo.good.count} (${a.classInfo.good.percent}%)`,Троечники:`${a.classInfo.average.count} (${a.classInfo.average.percent}%)`,Двоечники:`${a.classInfo.poor.count} (${a.classInfo.poor.percent}%)`,"Без оценок":`${a.classInfo.noGrades.count} (${a.classInfo.noGrades.percent}%)`}}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]}),Object.entries(b).map(([n,t])=>s.jsxs("section",{className:"box mt-4",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:t})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"box__body",children:a.students[n].length?s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[320px]",children:"ФИО"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[140px]",children:"Средний балл"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[160px]",children:"Округлённая оценка"})]})}),s.jsx("tbody",{children:a.students[n].map(e=>{var x;return s.jsxs("tr",{className:"py-1",children:[s.jsx("td",{className:"pr-10",children:s.jsx(_,{className:"text-blue-600",to:R(j.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:(x=e.average)==null?void 0:x.toFixed(2)}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:e.rounded})]},e.id)})})]}):"Нет учеников"}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]},n))]}):s.jsx(M,{className:"w-8 h-8 m-2"})}export{k as default};
