import{a as u,j as e,D as v,y as m,E as D,F,u as j,g as E,r as d,i as w,k as T,S as k}from"./main-C3zapZtd.js";import{D as A}from"./data-table-C_fhXAN-.js";import{B as o}from"./button-k6U4pBlW.js";import{M as C}from"./modal-Dx9j0xvg.js";import{g as O,a as V}from"./nationalities-selector-B_j6XA9U.js";import{T as g}from"./text-field-DVRwjedT.js";import{F as h,a as f}from"./formik.esm-ShEui-VR.js";import{c as b,a as S}from"./index.esm-CBOWuRvE.js";import"./preload-helper-BfFHrpNk.js";import"./icons-CmdP5zNp.js";import"./use-dropdown-idH_Ahq5.js";import"./index-dlLad1ED.js";import"./cleanable-xJmsbn0p.js";import"./index.browser-OxPLOBIU.js";const q=b().shape({name:S().required("Обязательное поле.")});function z({dto:r,setDTO:i}){const a=u(),t={name:r.name},n=async(s,c)=>{c.setSubmitting(!0),await a(v({name:s.name,onSuccess:()=>{m.success("Национальность успешно добавлена."),i(null)},onValidationError:l=>c.setErrors({...l.errors}),onFail:l=>m.success(l)})),c.setSubmitting(!1)};return e.jsx(h,{initialValues:t,validationSchema:q,onSubmit:n,children:({isSubmitting:s})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление национальности"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>i(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(g,{className:"mb-4",name:"name",label:"Национальность",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Добавить"})})]})})}const K=b().shape({name:S().required("Обязательное поле.")});function $({dto:r,setDTO:i}){const a=u(),t={id:r.id,name:r.name},n=async(s,c)=>{c.setSubmitting(!0),await a(D({dto:s,onSuccess:()=>{m.success("Национальность успешно обновлена."),i(null)},onValidationError:l=>c.setErrors({...l.errors}),onFail:l=>m.success(l)})),c.setSubmitting(!1)};return e.jsx(h,{initialValues:t,validationSchema:K,onSubmit:n,children:({isSubmitting:s})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>i(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(g,{className:"mb-4",name:"name",label:"Национальность",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Сохранить"})})]})})}function B({dto:r,setDTO:i}){const a=u(),t=async(n,s)=>{s.setSubmitting(!0),await a(F({id:r,onSuccess:()=>{m.success("Национальность успешно удалена."),i(null)}})),s.setSubmitting(!1)};return e.jsx(h,{initialValues:{},onSubmit:t,children:({isSubmitting:n})=>e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удалить национальность"}),e.jsx(o,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>i(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(o,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:n,loading:n,variant:"success",children:"Удалить"})})]})})}function U(){const r=u(),i=j(O),a=j(E),t=j(V),[n,s]=d.useState(null),[c,l]=d.useState(null),[x,N]=d.useState(null);d.useEffect(()=>{i===w.Idle&&r(T())},[r,i]);let y=[{id:"name",accessorKey:"name",header:"Название",size:1686}];return(a==null?void 0:a.role)==="superadmin"&&(y=[{id:"name",accessorKey:"name",header:"Название",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:p})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{icon:"edit",variant:"warning",onClick:()=>l({id:p.original.id,name:p.original.name}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(o,{icon:"delete",variant:"danger",onClick:()=>N(p.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})}]),e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"py-2",children:[e.jsxs("h1",{className:"title mb-1 px-3",children:["Национальности (",t==null?void 0:t.length,")"]}),t?e.jsx(A,{data:t,columns:y,sortingState:[{id:"name",desc:!1}],columnPinningState:{right:["actions"]},actions:(a==null?void 0:a.role)==="superadmin"&&e.jsx(o,{icon:"add",variant:"success",onClick:()=>s({name:""}),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(k,{className:"w-8 h-8"})]}),e.jsxs(C,{isOpen:!!(n||c||x),children:[n&&e.jsx(z,{dto:n,setDTO:s}),c&&e.jsx($,{dto:c,setDTO:l}),x&&e.jsx(B,{dto:x,setDTO:N})]})]})}export{U as default};
