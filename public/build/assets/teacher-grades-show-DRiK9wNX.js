import{f as b,a as y,u as j,r as m,i as v,n as w,j as e,S,c as A,L as I,X as _,A as E}from"./main-DS_fTM3x.js";import{f as $,S as G}from"./leadership-bz8zXMsO.js";import{g as z,a as B}from"./grades-selector-BFbBCNeZ.js";import"./preload-helper-BfFHrpNk.js";function R(){const g=b(),o=y(),u=j(z),[c,N]=m.useState(),f=j(B),a=(f==null?void 0:f.find(({id:t})=>t===+(g.id||0)))||null;m.useEffect(()=>{u===v.Idle&&o(w())},[o,u]),m.useEffect(()=>{c||o($({gradeId:a==null?void 0:a.id,onSuccess:t=>N(t)}))},[c,o,a==null?void 0:a.id]);const p=m.useMemo(()=>{if(c){const t={};return c.marks.forEach(s=>{t[s.studentId]||(t[s.studentId]=[]),s.score1&&t[s.studentId].push(s.score1),s.score2&&t[s.studentId].push(s.score2)}),c.users.map(s=>{var i,n;const r=c.grades.find(({id:l})=>{var h;return l===(((h=s.student)==null?void 0:h.gradeId)||0)}),d=(i=t[s.id])==null?void 0:i.reduce((l,h)=>l+=G[h],0);return{id:s.id,avatar:s.avatarThumb,gradeId:((n=s.student)==null?void 0:n.gradeId)||"",name:`${s.surname} ${s.name} ${s.patronymic??""}`,grade:r?`${r==null?void 0:r.level} "${r==null?void 0:r.group}"`:"",score:d}}).sort((s,r)=>{const d=s.score,i=r.score,n=d==null,l=i==null;return n&&!l?1:!n&&l?-1:n&&l?0:i-d})}},[c]);return!a||!f||!c||!p?e.jsx(S,{className:"w-8 h-8"}):e.jsxs("main",{className:"py-2 flex flex-col gap-2 pb-40",children:[e.jsxs("h1",{className:"title px-3",children:["Класс ",a.level," ",a.group]}),e.jsxs("table",{className:"flex flex-col bg-white shadow rounded border",children:[e.jsx("thead",{className:"sticky top-0 z-10 flex bg-[#efefef] font-medium shadow py-1 rounded-t",children:e.jsxs("tr",{className:"grid grid-cols-[40px_1fr_8fr_2fr_2fr] w-full",children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Фото"}),e.jsx("th",{className:"text-start",children:"ФИО"}),e.jsx("th",{children:"Класс"}),e.jsx("th",{children:"Ранг"})]})}),e.jsx("tbody",{className:"relative z-0",children:p.map((t,x)=>e.jsxs("tr",{className:A("grid grid-cols-[40px_1fr_8fr_2fr_2fr] w-full py-1",x%2&&"bg-gray-50"),children:[e.jsxs("td",{className:"flex items-center justify-center",children:[x+1,"."]}),e.jsx("td",{className:"flex items-center justify-center",children:e.jsx("div",{className:"relative z-10 w-12 lg:mb-0",children:e.jsx("div",{children:e.jsx("img",{className:"block w-full h-full rounded-full object-cover border-[2px] border-white",src:t.avatar||"/images/avatar.png",width:144,height:144,alt:t.name})})})}),e.jsx("td",{className:"flex items-center text-lg",children:e.jsx(I,{className:"text-blue-600",to:_(E.Users.Show,{id:t.id}),children:t.name})}),e.jsx("td",{className:"flex items-center justify-center text-lg font-medium",children:t.grade}),e.jsx("td",{className:"flex items-center justify-center text-xl font-semibold text-blue-700",children:t.score})]},t.id))})]})]})}export{R as default};
