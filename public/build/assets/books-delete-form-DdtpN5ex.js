import{a as y,u as S,r as k,j as e,ap as B,y as b,aq as F,ar as E}from"./main-C3zapZtd.js";import{B as m}from"./button-k6U4pBlW.js";import{C as w}from"./content-field-2RzNRsd5.js";import{S as c}from"./select-field-BtHvfVcq.js";import{T as g}from"./text-field-DVRwjedT.js";import{a as q}from"./books-Bhzd4aEF.js";import{a as C}from"./books-selector-BCbTauf5.js";import{F as N,a as v}from"./formik.esm-ShEui-VR.js";import{c as _,a as o,e as h}from"./index.esm-CBOWuRvE.js";const A=_().shape({category_id:h().required("Обязательное поле.").min(1,"Обязательное поле."),title:o().required("Обязательное поле."),access:o().required("Обязательное поле."),lang:o().required("Обязательное поле.")});function K({dto:d,setDTO:r}){const p=y(),u=d,t=S(C),n=k.useRef(null),j=async(s,i)=>{var x,f;i.setSubmitting(!0);const a=new FormData;a.append("category_id",String(s.category_id)),a.append("title",s.title),a.append("access",s.access),a.append("lang",s.lang),(f=(x=n.current)==null?void 0:x.files)!=null&&f[0]&&a.append("file",n.current.files[0]),s.link&&a.append("link",s.link),s.description&&a.append("description",s.description),await p(B({formData:a,onSuccess:()=>{b.success("Книга успешно добавлена."),r(null)},onValidationError:l=>i.setErrors({...l.errors}),onFail:l=>b.success(l)})),i.setSubmitting(!1)};return e.jsx(N,{initialValues:u,validationSchema:A,onSubmit:j,children:({isSubmitting:s,setFieldValue:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление книги"}),e.jsx(m,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>r(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(g,{className:"mb-4",name:"title",label:"Название",required:!0}),t&&e.jsx(c,{className:"mb-4",name:"category_id",label:"Укажите категорию",onChange:a=>i("category_id",a.value),options:t.map(a=>({value:a.id,label:a.title})),required:!0}),e.jsx(c,{className:"mb-4",name:"access",label:"Выберите доступность",onChange:a=>i("access",a.value),options:q,required:!0}),e.jsx(c,{className:"mb-4",name:"lang",label:"Укажите язык",onChange:a=>i("lang",a.value),options:["Русский","Таджикский","Английский","Немецкий"].map(a=>({value:a,label:a})),required:!0}),e.jsx(w,{className:"mb-4",name:"description",label:"Описание"}),e.jsx(g,{className:"mb-4",inputClassname:"!p-1 dassfas",name:"link",label:"Ссылка"}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"relative z-0 rounded flex leading-none mb-[2px] max-w-max text-sm text-gray-500 ml-2",children:"Загрузить книгу"}),e.jsx("div",{className:"relative flex",children:e.jsx("input",{ref:n,className:"flex grow bg-gray-50 min-w-0 border border-gray-200 rounded h-8 leading-none text-base focus:outline-none hover:bg-gray-100 focus:border-primary focus:bg-gray-100 p-1",type:"file",name:"file",accept:".pdf"})})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(m,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Добавить"})})]})})}const R=_().shape({id:h().min(1,"Обязательное поле."),category_id:h().min(1,"Обязательное поле."),title:o().required("Обязательное поле."),access:o().required("Обязательное поле."),lang:o().required("Обязательное поле.")});function L({dto:d,setDTO:r}){const p=y(),u=d,t=S(C),n=k.useRef(null),j=async(s,i)=>{var x,f;i.setSubmitting(!0);const a=new FormData;a.append("category_id",String(s.category_id)),a.append("title",s.title),a.append("access",s.access),a.append("lang",s.lang),(f=(x=n.current)==null?void 0:x.files)!=null&&f[0]&&a.append("file",n.current.files[0]),s.link&&a.append("link",s.link),s.description&&a.append("description",s.description),await p(F({id:s.id,formData:a,onSuccess:()=>{b.success("Книга успешно обновлена."),r(null)},onValidationError:l=>i.setErrors({...l.errors}),onFail:l=>b.success(l)})),i.setSubmitting(!1)};return e.jsx(N,{initialValues:u,validationSchema:R,onSubmit:j,children:({isSubmitting:s,setFieldValue:i})=>e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование книги"}),e.jsx(m,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>r(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(g,{className:"mb-4",name:"title",label:"Название",required:!0}),t&&e.jsx(c,{className:"mb-4",name:"category_id",label:"Укажите категорию",onChange:a=>i("category_id",a.value),options:t.map(a=>({value:a.id,label:a.title})),required:!0}),e.jsx(c,{className:"mb-4",name:"access",label:"Выберите доступность",onChange:a=>i("access",a.value),options:q,required:!0}),e.jsx(c,{className:"mb-4",name:"lang",label:"Укажите язык",onChange:a=>i("lang",a.value),options:["Русский","Таджикский","Английский","Немецкий"].map(a=>({value:a,label:a})),required:!0}),e.jsx(w,{className:"mb-4",name:"description",label:"Описание"}),e.jsx(g,{className:"mb-4",name:"link",label:"Ссылка"}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"relative z-0 rounded flex leading-none mb-[2px] max-w-max text-sm text-gray-500 ml-2",children:"Загрузить книгу"}),e.jsx("div",{className:"relative flex",children:e.jsx("input",{ref:n,className:"flex grow bg-gray-50 min-w-0 border border-gray-200 rounded h-8 leading-none text-base focus:outline-none hover:bg-gray-100 focus:border-primary focus:bg-gray-100 p-1",type:"file",name:"file",accept:".pdf"})})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(m,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:s,loading:s,variant:"success",children:"Сохранить"})})]})})}function M({dto:d,setDTO:r}){const p=y(),u=async(t,n)=>{n.setSubmitting(!0),await p(E({id:d,onSuccess:()=>{b.success("Книга успешно удалена."),r(null)}})),n.setSubmitting(!1)};return e.jsx(N,{initialValues:{},onSubmit:u,children:({isSubmitting:t})=>e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удалить книгу"}),e.jsx(m,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>r(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(m,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:t,loading:t,variant:"success",children:"Удалить"})})]})})}export{K as B,L as a,M as b};
