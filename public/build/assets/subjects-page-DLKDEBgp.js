import{u,j as e,U as S,y as d,V as N,W as v,a as D,r as m,M as F,z as w,S as E}from"./main-D1X-5qeh.js";import{g as T}from"./subjects-selector-H4IosHxK.js";import{D as C}from"./data-table-Nl3BCqN7.js";import{B as r}from"./button-BxcCnYcJ.js";import{M as k}from"./modal-COah0HVy.js";import{T as f}from"./text-field-D3e8nZd6.js";import{F as x,a as p}from"./formik.esm-CEA5_Xoc.js";import{c as b,a as g}from"./index.esm-tVQjNZt4.js";import"./preload-helper-DPi8upcZ.js";import"./icons-Cwm3zsc5.js";import"./use-dropdown-BjzLPdm1.js";import"./cleanable-BYiEZa8s.js";import"./index.browser-OxPLOBIU.js";const A=b().shape({name:g().required("Обязательное поле.")});function O({dto:c,setDTO:s}){const l=u(),o={name:c.name},t=async(a,n)=>{n.setSubmitting(!0),await l(S({name:a.name,onSuccess:()=>{d.success("Предмет успешно добавлен."),s(null)},onValidationError:i=>n.setErrors({...i.errors}),onFail:i=>d.success(i)})),n.setSubmitting(!1)};return e.jsx(x,{initialValues:o,validationSchema:A,onSubmit:t,children:({isSubmitting:a})=>e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Добавление предмета"}),e.jsx(r,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>s(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(f,{className:"mb-4",name:"name",label:"Название предмета",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(r,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:a,loading:a,variant:"success",children:"Добавить"})})]})})}const V=b().shape({name:g().required("Обязательное поле.")});function q({dto:c,setDTO:s}){const l=u(),o={id:c.id,name:c.name},t=async(a,n)=>{n.setSubmitting(!0),await l(N({dto:a,onSuccess:()=>{d.success("Предмет успешно обновлен."),s(null)},onValidationError:i=>n.setErrors({...i.errors}),onFail:i=>d.success(i)})),n.setSubmitting(!1)};return e.jsx(x,{initialValues:o,validationSchema:V,onSubmit:t,children:({isSubmitting:a})=>e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Редактирование предмета"}),e.jsx(r,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>s(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx(f,{className:"mb-4",name:"name",label:"Название предмета",required:!0}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(r,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:a,loading:a,variant:"success",children:"Сохранить"})})]})})}function z({dto:c,setDTO:s}){const l=u(),o=async(t,a)=>{a.setSubmitting(!0),await l(v({id:c,onSuccess:()=>{d.success("Предмет успешно удален."),s(null)}})),a.setSubmitting(!1)};return e.jsx(x,{initialValues:{},onSubmit:o,children:({isSubmitting:t})=>e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"title",children:"Удаление предмета"}),e.jsx(r,{className:"ml-auto",type:"reset",variant:"danger",icon:"close",onClick:()=>s(null),children:e.jsx("span",{className:"sr-only",children:"Отмена"})})]}),e.jsx("p",{children:"Вы уверены что хотите удалить этот предмет?"}),e.jsx("div",{className:"flex items-center justify-end gap-2 sm:col-span-2",children:e.jsx(r,{className:"justify-center min-w-[92px]",type:"submit",icon:"edit",disabled:t,loading:t,variant:"success",children:"Удалить"})})]})})}function Q(){var h;const c=u(),s=D(T),[l,o]=m.useState(null),[t,a]=m.useState(null),[n,i]=m.useState(null);m.useEffect(()=>{!s.data&&!s.isFetching&&c(F())},[c,s.data,s.isFetching]);const y=[{id:"name",accessorKey:"name",header:"Название",size:1686},{id:"actions",accessorKey:"actions",header:"Действия",enableSorting:!1,size:120,cell:({row:j})=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(r,{icon:"edit",variant:"warning",onClick:()=>a({id:j.original.id,name:j.original.name}),children:e.jsx("span",{className:"sr-only",children:"Редактировать"})}),e.jsx(r,{icon:"delete",variant:"danger",onClick:()=>i(j.original.id),children:e.jsx("span",{className:"sr-only",children:"Удалить"})})]})}];return e.jsxs(w,{children:[e.jsxs("main",{className:"py-2",children:[e.jsxs("h1",{className:"title mb-1 px-3",children:["Предметы (",(h=s.data)==null?void 0:h.length,")"]}),s.data?e.jsx(C,{data:s.data,columns:y,sortingState:[{id:"name",desc:!1}],columnPinningState:{right:["actions"]},actions:e.jsx(r,{icon:"add",variant:"success",onClick:()=>o({name:""}),children:e.jsx("span",{className:"sr-only md:not-sr-only",children:"Добавить"})})}):e.jsx(E,{className:"w-8 h-8"})]}),e.jsxs(k,{isOpen:!!(l||t||n),children:[l&&e.jsx(O,{dto:l,setDTO:o}),t&&e.jsx(q,{dto:t,setDTO:a}),n&&e.jsx(z,{dto:n,setDTO:i})]})]})}export{Q as default};
