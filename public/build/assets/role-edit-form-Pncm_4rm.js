import{a as I,u as d,j as a,al as N,y as C}from"./main-XRo2qOUM.js";import{B as F}from"./button-Y4UR9_BE.js";import{F as R,a as A}from"./formik.esm-Be66R8Pj.js";import{a as B}from"./grades-selector-BPd7_f6O.js";import{S as o}from"./select-field-DvwDrwa-.js";import{C as m}from"./content-field-tIYjuVXj.js";import{a as D}from"./users-selector-BbhGeZy6.js";import{T as c}from"./text-field-DZyLsNjz.js";import{a as T}from"./professions-selector-CFvWVWsI.js";import"./preload-helper-DPi8upcZ.js";import"./icons-B9HDjQFM.js";import"./cleanable-vEQcTMeq.js";import"./use-dropdown-BNrZcIiO.js";import"./index.browser-OxPLOBIU.js";function Z({user:t,setIsOpen:p}){var h,f,x,b,j,_,g,v,$,k,w,y;const S=I(),i=d(B),r=d(D),u=d(T),q={grades:i==null?void 0:i.filter(n=>n.teacherId===t.id).map(({id:n})=>n),education:(h=t.teacher)==null?void 0:h.education,achievements:(f=t.teacher)==null?void 0:f.achievements,work_experience:(x=t.teacher)==null?void 0:x.workExperience,children:r==null?void 0:r.filter(({id:n})=>{var l,e;return(e=(l=t.parent)==null?void 0:l.children)==null?void 0:e.includes(n)}).map(({id:n})=>n),profession_id:(b=t.parent)==null?void 0:b.professionId,workplace:(j=t.parent)==null?void 0:j.workplace,position:(_=t.parent)==null?void 0:_.position,grade_id:(g=t.student)==null?void 0:g.gradeId,mother_id:(v=t.student)==null?void 0:v.motherId,father_id:($=t.student)==null?void 0:$.fatherId,admission_date:(k=t.student)==null?void 0:k.admissionDate,previous_schools:(w=t.student)==null?void 0:w.previousSchools,medical_recommendations:(y=t.student)==null?void 0:y.medicalRecommendations},E=async(n,l)=>{l.setSubmitting(!0),await S(N({id:t.id,dto:n,onSuccess:()=>{C.success("Данные успешно сохранены."),p(!1)},onValidationError:e=>l.setErrors({...e.errors}),onFail:e=>C.error(e)})),l.setSubmitting(!1)};return a.jsx(R,{initialValues:q,onSubmit:E,children:({isSubmitting:n,setFieldValue:l})=>a.jsxs(A,{className:"flex flex-col gap-3",children:[t.role==="teacher"&&a.jsxs(a.Fragment,{children:[i&&a.jsx(o,{name:"grades",label:"Руководитель класса",multiple:!0,cleanable:!0,onClean:()=>l("grades",[]),options:i.map(e=>({value:e.id,label:`${e.level} ${e.group}`}))}),a.jsx(m,{name:"education",label:"Образование"}),a.jsx(m,{name:"achievements",label:"Достижения"}),a.jsx(m,{name:"work_experience",label:"Опыт работы"})]}),t.role==="parent"&&a.jsxs(a.Fragment,{children:[r&&a.jsx(o,{name:"children",label:"Дети",multiple:!0,cleanable:!0,searchable:!0,onClean:()=>l("children",[]),options:r.filter(({role:e})=>e==="student").map(e=>({value:e.id,label:`${e.surname} ${e.name}`}))}),u&&a.jsx(o,{name:"profession_id",label:"Сфера деятельности",searchable:!0,options:u.map(({id:e,name:s})=>({value:e,label:s})),required:!0}),a.jsx(c,{name:"workplace",label:"Место работы",required:!0}),a.jsx(c,{name:"position",label:"Должность",required:!0})]}),t.role==="student"&&a.jsxs(a.Fragment,{children:[i&&a.jsx(o,{name:"grade_id",label:"Класс",cleanable:!0,onClean:()=>l("grade_id",null),options:i.map(e=>({value:e.id,label:`${e.level} ${e.group}`}))}),r&&a.jsxs(a.Fragment,{children:[a.jsx(o,{name:"mother_id",label:"Мать",cleanable:!0,searchable:!0,onClean:()=>l("mother_id",null),options:r.filter(({role:e,sex:s})=>e==="parent"&&s==="female").map(e=>({value:e.id,label:`${e.surname} ${e.name}`}))}),a.jsx(o,{name:"father_id",label:"Отец",cleanable:!0,searchable:!0,onClean:()=>l("father_id",null),options:r.filter(({role:e,sex:s})=>e==="parent"&&s==="male").map(e=>({value:e.id,label:`${e.surname} ${e.name}`}))})]}),a.jsx(c,{name:"admission_date",label:"С какого года ребенок обучается в ЧОУ «Империя знаний»",type:"date",required:!0}),a.jsx(m,{name:"previous_schools",label:"Перечислите предыдущие школы",placeholder:"Если нет — пишите «Нет»",required:!0}),a.jsx(m,{name:"medical_recommendations",label:"Медицинские и психологические рекомендации для ребенка",placeholder:"Если нет — пишите «Нет»",required:!0})]}),a.jsxs("div",{className:"flex items-center justify-end gap-2 mt-2 sm:col-span-2",children:[a.jsx(F,{className:"justify-center min-w-[92px]",type:"submit",disabled:n,loading:n,variant:"success",children:"Сохранить"}),a.jsx(F,{type:"reset",onClick:()=>p(!1),variant:"danger",children:"Отмена"})]})]})},JSON.stringify(t[t.role]))}export{Z as default};
