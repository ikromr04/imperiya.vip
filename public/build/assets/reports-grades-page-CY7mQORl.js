import{r as d,a as I,u as h,i as f,v as $,n as S,Y as G,j as s,S as M,A as u,L as y,X as w}from"./main-DHGA4RMi.js";import{B as A}from"./breadcrumbs-A247Yg4L.js";import{B as _}from"./button-DeS5fEeF.js";import{D as E}from"./description-list-CjuqeMDr.js";import{g as F,a as B}from"./grades-selector-unGdizhG.js";import{g as R,a as D}from"./users-selector-BJBZJU_2.js";import{e as U}from"./reports-BjEjERK5.js";import"./preload-helper-DPi8upcZ.js";import"./icons-BU7Eetv7.js";import"./FileSaver.min-BCwAZH7G.js";function J(){const[n,j]=d.useState(),l=I(),p=h(R),m=h(F),x=h(D),g=h(B),r=x?x.filter(a=>a.role==="student"):void 0;d.useEffect(()=>{p===f.Idle&&l($()),m===f.Idle&&l(S())},[l,m,p]),d.useEffect(()=>{!n&&r&&l(G({ids:r.map(({id:a})=>a),onSuccess:a=>j(a)}))},[l,n,r]);const c=d.useMemo(()=>{const a={};if(n&&g&&x)return n.forEach(t=>{!a[t.studentId]&&(t.score1||t.score2)&&(a[t.studentId]=[]),t.score1&&a[t.studentId].push(t.score1),t.score2&&a[t.studentId].push(t.score2)}),a},[g,n,x]),o=d.useMemo(()=>{if(c&&r){const a=r.map(e=>{const i=c[e.id]?c[e.id].reduce((b,N)=>b+N,0)/c[e.id].length:0;return{id:e.id,name:`${e.surname} ${e.name} ${e.patronymic||""}`,average:i,rounded:Math.round(i)}}),t={excellent:a.filter(e=>e.average&&Math.round(e.average)===5),good:a.filter(e=>e.average&&Math.round(e.average)===4),average:a.filter(e=>e.average&&Math.round(e.average)===3),poor:a.filter(e=>e.average&&Math.round(e.average)===2),noGrades:a.filter(e=>!e.average)};return{classInfo:{class:"Все классы",totalStudents:r.length,girls:r.filter(({sex:e})=>e==="female").length,boys:r.filter(({sex:e})=>e==="male").length,excellent:{count:t.excellent.length,percent:+(t.excellent.length*100/r.length).toFixed(2)},good:{count:t.good.length,percent:+(t.good.length*100/r.length).toFixed(2)},average:{count:t.average.length,percent:+(t.average.length*100/r.length).toFixed(2)},poor:{count:t.poor.length,percent:+(t.poor.length*100/r.length).toFixed(2)},noGrades:{count:t.noGrades.length,percent:+(t.noGrades.length*100/r.length).toFixed(2)}},students:t}}},[c,r]),v={excellent:"Отличники",good:"Четвёрочники",average:"Троечники",poor:"Двоечники",noGrades:"Без оценок"};return o?s.jsxs("main",{className:"pt-2 pb-40 flex flex-col",children:[s.jsxs("h1",{className:"title",children:["Класс ",o.classInfo.class]}),s.jsx(A,{items:[["Отчеты",u.Reports.Index],[`${o.classInfo.class}`,""]]}),s.jsx(_,{className:"max-h-7 ml-auto mb-2",icon:"fileExport",variant:"light",onClick:()=>U(o),children:s.jsx("span",{className:"sr-only md:not-sr-only",children:"Экспорт"})}),s.jsxs("section",{className:"box",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:"Общая информация"})}),s.jsxs("div",{className:"relative",children:[s.jsx(E,{className:"box__body",list:{"Количество учеников":`${o.classInfo.totalStudents} (девочек ${o.classInfo.girls} / мальчиков ${o.classInfo.boys})`,Отличники:`${o.classInfo.excellent.count} (${o.classInfo.excellent.percent}%)`,Четвёрочники:`${o.classInfo.good.count} (${o.classInfo.good.percent}%)`,Троечники:`${o.classInfo.average.count} (${o.classInfo.average.percent}%)`,Двоечники:`${o.classInfo.poor.count} (${o.classInfo.poor.percent}%)`,"Без оценок":`${o.classInfo.noGrades.count} (${o.classInfo.noGrades.percent}%)`}}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]}),Object.entries(v).map(([a,t])=>s.jsxs("section",{className:"box mt-4",children:[s.jsx("header",{className:"box__header",children:s.jsx("h2",{className:"title md:!text-lg",children:t})}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"box__body",children:o.students[a].length?s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[320px]",children:"ФИО"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[140px]",children:"Средний балл"}),s.jsx("th",{className:"text-left font-normal text-[15px] min-w-[160px]",children:"Округлённая оценка"})]})}),s.jsx("tbody",{children:o.students[a].map(e=>{var i;return s.jsxs("tr",{className:"py-1",children:[s.jsx("td",{className:"pr-10",children:s.jsx(y,{className:"text-blue-600",to:w(u.Users.Show,{id:e.id}),children:e.name})}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:(i=e.average)==null?void 0:i.toFixed(2)}),s.jsx("td",{className:"pr-10 font-medium text-lg",children:e.rounded})]},e.id)})})]}):"Нет учеников"}),s.jsx("div",{className:"absolute top-[1px] right-0 rounded-br-md z-10 min-w-6 h-[calc(100%-1px)] pointer-events-none bg-gradient-to-l from-white to-transparent"})]})]},a))]}):s.jsx(M,{className:"w-8 h-8 m-2"})}export{J as default};
