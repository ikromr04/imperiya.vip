import{q as r,j as s,L as A,v as I,A as Y,u as M,a as i,r as j,h as w,w as z,x as v,z as U,S as P,c as S,e as E,m as _,t as C,N as R}from"./main-DLHcp_34.js";import h from"./not-found-page-CxBj0ttz.js";import{L as G}from"./layout-2xVoEXUw.js";import{g as D,a as k}from"./users-selector-PkA7Q9gb.js";import{g as H,a as W}from"./grades-selector-BzUEWiWt.js";import{I as b}from"./icons-OdLsuZAu.js";import{g as q,c as y}from"./index-mapehrYe.js";import{H as T,L as F}from"./lesson-hour-CqzrFAfF.js";import{g as O,a as $}from"./subjects-selector-4Lo3Op8w.js";import"./preload-helper-DPi8upcZ.js";import"./button-Bb1-8EaV.js";import"./users-DUqPc0QS.js";import"./nationalities-selector-DOH6-eHl.js";import"./description-list-D9mIt6Ax.js";function B({date:o,hour:m,subjects:d,lessons:x,users:l}){var c;const a=x.find(t=>r(t.date).format("YYYY-MM-DD")===r(o).format("YYYY-MM-DD")&&+t.hour==+m);if(!a)return;const n=l.find(({id:t})=>t===a.teacherId);return s.jsxs("div",{className:"flex flex-col text-center leading-none group",children:[s.jsx("span",{className:"truncate",children:(c=d.find(({id:t})=>t===a.subjectId))==null?void 0:c.name}),n&&s.jsxs("div",{className:"flex justify-center text-sm items-baseline",children:["(",s.jsxs(A,{className:"duration-150 hover:text-blue-600 truncate",to:I(Y.Users.Show,{id:a.teacherId}),children:[n.surname," ",n.name]}),")"]})]})}function J({grade:o}){const m=M(),d=i(O),x=i(D),l=i($),a=i(k),[n,c]=j.useState(null),[t,u]=j.useState(0),f=q(t),g=j.useRef(null);j.useEffect(()=>{d===w.Idle&&m(z()),x===w.Idle&&m(v()),n||m(U({week:t,gradeId:o.id,onSuccess:e=>c(e)}))},[m,o.id,n,d,x,t]);const N=e=>{if(g.current){const{scrollLeft:p}=e.currentTarget;g.current.querySelectorAll(".sync-scroll").forEach(L=>{L.scrollLeft=p})}};return!n||!l||!a?s.jsx(P,{className:"w-8 h-8"}):s.jsxs("div",{className:"rounded-md shadow border pb-1 bg-[linear-gradient(to_bottom,white_0%,white_50%,#f3f4f6_50%,#f3f4f6_100%)] max-w-full",children:[s.jsxs("table",{ref:g,className:"flex flex-col w-full",children:[s.jsx("caption",{className:"text-left p-2 pl-4 border-b",children:s.jsxs("div",{className:"flex items-baseline gap-1 text-blue-700",children:[s.jsx(b.calendar,{className:"relative top-[1px]",height:16}),y(r(f[0]).format("MMMM")),r(f[0]).format("M")!==r(f[5]).format("M")&&` - ${y(r(f[5]).format("MMMM"))}`]})}),s.jsx("thead",{className:"sticky top-0 z-20 bg-gray-100 shadow overflow-x-auto no-scrollbar sync-scroll",onScroll:N,children:s.jsxs("tr",{children:[s.jsx("th",{className:"min-w-7 w-7 max-w-7 sticky left-0 z-10 bg-gray-100"}),s.jsx("th",{className:"min-w-20 w-20 max-w-20"}),f.map(e=>s.jsx("th",{className:S("p-2 min-w-[260px] w-[260px] max-w-[260px] text-center",r(e).format("YYYY-MM-DD")===r().format("YYYY-MM-DD")&&"bg-green-50"),children:y(e.format("dddd - DD"))},r(e).format()))]})}),s.jsx("tbody",{className:"overflow-x-auto no-scrollbar sync-scroll bg-white",onScroll:N,children:Object.keys(T).map(e=>s.jsxs("tr",{className:"min-h-[53px] h-[53px] max-h-[53px] border-b",children:[s.jsx("td",{className:"min-w-7 w-7 max-w-7 text-center font-semibold sticky left-0 z-10 bg-white",children:s.jsx("div",{className:"absolute left-0 top-0 w-full h-full border-r border-l flex justify-center items-center",children:e})}),s.jsx("td",{className:"min-w-20 w-20 max-w-20 text-sm",children:s.jsx(F,{hour:+e})}),f.map(p=>s.jsx("td",{className:S("relative z-0 p-2 border-l min-w-[260px] w-[260px] max-w-[260px]",r(p).format("YYYY-MM-DD")===r().format("YYYY-MM-DD")?"bg-green-50":"bg-white"),children:l&&a&&s.jsx(B,{date:p,hour:Number(e),subjects:l,users:a,lessons:n})},r(p).format()))]},e))}),s.jsx("tfoot",{className:"sticky bottom-[48px] z-10 overflow-x-auto bg-white styled-scrollbar mb-[-1px] sync-scroll",onScroll:N,children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-0 border-b min-w-10 w-10"}),s.jsx("th",{className:"p-0 border-b min-w-[91px]"}),f.map(e=>s.jsx("th",{className:"p-0 min-w-[260px] w-[260px] max-w-[260px] text-center border-b"},r(e).format()))]})})]}),s.jsx("div",{className:"sticky bottom-0 z-10 p-2 border-t bg-gray-100",children:s.jsxs("div",{className:"flex w-max ml-auto gap-4",children:[s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{u(e=>e-1),c(null)},children:[s.jsx(b.previous,{width:7}),s.jsx("span",{className:"sr-only md:not-sr-only",children:"Предыдущая неделя"})]}),t!==0&&s.jsxs("button",{className:"flex justify-center items-center h-8 rounded-md",onClick:()=>{u(0),c(null)},children:[s.jsx(b.currentWeek,{width:16,height:16}),s.jsx("span",{className:"sr-only",children:"Текущая неделя"})]}),s.jsxs("button",{className:"flex justify-center items-center gap-x-2 h-8 border-transparent rounded-md border transform disabled:opacity-50 disabled:pointer-events-none",onClick:()=>{u(e=>e+1),c(null)},children:[s.jsx("span",{className:"sr-only md:not-sr-only",children:"Следующая неделя"}),s.jsx(b.next,{width:7})]})]})})]})}function K(){const o=M(),m=E(),d=i(D),x=i(H),l=i(k),a=i(W),n=(l==null?void 0:l.find(t=>t.id===+(m.id||0)))||null,c=a==null?void 0:a.find(({id:t})=>{var u;return t===((u=n==null?void 0:n.student)==null?void 0:u.gradeId)});return j.useEffect(()=>{d===w.Idle&&o(v()),x===w.Idle&&o(_())},[o,x,d]),s.jsx(G,{children:c&&s.jsx(J,{grade:c})})}const Q={superadmin:()=>s.jsx(h,{}),admin:()=>s.jsx(h,{}),director:()=>s.jsx(h,{}),teacher:()=>s.jsx(h,{}),parent:()=>s.jsx(K,{}),student:()=>s.jsx(h,{})};function ds(){const o=i(C);return o?Q[o.role]():s.jsx(R,{to:Y.Auth.Login})}export{ds as default};
